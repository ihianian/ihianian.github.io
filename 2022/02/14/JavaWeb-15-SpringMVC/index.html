<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="JavaWeb_15_SpringMVC, ihianian">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>JavaWeb_15_SpringMVC | ihianian</title>
    <link rel="icon" type="image/png" href="/header.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/header.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">ihianian</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/404" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/404" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/header.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">ihianian</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/404" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/404" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">JavaWeb_15_SpringMVC</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/JavaWeb/">
                                <span class="chip bg-color">JavaWeb</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-02-14
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-05-05
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    18.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    76 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>本文介绍SpringMVC框架。</p>
<h2 id="1-SpringMVC概述"><a href="#1-SpringMVC概述" class="headerlink" title="1. SpringMVC概述"></a>1. SpringMVC概述</h2><h3 id="1-1-SpringMVC简介"><a href="#1-1-SpringMVC简介" class="headerlink" title="1.1 SpringMVC简介"></a>1.1 SpringMVC简介</h3><p>SpringMVC是基于Spring的一个框架，实际上就是<strong>Spring的一个模块</strong>，专门来做Web开发的，<strong>可以看成是Servlet的一个升级</strong>。因为Servlet的功能比较弱，在使用上比较繁琐，一切都得自己开发，因此急需一个框架让Web开发更加流畅简单。</p>
<p>Web开发底层都是Servlet，框架是在Servlet的基础上增加一些功能，使得开发更加方便，一些底层实现不需要重复写了。</p>
<p>SpringMVC也是一个Spring，是一个容器，能够创建对象，存放的一般是控制器对象，我们知道Spring采用标签以及注解来创建对象，因此SpringMVC也可以采用这两种方法来创建对象。</p>
<p>我们要做的就是使用@Controller注解创建控制器对象，将对象放入到SpringMVC容器中，把创建的对象当做控制器使用。这个控制器能够接收用户的请求，显示处理结果，虽然是<strong>普通的类对象</strong>，但是SpringMVC赋予了该控制器对象一些额外的功能，<strong>因此可以看成是Servlet对象，可以像Servlet一样接收请求返回结果等等。</strong></p>
<blockquote>
<p>我们知道Web开发底层是Servlet，用户和服务器之间的通信都是由Servlet来中转的。因此SpringMVC中有一个<strong>DispatcherServlet（中央调度器，前端控制器）</strong>，该对象是Servlet对象，负责接收用户的所有请求。然后该对象将用户请求转发给我们的控制器对象@Controller，最后由控制器对象处理用户请求，并将处理结果返回给中央调度器，由中央调度器返回给客户端浏览器。</p>
<p><strong>所以，中央调度器的作用就是负责转发，一定程度上相当于代理。此时，我们只需要面向这个代理编程即可。而SprinvMVC则是提供了这个代理，我们只需要实现具体的控制器对象来处理用户请求即可。</strong></p>
<p><strong>另外，中央调度器在创建的时候会自动创建SpringMVC容器（WebApplicationContext），并扫描配置文件springmvc.xml生成控制器对象，将控制器对象放入到该容器中。并将SpringMVC容器放入到Web容器的ServletContext中，方便我们直接获取。</strong></p>
</blockquote>
<h3 id="1-2-SpringMVC优点"><a href="#1-2-SpringMVC优点" class="headerlink" title="1.2 SpringMVC优点"></a>1.2 SpringMVC优点</h3><p>SpringMVC有以下几个优点：</p>
<ol>
<li><p>基于MVC架构</p>
<p>基于MVC架构，功能分工明确。解耦合</p>
</li>
<li><p>容易理解，上手快；使用简单</p>
</li>
<li><p>作为Spring框架的一部分，能够使用Spring的IoC和AOP，方便整合其他框架。</p>
</li>
<li><p>SpringMVC强化注解的使用，在控制器、Service、Dao等都可以使用注解，方便灵活。<br>使用@Controller创建处理器对象，@Service创建业务对象，@Autowired或者@Resource在控制器类中注入Service，在Service类中注入Dao。</p>
</li>
</ol>
<p>或者说，SpringMVC就是Spring，只不过专门来开发Web项目。</p>
<h3 id="1-3-第一个注解的SpringMVC程序"><a href="#1-3-第一个注解的SpringMVC程序" class="headerlink" title="1.3 第一个注解的SpringMVC程序"></a>1.3 第一个注解的SpringMVC程序</h3><p>需求如下所示：</p>
<blockquote>
<p>用户在页面发起一个请求，请求交给SpringMVC的控制器对象。并显示请求的处理结果（在结果页面显示一个欢迎语句）。</p>
</blockquote>
<p>步骤如下所示：</p>
<ol>
<li><p>新建web maven工程</p>
</li>
<li><p>加入依赖</p>
<ol>
<li>spring-mvc依赖，（会自动加入spring的相关依赖）</li>
<li>jsp、servlet依赖</li>
</ol>
<p>可以看到springmvc依赖已经包括了spring必需的依赖。如下所示：</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/springmvc/springmvc_001.png" alt="springmvc_001.png (905×362) (gitee.io)"></p>
<p>具体的依赖如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- servlet依赖 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- jsp依赖 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp/jsp-api --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- spring mvc 依赖 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>重点</strong>：<strong>在web.xml中注册springmvc框架的核心对象：DispatcherServlet</strong>。</p>
<ol>
<li>该对象叫做中央调度器，是一个Servlet，它的父类是HttpServlet</li>
<li>该对象也被称为前端控制器（front controller）</li>
<li>该对象<strong>负责接收用户提交的请求，调用其他的控制器对象，并把请求的处理结果显示给用户</strong>。</li>
<li><strong>可以看到该对象和我们之前手写的Servlet功能一样，只不过这是Spring实现的，我们只需要拿来用即可。</strong></li>
</ol>
<p><strong>注意，自动生成的web.xml中的版本比较低，需要重新生成一下，或者拷贝现有的其他文件。</strong></p>
<p>注意，启动web服务器后，springmvc创建对象时，要读取的配置文件默认是<code>/WEB-INF/&lt;servlet-name&gt;-servlet.xml</code>（即使创建的对象个数为0，也会读取），此时因为并不存在这个文件会报错，我们可以手动设置读取的配置文件位置，<strong>一般情况下是在根路径下，即resources/springmvc.xml</strong>。配置文件如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 声明，注册springmvc的核心对象DispatcherServlet --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 注意，我们一般情况下，Servlet对象是在被访问的时候才会被创建，所以一般都是写映射路径。</span></span><br><span class="line"><span class="comment">       但是我们期望该中央调度器对象是在web服务器被启动的时候就要创建出来，因为该对象在创建的</span></span><br><span class="line"><span class="comment">       时候会自动创建springmvc容器，读取springmvc的配置文件，把这个配置文件中的对象都自动创建好，</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       同时，会将该容器对象放入到web服务器中的ServletContext中，我们可以直接获取该容器。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       而我们后续会用到该容器中的对象，当用户发起请求时就可以直接使用容器中的对象了。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       因此，我们希望爱服务器启动的时候，就要创建该对象，而不是等待外部访问该注册路径的时候再创建对象</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 自定义springmvc读取的配置文件的位置，中央调度器需要读取该文件创建对象，并将其放入到springmvc容器中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- springmvc的配置文件的位置的属性 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 指定自定义文件的位置，一般放置在类路径下 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 表示服务器启动的时候就创建该对象，数字表示优先级，越小优先级越高，大于等于0的整数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 注意，使用框架的时候，url-pattern可以使用两种值 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 一是使用扩展名的方法，语法：*.xxx，xxx是自定义的扩展名，常用的有：*.do，*.action, *.mvc等等 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 如：http://localhost:8080/myweb/some.do --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 如：http://localhost:8080/myweb/other.do --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 等等，以.do结尾的请求都会映射到springmvc框架中 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 第二种方式则是采用 &#x27;/&#x27;，后续再说 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>总体来说，声明中央调度器还需要声明以下三个内容：</p>
<ol>
<li>该对象创建时需要读取的配置文件位置：springmvc.xml（需要提前创建好）。因为中央调度器在创建时会进行一些列的附属操作。</li>
<li>该对象的创建时间：服务器启动的时候就要创建。</li>
<li>在映射的时候，注意请求路径，一般都是通配符批量将请求映射到SpringMVC框架中。</li>
</ol>
</li>
<li><p>创建一个发起请求的页面，如index.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;p&gt;第一个springmvc项目&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;&lt;a href=<span class="string">&quot;some.do&quot;</span>&gt;发起some.<span class="keyword">do</span>请求&lt;/a&gt; &lt;/p&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>创建控制器类（普通类，只不过在类上面加入注解创建对象，也被称为处理器类，用于处理用户请求）</p>
<ol>
<li>在类的上面加入@Controller注解，创建对象，并放入到SpringMVC容器中；</li>
<li>在类中的方法上面加入@RequestMapping注解。（<strong>采用注解方式开发</strong>）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.hianian.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> : hianian</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Time</span> : 2022/4/12 10:46</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@File</span> : MyController.java</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Controller</span>: 该注解用于创建处理器对象，对象放在SpringMVC容器中</span></span><br><span class="line"><span class="comment"> * 位置：在类的上面</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 这个注解和Spring中的<span class="doctag">@Service</span>、<span class="doctag">@Component</span>类似</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 属性为value，值为对象的名称。但是一般情况下不需要起名字。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理用户提交的请求，springmvc中是用方法来处理用户请求</span></span><br><span class="line">    <span class="comment">// 方法是自定义的，可以有多种返回值、多种参数，方法名称自定义。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 准备使用doSome()方法处理some.do请求。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 我们知道在web.xml文件中，是将所有的do请求映射给了中央控制器对象。那么怎么通知时候该方法处理do请求呢？</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 可以采用<span class="doctag">@ResultMapping</span>注解。（本质上就是一个方法来处理一个请求）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@ResultMapping</span>：请求映射注解，作用是把一个请求地址和一个方法绑定在一起。</span></span><br><span class="line"><span class="comment">     * 该注解有以下几个属性：</span></span><br><span class="line"><span class="comment">     *      1. value，表示请求的uri地址，值必须是唯一的。是一个字符串的数组，表示可以将多个uri都映射到该方法上来处理</span></span><br><span class="line"><span class="comment">     * 位置一般是在方法上使用，（在类上面使用也可以。），推荐以&quot;/&quot;开始。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 说明：使用RequestMapping修饰的方法叫做处理器方法或者控制器方法。使用该注解修饰的方法可以处理请求的，类似Servlet中</span></span><br><span class="line"><span class="comment">     * 的doGet、doPost等方法。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>：返回值类型是ModelAndView类型，包括：</span></span><br><span class="line"><span class="comment">     *          1. Model：数据，请求处理完成后，要显示给用户的数据</span></span><br><span class="line"><span class="comment">     *          2. View：视图，比如JSP等等。</span></span><br><span class="line"><span class="comment">     *          总的来说，返回值就是本次请求的处理结果。这个类是mvc框架中的类。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/some.do&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSome</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 处理用户请求</span></span><br><span class="line">        <span class="comment">// 其实这里的处理和Servlet中的一样，调用service方法，以及访问数据库操作数据等等。</span></span><br><span class="line">        <span class="comment">// 这里为了方便，假设已经处理好了，接下来就是将处理结果（数据和视图）放入到ModelAndView中</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建ModelAndView类对象</span></span><br><span class="line">        ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加数据（可以使用key,value形式，其中key是字符串，value是object类型）</span></span><br><span class="line">        mav.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;欢迎使用SpringMVC做web开发&quot;</span>);</span><br><span class="line">        mav.addObject(<span class="string">&quot;fun&quot;</span>, <span class="string">&quot;处理函数是dosome()方法&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 本质上，框架会将上述的&lt;key, value&gt;放入到request作用域中。</span></span><br><span class="line">        <span class="comment">// 即request.setAttribute(&quot;msg&quot;, &quot;欢迎使用SpringMVC做web开发&quot;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 指定视图，指定视图的完整路径</span></span><br><span class="line">        <span class="comment">// 框架对视图的使用，本质上是执行forward转发操作，即request.getRequestDispatcher(&quot;/show.jsp&quot;).forward(...)</span></span><br><span class="line">        mav.setViewName(<span class="string">&quot;/show.jsp&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回ModelAndView对象</span></span><br><span class="line">        <span class="comment">// 即我们只需要将数据和视图放入到ModelAndView对象里面即可，框架会自动做setAttribute和forward操作。</span></span><br><span class="line">        <span class="comment">// 因此，我们还需要的就是把数据取出来，放到jsp页面合适的位置中。</span></span><br><span class="line">        <span class="comment">// 可以看到，框架是帮我们做了一些典型的操作（使得开发更具有流程化，代码更加简洁清晰），具体的个性化设置需要我们自己来做。</span></span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>创建一个显示结果的页面，显示请求的处理结果。</p>
<p>show.jsp页面</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h3&gt;show.jsp从request作用域中获取数据&lt;/h3&gt;</span><br><span class="line">        &lt;!-- 这里我们只需要从request作用域中取数据即可 --&gt;</span><br><span class="line">        &lt;h3&gt;msg数据：$&#123;msg&#125;&lt;/h3&gt;</span><br><span class="line">        &lt;h3&gt;fun数据：$&#123;fun&#125;&lt;/h3&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>创建SpringMVC的配置文件（和Spring的配置一样）</p>
<ol>
<li>声明组件扫描器，指定@Controller注解所在的包名；</li>
<li>声明视图解析器，帮助处理视图。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- springmvc配置文件，用于声明springmvc容器中所需的一些对象，如控制器 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 另外，即使没有要创建的对象，也需要这个配置文件，因为规定了中央调度器会读取这个文件，所以如果没有就会报错 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 因为采用的是注解生成对象，所以需要声明组件扫描器 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 声明组件扫描器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;org.hianian.controller&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>结果如下所示：</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/springmvc/springmvc_002.png" alt="springmvc_002.png (599×152) (gitee.io)"></p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/springmvc/springmvc_003.png" alt="springmvc_003.png (637×227) (gitee.io)"></p>
</li>
</ol>
<h3 id="1-4-SpringMVC中的MVC组件"><a href="#1-4-SpringMVC中的MVC组件" class="headerlink" title="1.4 SpringMVC中的MVC组件"></a>1.4 SpringMVC中的MVC组件</h3><p>SpringMVC框架组织对象的时候实际上采用了MVC架构模式来组织的。如下所示，其中Front Controller就是前端控制器，即中央调度器DispatcherServlet；然后将请求转发给实际的控制器对象Controller（后端控制器，Back Controller），由它来处理用户请求；之后，Controller对象将结果（ModelAndView）返回给中央调度器，中央调度器调用View，将数据添加到视图中。</p>
<p>上面的中央调度器以及控制器就是MVC中的C，是一个控制器的角色；Controller的处理请求生成的数据就是MVC中的M；View视图显示的结果就是MVC中的V。</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/springmvc/springmvc_005.png" alt="springmvc_005.png (1046×725) (gitee.io)"></p>
<h3 id="1-5-SpringMVC执行流程"><a href="#1-5-SpringMVC执行流程" class="headerlink" title="1.5 SpringMVC执行流程"></a>1.5 SpringMVC执行流程</h3><p><strong>SpringMVC处理流程如下所示：</strong></p>
<blockquote>
<ol>
<li>用户发起请求：some.do</li>
<li>这个请求会到达服务器，交给web服务器（Tomcat）。</li>
<li>Tomcat服务器读取<code>web.xml</code>配置文件中的Servlet映射，发现该请求对应的时中央调度器，于是创建中央调度器以及SpringMVC容器。</li>
<li>另外，在创建中央调度器的同时，会读取<code>springmvc.xml</code>配置文件，进而创建组件扫描器，创建@Controller注解修饰的对象。在创建对象的时候，扫描方法，发现@RequestMapping修饰的方法，并映射了<code>some.do</code>。因此找到了处理该请求的具体方法。</li>
<li>框架执行该方法，得到了ModelAndView对象，并转发到<code>show.jsp</code>页面中。</li>
</ol>
<p>从上面可以看出，实际上中央调度器就是进行自动映射，将用户请求映射到具体的处理方法中。此时我们不再需要手动在配置文件中写&lt;servlet&gt;以及&lt;servlet-mapping&gt;了，使得配置文件更加简洁。<strong>大致的流程图如下所示：</strong></p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/springmvc/springmvc_004.png" alt="springmvc_004.png (1746×730) (gitee.io)"></p>
<p>可以看到，这里实际上和动态代理比较相似，每增加一个用户请求，不再需要手动在配置文件中进行servlet映射了，只需要在处理方法中加上映射注解即可，具体的映射操作可由中央调度器进行管理。</p>
</blockquote>
<p><strong>SpringMVC执行过程源代码分析如下所示（主要分为两部分）：</strong></p>
<blockquote>
<ol>
<li><p>Web服务器启动，创建容器的过程。</p>
<p>我们知道配置文件中有DispatcherServlet标签，而该标签内&lt;load-on-start&gt;标签指定的优先级为1，即在服务器启动的时候就创建DispatcherServlet对象。由于该类是继承HttpServlet的，是一个Servlet，所以在创建时会执行init()方法。（<strong>注意，因为是设置的是服务器启动就创建该对象，所以不是当用户发起请求时才创建的。</strong>）</p>
<p>在init()方法中，会执行类似以下代码（创建SpringMVC容器）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建容器对象，读取配置文件</span></span><br><span class="line">WebApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;springmvc.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把容器对象放入到ServletContext中</span></span><br><span class="line"><span class="keyword">this</span>.getServletContext.setAttribute(key, ctx);</span><br></pre></td></tr></table></figure>

<p>在创建SpringMVC对象的时候，会执行组件扫描器，创建@Controller注解修饰的类对象。并将这些Controller对象放入到SpringMVC容器（key, value）中。</p>
<p>中央调度器类的继承关系大致如下所示（可以关联一下源码查看具体步骤）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title">FrameworkServlet</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">FrameworkServlet</span> <span class="keyword">extends</span> <span class="title">HttpServletBean</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpServletBean</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.initServletBean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述过程是Web服务器在启动的时候执行的操作，简单地说，就是创建SpringMVC容器以及@Controller对象，并将对象放入到容器中，将该容器放入到Web服务器的全局作用域中。</p>
</li>
<li><p>请求的处理过程</p>
<p>因为本质上就是Servlet，所以，这里将本质上会调用service方法。执行的方法大概如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 调用并执行@Controller处理器中的对应方法，获得返回值ModelAndView类型</span></span><br><span class="line">    mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面就是大致的执行过程。本质上说，都是中央调度器DispatcherServlet中的方法，即该中央调度器负责匹配请求和Servlet的对应关系，并负责调用该方法处理用户请求。</p>
</li>
</ol>
</blockquote>
<p><strong>配置视图解析器：</strong></p>
<blockquote>
<p>我们知道，在Servlet中可以设置过滤器来防止用户通过URL来访问不可直接访问的资源，比如必须通过点击按钮来跳转到某一个页面，此时用户可直接输入对应的URL来访问跳转后的页面。<strong>但是过滤器一般情况下是用来设置用户权限的。</strong></p>
<p>因此，我们可以将页面资源放置到WEB-INF目录下，这样就不会通过URL来访问到了。因此，对应的在@Controller中的处理方法中需要设置路径，如：<code>mav.setViewName(&quot;/WEB-INF/view/show.jsp&quot;);</code>，但是如果有多个页面，其路径前缀往往是重复的，因此可以<strong>配置视图解析器</strong>。</p>
<p>配置文件springmvc.xml中的配置如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 声明SpringMVC框架中的视图解析器，帮助开发人员设置视图文件的路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 声明视图文件的前缀 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/view/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 声明视图文件的后缀，即扩展名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>控制器中的代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定视图，指定视图的完整路径</span></span><br><span class="line"><span class="comment">// 框架对视图的使用，本质上是执行forward转发操作，即request.getRequestDispatcher(&quot;/show.jsp&quot;).forward(...)</span></span><br><span class="line"><span class="comment">//        mav.setViewName(&quot;/WEB-INF/view/show.jsp&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明视图解析器之后，这里设置视图的路径可以变得简单。可以采用逻辑名称（文件名）来指定视图</span></span><br><span class="line"><span class="comment">// 框架会使用视图解析器的 前缀 + 逻辑名称 + 后缀 来组成完成路径，即字符串连接操作。</span></span><br><span class="line">mav.setViewName(<span class="string">&quot;show&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>这样，可以比较方便地设置视图了。</p>
</blockquote>
<p>另外，前面提到过，可以有多个Controller，也可以有多个RequestMapping，可以将多个请求映射到一个RequestMapping中，即value属性值有多个。</p>
<p>(<strong>讲解完全部知识，这里再来回顾一下SpringMVC的执行流程</strong>)</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/springmvc/springmvc_012.png" alt="springmvc_012.png (787×425) (gitee.io)"></p>
<blockquote>
<p>SpringMVC内部请求的处理流程如下所示：</p>
<ol>
<li>用户发起请求 some.do</li>
<li>DispatcherServlet接收请求 some.do，之后把请求转交给<strong>处理器映射器</strong>，这是一种实现了HandlerMapping接口的类对象，用于根据请求从SpringMVC容器中获取到处理该请求的Controller处理器对象。</li>
<li>映射器将找到的控制器对象，放入到<strong>处理器执行链</strong>中的类对象中保存（HandlerExecutionChain，这个对象有两个属性，一个是控制器，一个是拦截器数组以及List集合）</li>
<li>中央调度器根据上步得到的处理器执行链，将其交给<strong>处理器适配器</strong>类对象（HandlerAdapter），这个适配器主要用来执行控制器的处理方法。在获得处理器方法的返回结果后，将结果（如ModelAndView）返回给中央调度器。</li>
<li>中央调度器将得到的处理结果，交给<strong>视图解析器</strong>（ViewResolver）。该对象负责组成视图的完整路径，并创建View类对象（View接口），用于表示视图，返回给中央调度器。</li>
<li>最后，中央调度器调用视图对象View的方法，将结果数据放入到request作用域，执行forward，响应给用户浏览器。</li>
</ol>
</blockquote>
<h2 id="2-SpringMVC注解式开发（重点）"><a href="#2-SpringMVC注解式开发（重点）" class="headerlink" title="2. SpringMVC注解式开发（重点）"></a>2. SpringMVC注解式开发（重点）</h2><p>通过上面讲解，可以看到，最重要的就是@Controller注解和@RequestMapping注解，一个是用于创建控制器，一个是用于映射并处理用户请求。<strong>可以说，这两个是SpringMVC中最重要的部分，其中@RequestMapping最为重要。</strong></p>
<h3 id="2-1-RequestMapping定义请求规则"><a href="#2-1-RequestMapping定义请求规则" class="headerlink" title="2.1 @RequestMapping定义请求规则"></a>2.1 @RequestMapping定义请求规则</h3><p>前面提到过，可以有多个Controller、多个ResultMapping。如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &#123;&quot;/test/some.do&quot;, &quot;/test/first.do&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSome</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">        mav.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;第二个项目some方法&quot;</span>);</span><br><span class="line">        mav.addObject(<span class="string">&quot;date&quot;</span>, <span class="string">&quot;20220418&quot;</span>);</span><br><span class="line"></span><br><span class="line">        mav.setViewName(<span class="string">&quot;show&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &#123;&quot;/test/other.do&quot;, &quot;/test/second.do&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doOther</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">        mav.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;第二个项目other方法&quot;</span>);</span><br><span class="line">        mav.addObject(<span class="string">&quot;date&quot;</span>, <span class="string">&quot;20220418&quot;</span>);</span><br><span class="line"></span><br><span class="line">        mav.setViewName(<span class="string">&quot;show&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>其实上面有一个不足，就是这些路径有共同的前缀，因此，可以将前缀抽取出来，放到类上面进行定义。也就是说，一般情况下，一个模块或者一批类似的请求（拥有相同的前缀）映射到一个Controller对象中，之后，根据细分的请求路径来进一步映射到具体的方法中。</strong></p>
<p>@RequestMapping可以放到类上面，也可以放到方法上面。</p>
<ol>
<li><p>放到类上面，就是上面说的，匹配URL前缀，value属性值即为前缀，也被称为<strong>模块名称</strong>。</p>
<p>如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &#123;&quot;/some.do&quot;, &quot;/first.do&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSome</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">        mav.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;第二个项目some方法&quot;</span>);</span><br><span class="line">        mav.addObject(<span class="string">&quot;date&quot;</span>, <span class="string">&quot;20220418&quot;</span>);</span><br><span class="line"></span><br><span class="line">        mav.setViewName(<span class="string">&quot;show&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &#123;&quot;/other.do&quot;, &quot;/second.do&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doOther</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">        mav.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;第二个项目other方法&quot;</span>);</span><br><span class="line">        mav.addObject(<span class="string">&quot;date&quot;</span>, <span class="string">&quot;20220418&quot;</span>);</span><br><span class="line"></span><br><span class="line">        mav.setViewName(<span class="string">&quot;show&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>放到方法上面，就是匹配具体的请求路径。</p>
</li>
</ol>
<p><strong>该注解可以控制处理的请求方式是get还是post，可通过属性method来控制处理的请求选择，属性值是RequestMethod类枚举值。</strong>如get方式，则需要指明<code>RequestMethod.GET</code>。<strong>注意，如果不声明，则任意请求方式均可。</strong>简单代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &#123;&quot;/some.do&quot;, &quot;/first.do&quot;&#125;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSome</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">    mav.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;第二个项目some方法&quot;</span>);</span><br><span class="line">    mav.addObject(<span class="string">&quot;date&quot;</span>, <span class="string">&quot;20220418&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mav.setViewName(<span class="string">&quot;show&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-处理器方法的参数"><a href="#2-2-处理器方法的参数" class="headerlink" title="2.2 处理器方法的参数"></a>2.2 处理器方法的参数</h3><p>上面讲解了接收用户的请求，那么接下来讲解如果获取请求中的具体数据（比如Servlet运行过程中的通用数据、用户提交的数据等等）。处理器方法可以包含以下四类参数，这些参数会在系统调用时由系统自动赋值，即程序员可以在方法内直接使用。</p>
<ol>
<li>HttpServletRequest</li>
<li>HttpServletResponse</li>
<li>HttpSession</li>
<li>请求中所携带的请求参数（用户提交的数据）</li>
</ol>
<p>上述参数主要放在@RequestMapping所修饰方法的形参位置，这样，我们才能够在处理用户请求时获取到这些变量。<strong>对于前三个参数，如果需要在方法中使用，直接在方法形参列表中声明即可，框架会自动完成赋值。</strong>简单代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &#123;&quot;/other.do&quot;, &quot;/second.do&quot;&#125;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doOther</span><span class="params">(HttpServletRequest httpServletRequest,</span></span></span><br><span class="line"><span class="params"><span class="function">                            HttpServletResponse httpServletResponse,</span></span></span><br><span class="line"><span class="params"><span class="function">                            HttpSession httpSession)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取参数的相关内容，框架会自动赋值，我们只需要拿来用即可。</span></span><br><span class="line">    mav.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;第二个项目other方法&quot;</span> + <span class="string">&quot;---&gt;&quot;</span> + httpServletRequest.getParameter(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">    mav.addObject(<span class="string">&quot;date&quot;</span>, <span class="string">&quot;20220418&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mav.setViewName(<span class="string">&quot;show&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-1-接收用户提交的数据"><a href="#2-2-1-接收用户提交的数据" class="headerlink" title="2.2.1 接收用户提交的数据"></a>2.2.1 接收用户提交的数据</h4><p>主要有以下几种方式：</p>
<ol>
<li><p>逐个接收</p>
<p>该方法需要在控制器方法中添加形参，且形参名和用户提交的参数名（name）必须保持一致，即<strong>同名的请求参数赋值给同名的形参</strong>。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;test/third.do&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    姓名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span>&gt;</span><br><span class="line">    年龄：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;age&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交third请求&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收用户数据</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/third.do&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSecond</span><span class="params">(String name, <span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 采用逐个接收的方式来接收用户请求参数</span></span><br><span class="line">    <span class="comment">// 要求形参中的形参名和请求中的参数名（name）必须一致。（同名的请求参数赋值给同名的形参）</span></span><br><span class="line"></span><br><span class="line">    ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取参数的相关内容</span></span><br><span class="line">    mav.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;name=&quot;</span> + name);</span><br><span class="line">    mav.addObject(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;age=&quot;</span> + age);</span><br><span class="line"></span><br><span class="line">    mav.setViewName(<span class="string">&quot;show&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>框架底层的操作大致如下所示：</p>
<blockquote>
<ol>
<li><p>使用request对象接收请求参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String strName = request.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">String strAge = request.getParameter(<span class="string">&quot;age&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>SpringMVC框架通过中央调度器DispatcherServlet来调用控制器@Controller的doThird()方法，**在调用方法的时候，按照名称对应关系将参数赋值给形参。即doThird(strName, Integer.valueOf(strAge)**。自动进行类型转换等操作。</p>
</li>
</ol>
<p>另外要注意，因为自动进行类型转换，所以提交的数据必须满足类型转换要求。比如age如果是空的话，那么就会出现类型转换异常，因为<code>Integer.valueOf()</code>不会把空字符串转换为整型，也不会把“asdf”等类型的字符串转换为整型。<strong>因此，这种数据类型限制比较大，一般采用Integer包装类型或者String类型后续手动转换，而不是int。</strong></p>
</blockquote>
<p>对于参数乱码问题，一般采用过滤器进行额外设置字符编码，使其对所有请求均生效。<strong>可以自定义过滤器，也可以采用框架提供的过滤器CharacterEncodingFilter。（本质上还是通过request.setCharacterEncoding()来设置编码的）</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册声明过滤器，解决post请求乱码的问题 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 对类中的属性赋值 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1. 设置字符编码方式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 2. 强制请求对象HttpServletRequest使用上述encoding编码方式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceRequestEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 3. 强制响应对象HttpServletResponse使用上述encoding编码方式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceResponseEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 映射请求，表明所有请求均通过过滤器进行处理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>但是有时候用户参数名和方法形参名不是同名，这时候该怎么办呢？可以采用@RequestParam注解，该注解用在方法形参名的前面，有一个value属性，值为用户请求参数名。另外还有一个required属性，默认为true，表示必须有该参数。</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;test/param.do&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    姓名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;rname&quot;</span>&gt;</span><br><span class="line">    年龄：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;rage&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交param请求&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收用户数据</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/param.do&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doParam</span><span class="params">(<span class="meta">@RequestParam(value = &quot;rname&quot;)</span> String name, <span class="meta">@RequestParam(value = &quot;rage&quot;)</span> <span class="keyword">int</span> age)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;从用户端接收到的数据name为&quot;</span> + name + <span class="string">&quot;，年龄为&quot;</span> + age);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 采用逐个接收的方式来接收用户请求参数</span></span><br><span class="line">    <span class="comment">// 要求形参中的形参名和请求中的参数名（name）必须一致。（同名的请求参数赋值给同名的形参）</span></span><br><span class="line"></span><br><span class="line">    ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取参数的相关内容</span></span><br><span class="line">    mav.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;name=&quot;</span> + name);</span><br><span class="line">    mav.addObject(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;age=&quot;</span> + age);</span><br><span class="line"></span><br><span class="line">    mav.setViewName(<span class="string">&quot;show&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>对象接收</p>
<p>上述方法适合参数比较少的情况，如果参数特别多，那么方法的形参列表就会比较长，这样书写代码容易出错。<strong>因此可以将处理器方法的参数定义为一个对象，只要保证请求参数名和这个对象的属性同名即可。框架会进行数据封装。</strong></p>
<p>首先，如果形参名是Java对象，那么框架就会创建形参的对象，给属性赋值。即如果请求参数的名称为name，那么框架就会调用类对象的setName()方法，给属性赋值。</p>
<p>为了方便测试流程，这里在Student类中输出和一些语句。代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存请求参数值的一个普通类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;无参构造方法执行，创建Student类对象&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;setName()方法执行：&quot;</span> + name);</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;setAge()方法执行：&quot;</span> + age);</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收用户数据</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/object.do&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doObject</span><span class="params">(Student myStudent)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;从用户端接收到的数据name为&quot;</span> + myStudent.getName() + <span class="string">&quot;，年龄为&quot;</span> + myStudent.getAge());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 采用逐个接收的方式来接收用户请求参数</span></span><br><span class="line">    <span class="comment">// 要求形参中的形参名和请求中的参数名（name）必须一致。（同名的请求参数赋值给同名的形参）</span></span><br><span class="line"></span><br><span class="line">    ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取参数的相关内容</span></span><br><span class="line">    mav.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;name=&quot;</span> + myStudent.getName());</span><br><span class="line">    mav.addObject(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;age=&quot;</span> + myStudent.getAge());</span><br><span class="line">    mav.addObject(<span class="string">&quot;student&quot;</span>, myStudent);</span><br><span class="line"></span><br><span class="line">    mav.setViewName(<span class="string">&quot;show&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>经过测试，构造方法以及set方法确实会依次执行。</p>
</li>
</ol>
<h3 id="2-3-处理器方法的返回值"><a href="#2-3-处理器方法的返回值" class="headerlink" title="2.3 处理器方法的返回值"></a>2.3 处理器方法的返回值</h3><p>上节介绍了方法的形参设置，这节介绍方法的返回值。<strong>使用@Controller注解修饰的处理器的处理器方法，其常用的返回值类型有以下四种类型：</strong></p>
<ol>
<li>ModelAndView</li>
<li>String</li>
<li>无返回值void</li>
<li>自定义类型对象（Object）</li>
</ol>
<p>可以根据不同的情况，使用不同的返回值。</p>
<h4 id="2-3-1-返回ModelAndView"><a href="#2-3-1-返回ModelAndView" class="headerlink" title="2.3.1 返回ModelAndView"></a>2.3.1 返回ModelAndView</h4><p>若处理器方法处理完后，<strong>需要跳转到其他资源，并且需要在跳转的资源之间传递数据</strong>，此时处理器方法返回ModelAndView类型比较好。当然，若要返回ModelAndView，则处理器方法中需要定义ModelAndView。</p>
<p>在使用时，若该处理器方法只是进行跳转而不传递数据，或者只是传递数据而不向任何资源跳转（如对页面的AJAX异步响应），此时若返回ModelAndView，则将总有一部分是多余的，要么是Model多余，要么是View多余。此时返回ModelAndView则不太合适。</p>
<h4 id="2-3-2-返回String"><a href="#2-3-2-返回String" class="headerlink" title="2.3.2 返回String"></a>2.3.2 返回String</h4><p><strong>如果只需要视图之间的跳转，而不需要传递数据，那么可以采用String返回值类型</strong>。处理器方法返回的字符串可以指定逻辑视图名（或者物理视图地址），通过视图解析器可以将其转换为物理视图地址。</p>
<p>代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/dome.do&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">doSome</span><span class="params">(String name, String age)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;获取到的参数为：name=&quot;</span> + name + <span class="string">&quot;, age=&quot;</span> + age);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回值类型为字符串，直接指明要跳转资源的逻辑名称即可</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;show&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当然，如果需要在资源之间传递数据，我们可以手动的添加HttpServletRequest形参，并将数据添加到请求域中，这样，可以在页面中直接取数据，和ModelAndView达到一样的效果。代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/dome.do&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">doSome</span><span class="params">(HttpServletRequest request, String name, String age)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;获取到的参数为：name=&quot;</span> + name + <span class="string">&quot;, age=&quot;</span> + age);</span><br><span class="line"></span><br><span class="line">    request.setAttribute(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">    request.setAttribute(<span class="string">&quot;age&quot;</span>, age);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回值类型为字符串，直接指明要跳转资源的逻辑名称即可</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;show&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-3-返回void（了解）"><a href="#2-3-3-返回void（了解）" class="headerlink" title="2.3.3 返回void（了解）"></a>2.3.3 返回void（了解）</h4><p>因为返回值是void，所以该返回值实际上没什么用，即不能表示数据，也不能表示视图，<strong>可以用于AJAX请求，在HttpServletResponse中传输响应内容（注意，AJAX请求服务器端返回的就是数据，和视图无关，且AJAX需要JSON格式的数据，此时需要服务器端将数据转换为JSON格式）</strong>。对象有属性，因此属性值就是具体的数据。</p>
<p>这里不再展示代码部分。</p>
<p>可以看到，对JSON返回数据所做的处理主要分为三部分：</p>
<ol>
<li>创建对象，给属性赋值</li>
<li>将对象转换为JSON对象</li>
<li>将JSON格式数据通过HttpServletResponse输出到用户端。</li>
</ol>
<p>那么其中2、3步骤是通用的，关键在于第一部分。所以可以进一步简化上述操作，由框架来执行2、3步骤，见2.3.4。</p>
<h4 id="2-3-4-返回Object"><a href="#2-3-4-返回Object" class="headerlink" title="2.3.4 返回Object"></a>2.3.4 返回Object</h4><p>处理器方法也可以返回Object对象。这个Object可以是Integer、String、自定义对象、Map、List等等。<strong>但是返回的对象不是作为逻辑视图出现的，而是作为直接在页面显示的数据出现的。主要处理AJAX请求。返回对象，需要使用@ResponseBody注解，将转换后的JSON数据放入到响应体中。</strong></p>
<p>可以看出来，这里的Object不是真正的Object，而是Object所包括的任意数据类型。响应AJAX（<strong>针对json格式数据</strong>）的相关步骤如下所示：</p>
<ol>
<li>加入处理json的工具库的依赖，springmvc默认使用jackson。</li>
<li>在springmvc的配置文件中加入&lt;mvc:annotation-driven&gt;注解驱动，功能负责上面的第二步骤。</li>
<li>在处理器方法上面加入@ResponseBody注解，功能负责上面的第三步骤。</li>
</ol>
<p>那么只返回Object类对象，为何就会返回给用户端了呢，怎么转换的格式呢？大致原理如下所示：</p>
<blockquote>
<p>springmvc处理器方法返回Object，可以转换为json格式输出到浏览器、响应AJAX的内部原理：</p>
<ol>
<li><p>&lt;mvc:annotation-driven&gt;注解驱动</p>
<p>注解驱动实现的功能是：完成Java对象到 json，xml，text，二进制等数据格式的转换。这个驱动涉及到HttpMessageConverter接口（消息转换器），这个接口定义了 Java对象转换为 json等格式数据的方法，有很多的实现类（常用的有StringHttpMessageConverter、MappingJackson2HttpMessageConverter），且实现了上述方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HttpMessageConverter</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 针对控制器方法返回的Object，为了将其输出到浏览器，会用到该方法</span></span><br><span class="line">    <span class="comment">// 该方法会检查返回值Object能不能转换为MediaType类型，如果能就返回true</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">canWrite</span><span class="params">(Class&lt;?&gt; clazz, <span class="meta">@Nullable</span> MediaType mediaType)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 针对控制器方法返回的Object，为了将其输出到浏览器，会用到该方法</span></span><br><span class="line">    <span class="comment">// 将返回值Object转换成对应的MediaType类型数据</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(T t, <span class="meta">@Nullable</span> MediaType contentType, HttpOutputMessage outputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotWritableException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实际上，在加入该注解后，会自动创建该接口的7个实现类对象，用于后续的数据类型转换。</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/springmvc/springmvc_006.png" alt="springmvc_006.png (1066×698) (gitee.io)"></p>
</li>
<li><p>@ResponseBody注解</p>
<p>这个注解用于放置在处理器方法的上面，通过HttpServletResponse输出数据，响应AJAX请求。</p>
</li>
</ol>
</blockquote>
<p>JSON相关的依赖如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- json依赖 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置文件<code>springmvc.xml</code>中的注解驱动为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>控制器方法具体实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理器方法返回一个Student，通过框架转换为JSON格式，响应AJAX请求</span></span><br><span class="line"><span class="comment">// ResponseBody注解会把处理器方法返回的对象转换为json，通过HttpServletResponse输出给浏览器</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/resutrnStudentJson.do&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Student <span class="title">doStudentJsonObject</span><span class="params">(String name, Integer age)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 假设数据处理完成</span></span><br><span class="line">    Student student = <span class="keyword">new</span> Student();</span><br><span class="line">    student.setName(name);</span><br><span class="line">    student.setAge(age);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回Student类型，会被框架转换为json数据</span></span><br><span class="line">    <span class="keyword">return</span> student;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大致流程如下所示：</p>
<blockquote>
<ol>
<li>该方法会将数据封装成返回的类型，之后框架会根据返回的Student类型，调用框架的ArrayList集合中的HttpMessageConverter实现类对象，调用canWrite()方法，来检测可以转换成哪个类型。</li>
<li>根据找到的类型，调用write()方法，把该Student类型对象转换为对应的类型。</li>
<li>框架会调用@ResponseBody注解的功能，将转换后的类型数据输出到浏览器，ajax请求处理完成。</li>
</ol>
</blockquote>
<p><strong>有时候，我们返回的不是一个对象，而是对象集合List、Map等集合，那么此时该怎么做呢？</strong></p>
<p>其实步骤和上面一样，框架会先将List中的每个对象转化为json对象，再将json对象封装为json数组。（不需要我们进行额外操作）</p>
<p>另外，Object类型也可以是String，因为有了注解@ResponseBody修饰，此时String不再表示视图，而是数据。<strong>注意，此时返回的类型就不是json格式了，在用户端接收的时候需要注意。</strong>此时可能出现乱码问题，可以在@ResultMapping注解中加入<code>produces=&quot;test/plain;charset=utf-8&quot;</code>属性。<strong>注意，这里是通过专有的渠道返回给AJAX，并不走过滤器，所以过滤器对此时的乱码无效。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/resutrnStudentJsonArray.do&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">doStudentJsonObjectArray</span><span class="params">(String name, Integer age)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name + <span class="string">&quot;--&gt;是&quot;</span> + age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>这部分主要讲解了返回Object类型数据的相关处理，如何转换成json数据类型，如何接收等等。这部分主要用于处理ajax异步请求，比void更加方便。</strong></p>
<h3 id="2-4-解读-lt-url-pattern-gt-（静态资源访问）"><a href="#2-4-解读-lt-url-pattern-gt-（静态资源访问）" class="headerlink" title="2.4 解读&lt;url-pattern&gt;（静态资源访问）"></a>2.4 解读&lt;url-pattern&gt;（静态资源访问）</h3><p>这个标签主要用于用户请求映射到哪个Servlet中，通过前面的讲解，可以发现，我们是将<code>*.do</code>（以.do结尾的请求）映射到SpringMVC的中央调度器中。那么对于其他请求呢？比如html、jsp、jpg等静态资源，我们可以直接输入URl。</p>
<p>其实对于其他我们没有在<code>web.xml</code>配置文件中映射的请求，都会映射到Web服务器默认的Servlet中。以Tomcat为例，其<code>/conf/web.xml</code>配置文件中默认的servlet如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.apache.catalina.servlets.DefaultServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>debug<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>0<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>listings<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其描述信息如下，可以看到这个默认的Servlet，是在服务器启动的时候就创建了，<strong>为静态资源请求提供服务</strong>，并且<strong>对于没有指明映射到具体Servlet的所有资源请求，均默认映射到此Servlet</strong>。虽然在servlet-mapping中的路径为“/”，但是优先级较低，即如果指明了映射servlet，就不采用本映射关系。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The default servlet for all web applications, that serves static resources. It processes all requests that are not mapped to other servlets with servlet mappings (defined either here or in your own web.xml file). </span><br></pre></td></tr></table></figure>

<p><strong>此时可以注意到，如果我们在SpringMVC的中央调度器的映射中，如果写“/”会怎样呢？这就会覆盖掉Tomcat原有的Default映射。由于中央调度器没有处理静态资源的能力，所以会出现404错误。</strong></p>
<p>但是，写“/”比较简便，而且不再需要特意写专门的后缀名了。那么该怎么办？怎么做才能既写“/”又能使有web服务器默认的Servlet功能呢？<strong>有如下两种方式</strong>：</p>
<ol>
<li><p>在springmvc配置文件中加入 &lt;mvc: default-servlet-handler /&gt;</p>
<p>这种方法的原理是：加入这个标签后，框架会创建控制器对象DefaultServletHttpRequestHandler（类似我们自己创建的Controller对象），这个对象可以把接收的请求转发给 Tomcat的default这个Servlet，让它来处理请求。（可以看一下源码，有转发的过程）。<strong>注意，这个控制器会将所有的请求都转发给默认的Servlet，但这样就使得@RequestMapping映射失败，此时需要添加2.3.4中的&lt;mvc:annotation-driven&gt;注解驱动，使其正常映射。</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 声明Handler，用于将请求转发到Tomcat的默认Servlet中，注意要保留上面的注解驱动，因为这个Handler会将所有的请求都转发到默认的Servlet中，导致@RequestingMapping注解映射失败 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:default-servlet-handler</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>可以看到这种方式依赖于Web服务器，看它是否具有解决静态资源请求的能力。</strong></p>
</li>
<li><p>在springmvc配置文件中加入&lt;mvc: resources&gt;（<strong>掌握</strong>）</p>
<p>这种方法会创建Spring自带的ResourceHttpRequestHandler，这个处理器会处理静态资源请求，且这个处理器是Spring框架自己实现的，不再依赖于Web服务器。（<strong>注意，该方法仍然需要添加注解驱动</strong>）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 第二种方式解决静态资源访问 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这种方法会创建ResourceHttpRequestHandler处理器，这个处理器是Spring框架自己实现的，用于处理静态资源访问 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mapping表示请求的uri，可以用通配符 ** 表示全部。 比如image/**，表示image下的所有静态资源 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- location表示静态资源在项目中的位置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/image/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/image/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/html/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/html/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/js/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/js/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当然，为了减少标签数量以及便于管理，一般我们将静态资源统一放置到一个根目录下（上述目录作为子目录出现）。如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 第二种方式解决静态资源访问 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这种方法会创建ResourceHttpRequestHandler处理器，这个处理器是Spring框架自己实现的，用于处理静态资源访问 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mapping表示请求的uri，可以用通配符 ** 表示全部。 比如image/**，表示image下的所有静态资源 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- location表示静态资源在项目中的位置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/static/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/static/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-5-路径问题"><a href="#2-5-路径问题" class="headerlink" title="2.5 路径问题"></a>2.5 路径问题</h3><p>这里解释一下前端发送请求的路径问题。比如当前所在页面为<code>http://localhost:8080/springmvc01/index.jsp</code>，在页面中有两个链接，一个连接是<code>show.jsp</code>，另一个连接是<code>/another.jsp</code>。那么一个开头带“/”，一个不带，二者有什么区别呢？不带“/”表示是在当前资源的父路径下寻址，也就是<code>http://localhost:8080/springmvc01/show.jsp</code>，带斜杠则表示在当前主机上寻址（注意不是当前项目路径下），即<code>http://localhost:8080/another.jsp</code>。</p>
<p>也就是说，不带斜杠的可以看成是相对路径，带斜杠的则相当于是绝对路径。<strong>相对路径存在一定的缺陷</strong>，但是带斜杠了，我们需要额外的加上项目名称才能访问，此时不能将项目名写死，可采用EL表达式：<code>$&#123;pageContext.request.contextPath&#125;/another.jsp</code>。</p>
<p>除了采用绝对路径之外，也可以采用&lt;base&gt;标签，默认为不带斜杠的地址加上其指明的base地址。</p>
<h2 id="3-SSM整合开发（重点）"><a href="#3-SSM整合开发（重点）" class="headerlink" title="3. SSM整合开发（重点）"></a>3. SSM整合开发（重点）</h2><p>其实第2部分讲解的就是控制器方法的定义：@RequestMapping注解匹配用户请求，形参列表接收用户参数，方法的返回值类型用于规定框架的后续操作（如转发资源，传递数据等等）。本节讲解SSM三个框架整合开发项目。</p>
<p>其实通过前面的讲解，我们可以发现：</p>
<ol>
<li>SpringMVC负责接收用户端的输入，并将处理结果返回给用户端。（也就是<strong>界面层</strong>）</li>
<li>Spring负责处理核心业务逻辑，管理service、dao、工具类对象，使得整体代码更加逻辑清晰。（也就是<strong>业务层</strong>）</li>
<li>MyBatis负责访问数据库，比JDBC更加简洁。（也就是<strong>持久层</strong>）</li>
</ol>
<p>所以说，这三者在逻辑上是可以融合到一起来开发项目的。总体上来说，<code>用户发起请求---&gt;SpringMVC接收---&gt;调用Spring中的Service对象处理请求---&gt;调用MyBatis处理数据</code>，然后在得到处理结果后，<code>Spring的Service对象将结果发送---&gt;SpringMVC接收---&gt;用户得到结果</code>。</p>
<p>三个框架共有两个容器：</p>
<ol>
<li>SpringMVC容器，管理Controller控制器对象</li>
<li>Spring容器，管理Service，Dao，工具类对象的</li>
</ol>
<p>我们要做的是把使用的对象交给合适的容器来创建和管理。把Controller还有web开发的相关对象交给SpringMVC容器，<strong>这些对象写在SpringMVC配置文件中</strong>。把Service、Dao对象交给Spring容器，<strong>这些对象写在Spring配置文件中</strong>。</p>
<p>其中一个难点就是：两个容器是独立的，而在实际工作过程中，SpringMVC中的控制器对象肯定要调用Spring中的Service来处理用户请求，那么这该怎么做呢？<strong>实际二者之间在Spring框架开发的时候已经确定好了关系，SpringMVC容器是Spring容器的子容器，类似继承。而子可以访问父的内容，所以SpringMVC容器中的控制器对象可以访问Spring容器中的Service对象，从而解决了上述问题。</strong></p>
<p>实现步骤如下所示：</p>
<ol>
<li><p>新建maven web项目</p>
</li>
<li><p>加入依赖</p>
<ol>
<li><p>springmvc</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring mvc 依赖 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>spring</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Spring核心 IoC --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-context --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- AspectJ 外部 AOP --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-aspects --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Spring事务 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-tx --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Spring事务（访问数据库） --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-jdbc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>mybatis</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mybatis依赖 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- mybatis和spring集成的依赖 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis-spring --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>jackson</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- json依赖 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>mysql驱动</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mysql驱动依赖 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>druid连接池</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 阿里提供的数据库连接池 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>servlet、jsp</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- servlet依赖 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- jsp依赖 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp/jsp-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>注意资源文件的编译位置，以及编译插件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 告诉指定的目录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 拷贝的资源文件类型 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 设置过滤器，这里不用设置了，上面相当于设置了 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 避免上述操作覆盖默认设置，这里将默认设置的目录添加 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 告诉指定的目录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 拷贝的资源文件类型 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>*.*<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 设置过滤器，这里不用设置了，上面相当于设置了 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 指定jdk的版本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>写web.xml</p>
<ol>
<li><p>注册<strong>DispatcherServlet</strong>，<strong>目的是创建SpringMVC容器对象以及接受用户请求。</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- SpringMVC相关配置--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 中央调度器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:dispatcherServlet.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>注册Spring的监听器<strong>ContextLoaderListener</strong>，<strong>目的是由框架创建Spring的容器对象，这样才能创建Service、Dao等对象</strong>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Spring相关配置 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 注册Spring监听器 ，并指定自定义的配置文件位置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>注册字符集过滤器，解决post请求乱码的问题</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注册字符集过滤器，解决post请求乱码的问题 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceRequestEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceResponseEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>其实通过这个配置文件可以发现，我们是通过Web服务器的这个配置文件来告诉Web服务器，在启动的时候创建SpringMVC容器、Spring容器，并将各种请求先经过字符集过滤器，然后再全部映射到SpringMVC容器中。（注意，创建这两个容器所需要的配置文件在后续第5部分。）</strong></p>
</li>
<li><p>创建包，Controller包、Service包、Dao包、实体类包</p>
<p>即<code>org.hianian.controller</code>，<code>org.hianian.service</code>，<code>org.hianian.dao</code>，<code>org.hianian.entity</code></p>
</li>
<li><p>写SpringMVC、Spring、MyBatis的配置文件</p>
<ol>
<li><p>springMVC配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">                           https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">                           https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- springmvc的配置文件，用于声明Controller和其他web相关的对象--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 声明组件扫描器，创建Controller对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;org.hianian.controller&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 声明视图解析器，方便资源之间的路径书写 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 声明视图文件的前缀 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 声明视图文件的后缀，即扩展名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 添加注解驱动（方便返回Object等数据类型以及处理静态资源） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>spring配置文件</p>
</li>
<li><p>mybatis主配置文件</p>
</li>
<li><p>数据库的属性配置文件</p>
</li>
</ol>
</li>
<li><p>写业务逻辑实现代码，dao接口和mapper文件，service和实现类，controller，实体类等等</p>
</li>
<li><p>写jsp页面</p>
</li>
</ol>
<p>最终的目录结构如下所示：</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/springmvc/springmvc_007.png" alt="springmvc_007.png (292×613) (gitee.io)"></p>
<h2 id="4-SpringMVC核心技术"><a href="#4-SpringMVC核心技术" class="headerlink" title="4. SpringMVC核心技术"></a>4. SpringMVC核心技术</h2><h3 id="4-1-请求重定向和转发"><a href="#4-1-请求重定向和转发" class="headerlink" title="4.1 请求重定向和转发"></a>4.1 请求重定向和转发</h3><p>在Servlet中，我们介绍过转发和重定向两个操作，Servlet中的代码分别是<code>request.getRequestDispatcher(&quot;xxx.jsp&quot;).forward()</code>和<code>response.sendRedirect(&quot;xxx.jsp&quot;)</code>。</p>
<p>SpringMVC框架将上述两个操作进行了封装，可以使用比较简单的方式实现转发和重定向，直接使用forward和redirect两个关键字即可。<strong>这两个关键字有一个共同的特点：不和视图解析器一同工作（就是说，视图解析器对forward中的路径不起作用）。</strong></p>
<h4 id="4-1-1-转发"><a href="#4-1-1-转发" class="headerlink" title="4.1.1 转发"></a>4.1.1 转发</h4><p>转发forward的语法为：<code>setViewName(&quot;forward:视图文件的完整路径&quot;)</code>，<strong>注意，因为该关键字对视图解析器无效，所以必须写视图资源的完整路径</strong>。其实对于ModelAndView来说，setViewName()方法本质上就是转发，只不过是自动执行的，即<strong>隐式转发</strong>，因为存在视图解析器的原因，所以隐式转发的路径相当于限制死了，不太灵活，如果想要转发到路径之外的资源，则只能采用forward显式转发，无需考虑视图解析器。代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/doForward.do&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSome</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">        mav.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;转到到本页面&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        mav.setViewName(&quot;show&quot;);  // 这里是隐式转发</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 显式转发，注意，此时可以转发到WEB-INF目录下的资源</span></span><br><span class="line">        mav.setViewName(<span class="string">&quot;forward: WEB-INF/view/show.jsp&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-1-2-重定向"><a href="#4-1-2-重定向" class="headerlink" title="4.1.2 重定向"></a>4.1.2 重定向</h4><p>重定向redirect的语法为：<code>setViewName(&quot;redirect: 视图文件的完整路径&quot;)</code>，一些细节和forward一样。<strong>注意，因为重定向是两次请求，两次request作用域，因此重定向后的页面使用EL表达式从request作用域是取不到数据的。框架为了实现两次请求中传递数据，提供了一个功能，就是将ModelAndView中的数据以get请求形式附加到重定向的URL中，此时可以先将第一次的请求数据加入到ModelAndView中，然后在重定向页面中利用EL表达式从URL中取数据。</strong></p>
<p><strong>注意，重定向仍然不能访问WEB-INF目录下的资源。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/doRedirect.do&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doRedirect</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注意，addObject是将数据放到了request作用域中，而重定向是客户端再次发起请求，两次不是同一个作用域，</span></span><br><span class="line">        <span class="comment">// 在hello.jsp中，使用转发页面中的EL表达式只能从request作用域中取数据（而重定向是两次请求request作用域）</span></span><br><span class="line">        <span class="comment">// 因此在重定向的页面中使用EL表达式是请求不到第一次请求的数据的。</span></span><br><span class="line">        <span class="comment">// 但是，框架会提供一个功能，就是将本次addObject中添加的数据，作为请求的参数附加到重定向的再次请求中。</span></span><br><span class="line">        <span class="comment">// 可以在url中看到，</span></span><br><span class="line">        <span class="comment">// http://localhost:8080/springmvc05/hello.jsp?msg=重定向到本页面</span></span><br><span class="line">        <span class="comment">// 所以这个目的就是为了两次请求之间可以传递数据</span></span><br><span class="line">        <span class="comment">// 注意，需要使用param.EL表达式从url中取数据。</span></span><br><span class="line">        mav.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;重定向到本页面&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重定向</span></span><br><span class="line">        mav.setViewName(<span class="string">&quot;redirect:/hello.jsp&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-异常处理"><a href="#4-2-异常处理" class="headerlink" title="4.2 异常处理"></a>4.2 异常处理</h3><p>任何程序都有可能发生异常，因此，任何程序都要处理异常。一个项目在代码方面是比较复杂的，所以要处理异常的位置也是比较多的；另一方面，项目是不断更新迭代的，那么异常也就需要可能时刻改变。<strong>这样一来，异常这种和项目功能业务逻辑并无太多关系的代码，从某种角度来说，是没有必要的，相当于附加功能。此时可以利用切面的思想，即AOP。将异常代码抽取出来，作为切面加入到项目中。从另一个角度来说，就是将异常代码统一管理，方便修改。</strong>也被称为<strong>统一全局异常处理。</strong></p>
<p>SpringMVC框架提供了<code>@ExceptionHandler</code>和<code>@ControllerAdvice</code>两个注解来实现异常代码统一管理。其实从注解的名字就可以看出来，@ControllerAdvice注解，就是控制器增强，相当于给控制器增加额外的功能，即切面；@ExceptionHandler注解，则是具体的异常处理功能。</p>
<p>异常处理有如下步骤：</p>
<ol>
<li><p>新建maven web项目</p>
</li>
<li><p>加入依赖</p>
</li>
<li><p>新建一个自定义异常类 MyUserException，再定义它的子类NameException，AgeException</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义异常，用于其他异常继承</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyUserException</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyUserException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyUserException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义异常，当用户姓名有异常，抛出NameException</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NameException</span> <span class="keyword">extends</span> <span class="title">MyUserException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NameException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NameException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义异常类，当Age出现异常时，抛出AgeException</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AgeException</span> <span class="keyword">extends</span> <span class="title">MyUserException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AgeException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AgeException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在Controller类抛出NameException、AgeException异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/Some.do&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doSome</span><span class="params">(String name, Integer age)</span> <span class="keyword">throws</span> MyUserException </span>&#123;</span><br><span class="line"></span><br><span class="line">        ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据请求参数的值，抛出异常。</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果姓名不是张三，抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="string">&quot;zhangsan&quot;</span>.equals(name)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NameException(<span class="string">&quot;姓名不正确！！！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果年龄为null或者大于80，抛出AgeException</span></span><br><span class="line">        <span class="keyword">if</span>( age == <span class="keyword">null</span> || age &gt; <span class="number">80</span> ) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AgeException(<span class="string">&quot;年龄比较大！！！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        mav.addObject(<span class="string">&quot;myname&quot;</span>, name);</span><br><span class="line">        mav.addObject(<span class="string">&quot;myage&quot;</span>, age);</span><br><span class="line"></span><br><span class="line">        mav.setViewName(<span class="string">&quot;show&quot;</span>);  <span class="comment">// 这里是隐式转发</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意，我们只需抛出异常即可，无需处理异常。</strong></p>
</li>
<li><p>创建一个普通类，作为全局异常处理类。</p>
<ol>
<li><p>这个类的上面要加入@ControllerAdvice注解</p>
</li>
<li><p>类中定义方法，方法的上面要加入@Exceptionhandler注解</p>
<p>这个方法，和Controller处理用户请求的方法的定义一样，返回值以及参数列表等等。<strong>该注解用于声明发生哪类异常时，采用本方法来处理。属性值即为规定的异常类</strong></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义全局异常处理类，需要添加两个注解</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义方法，处理发生的异常</span></span><br><span class="line">    <span class="comment">// 形参为Exception，表示Controller中抛出的异常对象；方法体可以通过形参获取发生的异常信息。</span></span><br><span class="line">    <span class="comment">// 注解属性值为哪个异常类型，表示发生该类异常时，交给该方法来处理</span></span><br><span class="line">    <span class="meta">@ExceptionHandler( value = NameException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doNameException</span><span class="params">(Exception ex)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 处理NameException的异常</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 异常发生处理逻辑：</span></span><br><span class="line">        <span class="comment">// 1. 需要把异常记录下来，记录到数据库，日志文件。记录日志发生的时间，哪个方法发生的，异常的错误内容等等。</span></span><br><span class="line">        <span class="comment">// 2. 发送通知，把异常的信息通过邮件，短信，微信等发送给相关人员。</span></span><br><span class="line">        <span class="comment">// 3. 给用户友好的提示</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这里为了简单起见，仅做第三步</span></span><br><span class="line">        ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">        mav.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;姓名必须是zhangsan，其他用户不能访问&quot;</span>);</span><br><span class="line">        mav.addObject(<span class="string">&quot;ex&quot;</span>, ex);</span><br><span class="line"></span><br><span class="line">        mav.setViewName(<span class="string">&quot;nameError&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler( value = AgeException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doAgeException</span><span class="params">(Exception ex)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 处理NameException的异常</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 异常发生处理逻辑：</span></span><br><span class="line">        <span class="comment">// 1. 需要把异常记录下来，记录到数据库，日志文件。记录日志发生的时间，哪个方法发生的，异常的错误内容等等。</span></span><br><span class="line">        <span class="comment">// 2. 发送通知，把异常的信息通过邮件，短信，微信等发送给相关人员。</span></span><br><span class="line">        <span class="comment">// 3. 给用户友好的提示</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这里为了简单起见，仅做第三步</span></span><br><span class="line">        ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">        mav.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;年龄不能大于80&quot;</span>);</span><br><span class="line">        mav.addObject(<span class="string">&quot;ex&quot;</span>, ex);</span><br><span class="line"></span><br><span class="line">        mav.setViewName(<span class="string">&quot;ageError&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理其他类型的未知异常</span></span><br><span class="line">    <span class="comment">// 后面不需要添加value，即去除掉前面匹配的异常方法之后，如果都没有匹配，那么就会到本方法中来处理该异常</span></span><br><span class="line">    <span class="comment">// 因此，如果@ExceptionHandler注解，没有value值的方法，只能有一个。</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">doOtherException</span><span class="params">(Exception ex)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 处理NameException的异常</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 异常发生处理逻辑：</span></span><br><span class="line">        <span class="comment">// 1. 需要把异常记录下来，记录到数据库，日志文件。记录日志发生的时间，哪个方法发生的，异常的错误内容等等。</span></span><br><span class="line">        <span class="comment">// 2. 发送通知，把异常的信息通过邮件，短信，微信等发送给相关人员。</span></span><br><span class="line">        <span class="comment">// 3. 给用户友好的提示</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这里为了简单起见，仅做第三步</span></span><br><span class="line">        ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"></span><br><span class="line">        mav.addObject(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;发生其他异常&quot;</span>);</span><br><span class="line">        mav.addObject(<span class="string">&quot;ex&quot;</span>, ex);</span><br><span class="line"></span><br><span class="line">        mav.setViewName(<span class="string">&quot;defaultError&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mav;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意，为了方便，尽量设置一个默认异常，用于处理所有未声明处理的异常类型。</strong></p>
</li>
<li><p>创建处理异常的视图页面（用于向用户展示出现了异常）</p>
<p>创建上述三类异常的视图页面（注意，已经配置了视图解析器）。</p>
</li>
<li><p>创建SpringMVC的配置文件</p>
<ol>
<li>组件扫描器，扫描@Controller注解</li>
<li><strong>组件扫描器，扫描@ControllerAdvice所在的包名</strong></li>
<li><strong>声明注解驱动</strong></li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 处理异常，需要的两步 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 声明组件扫描器，扫描@ControllerAdvice类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;org.hianian.handler&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 声明注解驱动 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>可以看到，我们只是抛出可能发生的异常（而以往，则是在可能发生异常的位置进行处理），然后由框架进行映射，找到处理异常的类和方法（全局统一异常处理）。使得业务逻辑代码和异常处理代码进行解耦合，从另一个角度来看，异常处理代码是作为一个切面来插入到业务逻辑代码中的。</strong></p>
<h3 id="4-3-拦截器"><a href="#4-3-拦截器" class="headerlink" title="4.3 拦截器"></a>4.3 拦截器</h3><p>拦截器在框架中是一类比较重要的对象，这类对象需要实现框架中的一个接口（HandlerInterceptor），<strong>实现了这个接口的类对象都被称为拦截器。</strong>此前我们听过过滤器，监听器等等。<strong>过滤器是为了过滤请求参数，设置编码字符集等工作的；监听器是为了监听某个事件的发生来执行特定的动作，而拦截器则是为了拦截用户请求的，对请求做预先的判断处理操作。</strong></p>
<p>拦截器是全局的，可以对多个Controller做拦截，<strong>一个项目中可以有0个、1个和多个拦截器</strong>，他们在一起来拦截用户的请求。<strong>拦截器常用在：用户登录处理，权限检查，记录日志等等</strong>。</p>
<p>拦截器的使用步骤：</p>
<ol>
<li><p>定义类，实现HandlerInterceptor接口，实现接口中的三个方法（三个方法表示三个执行时间点）；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 该方法可以控制处理器方法是否被执行，return false表示处理器方发布会被执行</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>preHandle()方法是预处理方法，即在处理请求之前执行的操作，即控制器方法执行之前执行。三个参数分别是请求对象、响应对象、控制器对象Controller。方法的返回值是布尔值。<strong>可以在这个方法中获取请求的信息，验证请求是否符合要求，验证用户是否登录等等。如果验证失败（return false），可以截断请求，请求不能被控制器方法处理；如果验证成功（return true），可以放行请求，此时控制器方法才能执行。</strong></p>
<p>当然，如果想要提示用户，也可利用request对象来进行转发到其他提示的资源页面。</p>
</li>
<li><p>postHandle()方法是后处理方法，即在控制器方法执行之后执行的操作。参数分别是请求对象、响应对象、控制器对象Controller以及处理器方法的返回值ModelAndView对象。<strong>可以在这个方法中修改处理器方法的返回结果，即对处理器方法的执行结果进行二次修正。</strong>（了解）</p>
</li>
<li><p>afterCompletion()方法是请求处理完成后方法，即<strong>视图处理完成后，即对视图执行了forward操作，已经将结果返回给了用户</strong>。参数分别是请求对象、响应对象、控制器对象以及程序中发生的异常对象Exception。<strong>这个方法是程序最后执行的方法，一般是进行资源回收操作，删除、清空内存。</strong>（了解）</p>
</li>
</ol>
</li>
<li><p>在SpringMVC的配置文件中，声明拦截器，让框架知道拦截器的存在。</p>
</li>
</ol>
<p>那拦截器什么时候起作用呢，其执行时间可以是：</p>
<ol>
<li><strong>在处理请求之前</strong>，也就是Controller类中的方法执行之前先被拦截；</li>
<li><strong>在控制器方法执行之后</strong>，也会执行拦截器；（<strong>注意，控制器方法执行结束，并不代表请求处理完成了。</strong>）</li>
<li><strong>在请求处理完成后</strong>也会执行拦截器。</li>
</ol>
<p>使用拦截器有如下步骤：</p>
<ol>
<li><p>新建maven web项目</p>
</li>
<li><p>加入依赖</p>
</li>
<li><p>创建Controller类</p>
</li>
<li><p>创建一个普通类，作为拦截器使用</p>
<ol>
<li>实现HandlerInteceptor接口</li>
<li>实现接口中的三个方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义拦截器类，拦截用户的请求</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;拦截器MyInterceptor的preHandle方法&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;拦截器的MyInterceptor的postHandle方法&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改处理器方法返回的结果</span></span><br><span class="line">        modelAndView.addObject(<span class="string">&quot;myname&quot;</span>, <span class="string">&quot;修改了处理器方法返回的结果&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;拦截器的MyInterceptor的afterCompletion方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>创建show.jsp</p>
</li>
<li><p>创建SpringMVC的配置文件</p>
<ol>
<li><p>组件扫描器，扫描@Controller注解</p>
</li>
<li><p>声明拦截器，并指定拦截的请求url地址（即指明拦截哪些请求）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 声明拦截器：拦截器可以有0个或多个 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 声明一个拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 声明拦截的请求uri地址，可以使用通配符 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 声明拦截器对象 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.hianian.handler.MyInterceptor&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<p><strong>因此，添加拦截器的步骤比较简单，创建拦截器类，实现想要执行的方法，然后再配置文件中进行url和拦截器映射即可。感觉和异常处理类似，是作为切面功能加入到业务逻辑代码中的。实际上，preHandle方法是整个项目的入口，因为是先执行该方法的，只有该方法返回true，才会进而执行控制器中的方法。即拦截器可以看成是多个Controller中共用的功能，集中抽取出来统一处理。</strong></p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/springmvc/springmvc_008.png" alt="springmvc_008.png (1159×474) (gitee.io)"></p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/springmvc/springmvc_009.png" alt="springmvc_009.png (588×270) (gitee.io)"></p>
<h4 id="4-3-1-多个拦截器"><a href="#4-3-1-多个拦截器" class="headerlink" title="4.3.1 多个拦截器"></a>4.3.1 多个拦截器</h4><p>可以声明多个拦截器，拦截器的执行顺序和声明顺序有关，<strong>先声明的拦截器，先执行。注意，这里相当于是栈，因为拦截器存在三个方法，分别在三个时间点执行。此时，又因为先声明的拦截器先执行。所以以拦截器A、B为例，A拦截器的preHandle()方法先执行，然后B拦截器的preHandle方法再执行。之后B拦截器的postHandle()方法执行，A拦截器的postHandle()方法执行。最后B拦截器的afterCompletion()方法执行，A拦截器的afterCompletion()方法执行。</strong></p>
<p>如下所示：</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/springmvc/springmvc_010.png" alt="springmvc_010.png (938×411) (gitee.io)"></p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/springmvc/springmvc_011.png" alt="springmvc_011.png (633×631) (gitee.io)"></p>
<h4 id="4-3-2-拦截器和过滤器"><a href="#4-3-2-拦截器和过滤器" class="headerlink" title="4.3.2 拦截器和过滤器"></a>4.3.2 拦截器和过滤器</h4><p>二者有以下区别：</p>
<ol>
<li>过滤器是Servlet规范中的对象，拦截器是框架中的对象；</li>
<li>过滤器实现了Filter接口，而拦截器实现了HandlerInterceptor</li>
<li>过滤器用来设置request，response的参数、属性的，侧重对数据过滤的；而拦截器则是用来验证请求的，能截断请求，以及对响应内容进行修改。</li>
<li>过滤器是在拦截器之前先执行的。</li>
<li>过滤器是Tomcat服务器创建的对象，拦截器是SpringMVC容器中创建的对象。</li>
<li>过滤器只有一个执行时间点，而拦截器有三个执行时间点。</li>
<li><strong>过滤器可以处理jsp，js，html等等；而拦截器侧重拦截对Controller的请求（即只能处理被中央处理器接收的请求）</strong>。</li>
</ol>
<p><strong>拦截器实现登录验证，验证登录的用户是否符合要求，符合要求则允许登录，否则，禁止登录。</strong>步骤如下所示：</p>
<ol>
<li><p>新建maven项目</p>
</li>
<li><p>修改web.xml配置文件注册中央调度器</p>
</li>
<li><p>新建index.jsp发起请求</p>
</li>
<li><p>创建Controller处理请求</p>
</li>
<li><p>创建结果show.jsp</p>
</li>
<li><p>创建一个login.jsp，模拟登录（把用户的信息放入到session）；创建logout.jsp，模拟退出系统（从session中删除用户信息）</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    模拟登录，zhangsan登录系统</span><br><span class="line">    &lt;%</span><br><span class="line">        session.setAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">    %&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    模拟退出，zhangsan退出系统</span><br><span class="line">    &lt;%</span><br><span class="line">        session.removeAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    %&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>创建拦截器，从session中获取用户的登录数据，验证能否访问系统。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义拦截器类，拦截用户的请求</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证用户的登录信息，正确return true，否则return false</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;拦截器MyInterceptor的preHandle方法&quot;</span>);</span><br><span class="line"></span><br><span class="line">        String logName = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        Object name = request.getSession().getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(name != <span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">            logName = (String) name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="string">&quot;zhangsan&quot;</span>.equals(logName)) &#123;</span><br><span class="line"></span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/tips.jsp&quot;</span>).forward(request, response);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>创建一个验证的jsp，如果验证视图，给出提示</p>
</li>
<li><p>创建springmvc配置文件，声明组件扫描器、声明拦截器。</p>
</li>
</ol>
<h2 id="5-备注"><a href="#5-备注" class="headerlink" title="5. 备注"></a>5. 备注</h2><p><em>参考B站《动力节点》。</em></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">浮云</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://ihianian.github.io/2022/02/14/JavaWeb-15-SpringMVC/">https://ihianian.github.io/2022/02/14/JavaWeb-15-SpringMVC/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">浮云</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/JavaWeb/">
                                    <span class="chip bg-color">JavaWeb</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/null" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/null" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/02/19/LeetCode-05-ContainerWithMostWater/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="LeetCode_05_ContainerWithMostWater">
                        
                        <span class="card-title">LeetCode_05_ContainerWithMostWater</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-02-19
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            浮云
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/LeetCode/">
                        <span class="chip bg-color">LeetCode</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/02/14/JavaWeb-14-Spring/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/12.jpg" class="responsive-img" alt="JavaWeb_14_Spring">
                        
                        <span class="card-title">JavaWeb_14_Spring</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-02-14
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            浮云
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/JavaWeb/">
                        <span class="chip bg-color">JavaWeb</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2022</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">hianian</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">382.1k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">














    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
