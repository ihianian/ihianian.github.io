<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="JavaWeb_07_Servlet, ihianian">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>JavaWeb_07_Servlet | ihianian</title>
    <link rel="icon" type="image/png" href="/header.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/header.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">ihianian</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/404" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/404" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/header.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">ihianian</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/404" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/404" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/22.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">JavaWeb_07_Servlet</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/JavaWeb/">
                                <span class="chip bg-color">JavaWeb</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-01-01
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-01-19
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    23.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    94 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>前面讲解了Tomcat服务器的配置和初步使用，那么它怎么和Java程序交互呢？本文讲解二者的交互标准Servlet规范。</p>
<h2 id="1-模拟Servlet本质"><a href="#1-模拟Servlet本质" class="headerlink" title="1. 模拟Servlet本质"></a>1. 模拟Servlet本质</h2><p>Servlet和JDBC一样，是SUN公司制定的一套标准规范，为了更容易理解Servlet，首先手动模拟一下Servlet本质。前面文章中提到，<strong>Servlet本质上是Java提供的接口，而WEB Server厂商负责调用这个接口为浏览器提供服务，这时候，我们只实现这个接口所需要的功能，以及请求路径和实现类之间的对应关系，用于WEB服务器的动态资源定位</strong>。<strong>所以，模拟Servlet涉及到的角色：</strong></p>
<ul>
<li>充当SUN公司的角色，指定Servlet规范；<ul>
<li>public interface Servlet</li>
</ul>
</li>
<li>充当Tomcat服务器的开发者；<ul>
<li>public class Tomcat</li>
</ul>
</li>
<li><strong>充当webapp的开发者</strong>；<ul>
<li>public class UerListServlet implements Servlet</li>
<li>public class UserLoginServlet implements Servlet</li>
<li>public class BankServlet implements Servlet</li>
<li><strong>请求路径和动态资源文件的对应关系  配置文件。</strong></li>
</ul>
</li>
</ul>
<h3 id="1-1-充当SUN公司的角色"><a href="#1-1-充当SUN公司的角色" class="headerlink" title="1.1 充当SUN公司的角色"></a>1.1 充当SUN公司的角色</h3><p>SUN公司主要是制定Servlet接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 充当SUN公司，制定接口，提供服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">service</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-2-充当Tomcat服务器的角色"><a href="#1-2-充当Tomcat服务器的角色" class="headerlink" title="1.2 充当Tomcat服务器的角色"></a>1.2 充当Tomcat服务器的角色</h3><p>Tomcat服务器负责接收浏览器传过来的请求，根据不同的请求，定位不同的资源文件（这里以动态资源文件为例），对于动态资源，会创建类对象，然后执行程序，获得结果，并返回给浏览器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 充当Tomcat服务器的开发者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tomcat</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, IllegalAccessException, InstantiationException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Tomcat 服务器启动成功，开始接收用户的访问。&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用Scanner模拟用户的请求</span></span><br><span class="line">        <span class="comment">// 用户访问服务器是通过浏览器上的“请求路径”</span></span><br><span class="line">        <span class="comment">// 也就是说用户请求路径不同，后台执行的Servlet不同。</span></span><br><span class="line">        <span class="comment">// /bank    BankServlet</span></span><br><span class="line">        <span class="comment">// /login   UserLoginServlet</span></span><br><span class="line">        <span class="comment">// /list    UserListServlet</span></span><br><span class="line">        System.out.print(<span class="string">&quot;请输入您的访问路径：&quot;</span>);</span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        String path = scanner.nextLine();</span><br><span class="line">        System.out.println(path);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 此时Tomcat已经获取到了用户的请求路径</span></span><br><span class="line">        <span class="comment">// Tomcat服务器应该通过用户的请求路径找对应的Servlet实现功能类</span></span><br><span class="line">        <span class="comment">// 请求路径和实现功能类之间的关系应该由谁来指定呢？二者之间应该有对照关系。</span></span><br><span class="line">        <span class="comment">// 由webapp的开发人员通过配置文件来指定对应关系</span></span><br><span class="line">        FileReader reader = <span class="keyword">new</span> FileReader(<span class="string">&quot;src/servlet/web.properties&quot;</span>);</span><br><span class="line">        Properties pro = <span class="keyword">new</span> Properties();</span><br><span class="line">        pro.load(reader);</span><br><span class="line">        reader.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取对应的动态资源文件名</span></span><br><span class="line">        String ClassName = pro.getProperty(path);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过反射机制创建类对象</span></span><br><span class="line">        Class clazz = Class.forName(ClassName);</span><br><span class="line">        Object obj = clazz.newInstance();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 实现类都实现了Servlet，并且实现了的抽象方法，所以Tomcat直接创建类对象，然后调用该接口，获得结果即可。</span></span><br><span class="line">        Servlet servlet = (Servlet)obj;</span><br><span class="line">        servlet.service();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-3-充当webapp的开发者"><a href="#1-3-充当webapp的开发者" class="headerlink" title="1.3 充当webapp的开发者"></a>1.3 充当webapp的开发者</h3><p>webapp的开发者主要是实现具体的功能，这些功能类都实现了Servlet接口，另外，也需要将请求路径和功能实现类对应起来。</p>
<p>三个功能类如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 充当webapp开发者，写程序，实现用户登录功能</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserLoginServlet</span> <span class="keyword">implements</span> <span class="title">Servlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserLoginServlet service...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 充当webapp开发者，写程序，实现查询用户列表功能</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UerListServlet</span> <span class="keyword">implements</span> <span class="title">Servlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserListServlet...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 充当webapp开发者，写程序，实现银行功能。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BankServlet</span> <span class="keyword">implements</span> <span class="title">Servlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Bank service...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应关系的配置文件（web.properties）如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/bank=servlet.BankServlet</span><br><span class="line">/login=servlet.UserLoginServlet</span><br><span class="line">/list=servlet.UserLoginServlet</span><br></pre></td></tr></table></figure>

<h3 id="1-4-总结"><a href="#1-4-总结" class="headerlink" title="1.4 总结"></a>1.4 总结</h3><p>通过上述分析，对于webapp程序员来说，只需要编写功能类实现Servlet接口，将编写的类和请求路径对应起来（设置配置文件）。</p>
<p><strong>注意，因为Tomcat已经是写死的，即上面的读取文件的文件名以及解析格式对于我们来说，都是不能改动的，所以Tomcat给程序员提供了配置文件的具体路径、名称以及具体的配置格式。</strong></p>
<ul>
<li>配置文件的文件名是固定的</li>
<li>配置文件的存放路径是固定的</li>
<li>格式也是固定的</li>
</ul>
<p>严格以上来说Servlet其实并不是简单的一个接口，Servlet规范中规定了：</p>
<ul>
<li>一个合格的webapp应该是一个怎样的目录结构</li>
<li>一个合格的webapp应该有一个怎样的配置文件</li>
<li>一个合格的webapp配置文件路径应该放在哪里</li>
<li>一个合格的webapp中Java程序应该放在哪里</li>
<li>这些都是Servlet规范中规定的。</li>
</ul>
<p>Tomcat服务器要遵循Servlet规范，JavaEE程序员也要遵循这个Servlet规范，这样二者才能解耦合，即webapp可以随意放在任何一个WEB服务器上。</p>
<h2 id="2-开发第一个Servlet"><a href="#2-开发第一个Servlet" class="headerlink" title="2. 开发第一个Servlet"></a>2. 开发第一个Servlet</h2><p>上面模拟了Servlet的本质，接下来具体开发一个带有Servlet的webapp。建议的开发步骤如下所示：</p>
<ol>
<li><p>在Tomcat的安装目录下的webapps目录下新建一个目录，起名crm（这个crm就是项目的名字）。<strong>注意，这个crm就是这个项目的根目录。</strong></p>
</li>
<li><p>在这个根目录下新建一个目录：<strong>WEB-INF</strong>，注意，这个目录的名字是Servlet规范中规定的，必须全部大写，必须一模一样。（<strong>注意，静态资源文件html必须放在WEB-INF目录之外。</strong>）</p>
</li>
<li><p>在<strong>WEB-INF</strong>目录下新建一个目录：<strong>classes</strong>，注意，这个目录的名字也是Servlet规范中规定的，另外这个目录下存放的是Java程序编译之后的class文件。</p>
</li>
<li><p>在<strong>WEB-INF</strong>目录下新建一个目录：<strong>lib</strong>，注意，<strong>这个目录不是必须的</strong>，但是如果一个webapp需要第三方的jar包的话，这个jar包必须存放在这个目录下，这个目录的名字也是Servlet规范中规定的。例如Java语言连接数据库所需要的Jar包，就一定要放到这个lib目录下。</p>
</li>
<li><p>在<strong>WEB-INF</strong>目录下新建一个文件：<strong>web.xml</strong>，注意，<strong>这个文件是必须的</strong>，文件名也是Servlet规范中规定的。<strong>这个文件就是配置文件，描述了请求路径和Servlet类之间的对照关系</strong>。另外，这个文件最好是从被的项目中拷贝，否则自己写比较麻烦，只需要修改一些对应关系即可。</p>
</li>
<li><p>编写Java程序，必须实现Servlet接口。<strong>这个接口不是Java SE中的，所以不再JDK中，属于Java EE。</strong>但是因为Tomcat需要使用这个接口，所以Tomcat中应该就已经包含了这个接口，<strong>在安装目录中的lib文件夹内有对应的Jar包，将该Jar包配置到ClassPath中即可</strong>。注意，配置这个Jar包和Tomcat运行没有任何关系，只是为了编译生成class文件，Tomcat自身有配置文件，可以自己找到自己安装目录下的jar包。</p>
<p><strong>注意，这个Java程序可以在任意位置编写，只需要将对应的编译后的class文件放到WEB-INF目录下的classes子文件夹下即可。</strong></p>
</li>
<li><p>将编译后的class文件拷贝到classes子文件夹下。</p>
</li>
<li><p>编写web.xml文件，将请求路径和Servlet实现类关联在一起。学名叫<strong>注册</strong>。</p>
</li>
<li><p>启动Tomcat，启动浏览器，请求上述的URL并测试。</p>
</li>
</ol>
<p>注意：</p>
<blockquote>
<p>JavaEE目前最高版本是JavaEE8，JavaEE被Oracle捐献给Apache了，Apache将JavaEE改名为JakartaEE，所以JavaEE8版本升级后的JaavEE9编程了JakartaEE9。所以最新版本的Tomcat10，在lib目录下的Jar包解压后，不再是Javax了，而是Jakarta。所以，包名需要修改。<code>javax.servlet</code>包修改为<code>jakarta.servlet</code>，这时候Tomcat9及以前的版本部署的项目就不能部署到Tomcat10上了，需要修改导入的包名。</p>
</blockquote>
<p>Servlet接口主要有5个抽象方法，具体的描述后续再说，这里先简单实现一下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 第一个Servlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">implements</span> <span class="title">Servlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;My First Servlet: Hello Servlet&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将编译好后的class文件（包括其所在包）复制到classes文件夹下。接下来配置映射文件web.xml。其关键内容如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee</span></span></span><br><span class="line"><span class="string"><span class="tag">                      http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">metadata-complete</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>和html一样，根标签是&lt;web-app&gt;，只需要在其内部嵌套映射标签即可。这步目的是将class文件和请求路径对应起来。所以需要有class文件的路径以及请求路径，二者需要一个名字，将两个映射起来。完整的配置如下所示（<strong>注意，似乎运行的时候，配置文件中不能有中文，所以下面的中文是为了注释。</strong>）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee</span></span></span><br><span class="line"><span class="string"><span class="tag">                      http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">metadata-complete</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Servlet描述信息 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 一个servlet对应一个servlet-mapping --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet_hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">&lt;!-- 带有包名的全限定类名 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- Servlet映射信息 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">&lt;!-- 这里的name也是随便写，就是将描述信息和映射信息对应起来，所以要和描述信息中的name一致 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet_hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">&lt;!-- 这里的路径就是将来浏览器的请求路径，随便写，但是要以 / 开始 --&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/asdf/qwer/zxcv<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置好后打开Tomcat进行测试，如下所示，在Tomcat的命令行中确实打印了对应的内容（<strong>注意，URL中的请求路径后缀一定和web.xml中的url-pattern中的路径一致</strong>）：</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_001.png" alt="servlet_001.png (948×678) (gitee.io)"></p>
<p>为了方便测试，也可以新建一个静态资源文件html（注意，是在WEB-INF外面），里面的超链接中设置对应的请求路径即可，如下所示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>first-servlet<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/FirstServlet/asdf/qwer/zxcv&quot;</span>&gt;</span>测试第一个Servlet<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_002.png" alt="servlet_002.png (817×791) (gitee.io)"></p>
<p>综上所述，一个合法的webapp项目目录结构应该如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">webapproot</span><br><span class="line">	|------WEB-INF</span><br><span class="line">		|------classes（存放字节码）</span><br><span class="line">		|------lib（第三方Jar包）</span><br><span class="line">		|------web.xml（注册Servlet）</span><br><span class="line">	|------html</span><br><span class="line">	|------css</span><br><span class="line">	|------javascript</span><br><span class="line">	|------image</span><br><span class="line">	......</span><br></pre></td></tr></table></figure>

<p>上述是将信息打印到Tomcat服务器的控制台上，那么怎么将信息输出到浏览器上呢？需要调用ServletResponse对象的相关方法，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 第一个Servlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">implements</span> <span class="title">Servlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException</span>&#123;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;My First Servlet: Hello Servlet&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// response表示响应，从服务器向浏览器发送数据叫做响应，该接口的getWriter方法返回一个PrintWriter对象。</span></span><br><span class="line">        <span class="comment">// 这个对象是一个IO流，Tomcat负责该流的刷新和关闭，我们不需要关注。</span></span><br><span class="line">        <span class="comment">// 设置响应内容的类型，可以是文本，也可以是html，注意，设置响应内容的类型的语法一定要在获取流对象前之前有效，另外也可以设置文本的编码格式</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取响应流对象</span></span><br><span class="line">        PrintWriter out = response.getWriter();</span><br><span class="line"></span><br><span class="line">        out.print(<span class="string">&quot;HelloServlet, you are my first servlet&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_003.png" alt="servlet_003.png (685×131) (gitee.io)"></p>
<p><strong>上述是服务器向浏览器返回了一段文本，但是浏览器实际上是可以识别html代码的，所以可以测试一下返回一段代码，查看浏览器是否会编译。</strong>修改内容如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">out.print(<span class="string">&quot;&lt;br&gt;&lt;input type=&#x27;button&#x27; value=&#x27;button from tomcat&#x27;&gt;&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_004.png" alt="servlet_004.png (629×130) (gitee.io)"></p>
<h3 id="2-1-servlet编写JDBC连接数据库"><a href="#2-1-servlet编写JDBC连接数据库" class="headerlink" title="2.1 servlet编写JDBC连接数据库"></a>2.1 servlet编写JDBC连接数据库</h3><p><strong>注意，要将JDBC的Jar包放入webapp项目的lib中。</strong>简单例子如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet编写JDBC连接数据库</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectJDBC</span> <span class="keyword">implements</span> <span class="title">Servlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// response表示响应，从服务器向浏览器发送数据叫做响应，该接口的getWriter方法返回一个PrintWriter对象。</span></span><br><span class="line">        <span class="comment">// 这个对象是一个IO流，Tomcat负责该流的刷新和关闭，我们不需要关注。</span></span><br><span class="line">        <span class="comment">// 设置响应内容的类型，可以是文本，也可以是html</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        PrintWriter out = response.getWriter();</span><br><span class="line">        </span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 注册驱动</span></span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取连接</span></span><br><span class="line">            String user = <span class="string">&quot;user&quot;</span>;</span><br><span class="line">            String password = <span class="string">&quot;password&quot;</span>;</span><br><span class="line">            String url = <span class="string">&quot;jdbc:mysql://ip:3306/mysql_test&quot;</span>;</span><br><span class="line">            conn = DriverManager.getConnection(url, user, password);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取预编译的数据库操作对象</span></span><br><span class="line">            String sql = <span class="string">&quot;select * from t_user&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 执行SQL</span></span><br><span class="line">            rs = ps.executeQuery();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 处理结果</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">                out.print(<span class="string">&quot;no: &quot;</span> + rs.getString(<span class="string">&quot;no&quot;</span>) + <span class="string">&quot;;&quot;</span> + </span><br><span class="line">                        <span class="string">&quot;login: &quot;</span> + rs.getString(<span class="string">&quot;login&quot;</span>) + <span class="string">&quot;;&quot;</span> + <span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="comment">// 释放资源</span></span><br><span class="line">            <span class="keyword">if</span>(rs != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    rs.close();</span><br><span class="line">                &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(ps != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    ps.close();</span><br><span class="line">                &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// out.print(&quot;HelloServlet, you are my first servlet&quot;);</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新增xml映射如下所示：</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_006.png" alt="servlet_006.png (641×217) (gitee.io)"></p>
<p>数据库中的表如下所示：</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_007.png" alt="servlet_007.png (448×236) (gitee.io)"></p>
<p>结果如下所示：</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_005.png" alt="servlet_005.png (528×127) (gitee.io)"></p>
<h3 id="2-2-IDEA编写Servlet"><a href="#2-2-IDEA编写Servlet" class="headerlink" title="2.2 IDEA编写Servlet"></a>2.2 IDEA编写Servlet</h3><p>上述只是手动在文本编辑器中实现了Servlet，但是这样做很麻烦，每次都需要手动编译java文件，然后将class文件放到classes目录中，可以采用IDEA工具进行Servlet开发。<strong>之前在上一篇文章中已经叙述了IDEA的配置过程，这里不再赘述。</strong></p>
<p>这里还需要的就是：</p>
<ul>
<li>编写Servlet程序</li>
<li>手动将需要的Jar包放入到新建的lib目录中；</li>
<li>在web.xml中注册配置信息；</li>
<li>手动创建一些静态资源，比如HTML（这一步需要在Web目录下，即webapp根目录下）。</li>
<li><strong>但是真正的项目名在哪里呢？</strong>（项目名需要在Edit Configuration中写）</li>
</ul>
<h2 id="3-Servlet接口及其对象的生命周期"><a href="#3-Servlet接口及其对象的生命周期" class="headerlink" title="3. Servlet接口及其对象的生命周期"></a>3. Servlet接口及其对象的生命周期</h2><blockquote>
<p>什么是Servlet对象生命周期？</p>
<ul>
<li>Servlet对象什么时候被创建</li>
<li>Servlet对象什么时候被销毁</li>
<li>Servlet对象创建了几个？</li>
<li>Servlet对象的生命周期表示：一个Servlet对象从出生到最后的死亡，整个过程是怎样的。</li>
</ul>
<p>其实在上面的例子中可以看到，程序员只需要编写Servlet的实现类即可，至于对象的创建、方法的调用以及对象的销毁都是由Tomcat自己操作的（可参考第一部分，模拟Servlet本质）。</p>
<ul>
<li>Servlet对象的生命周期是由Tomcat服务器（WEB Server）全权负责的。</li>
<li><strong>Tomcat服务器通常我们又称为：WEB容器</strong>。</li>
</ul>
<p>我们自己new的Servlet对象受WEB容器的管理吗？</p>
<ul>
<li>我们自己new的Servlet对象是不受WEB容器管理的，只是一个普通的对象，不会被放到Tomcat的集合中的；WEB容器创建的Servlet对象会被放到一个集合当中（HashMap），只有放到这个集合中的Servlet对象才能够被放到WEB容器管理。</li>
</ul>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_008.png" alt="servlet_008.png (395×479) (gitee.io)"></p>
</blockquote>
<h3 id="3-1-Servlet对象的创建"><a href="#3-1-Servlet对象的创建" class="headerlink" title="3.1 Servlet对象的创建"></a>3.1 Servlet对象的创建</h3><p>对象什么时候被创建呢？首先看一下Tomcat服务器启动的时候会不会创建Servlet对象，可以在Servlet实现类中添加构造方法，输出一段文字进行测试，<strong>经过测试，默认情况下Tomcat服务器在启动的时候，Servlet对象并不会被创建</strong>。在用户没有发起请求之前，如果提前创建出对象，必定耗费资源的。</p>
<p>不过可以手动更改，让Tomcat在启动的时候创建Seevlet对象，在web.xml中配置如下所示，即在想要启动的类中添加标签<code>&lt;load-on-startup&gt;0&lt;/load-on-startup&gt;</code>，标签的内容是整数，<strong>整数越小，优先级越高，对象越先被创建</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet_A<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.AServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>0<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet_A<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/servletA<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet_B<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.BServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet_B<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/servletB<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到控制台确实输出了AServlet对象的构造方法输出。</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_010.png" alt="servlet_010.png (586×193) (gitee.io)"></p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_009.png" alt="servlet_009.png (1094×197) (gitee.io)"></p>
<h3 id="3-2-Servlet接口的几个方法"><a href="#3-2-Servlet接口的几个方法" class="headerlink" title="3.2 Servlet接口的几个方法"></a>3.2 Servlet接口的几个方法</h3><p>Servlet接口主要有5个方法，对其主要的几个方法进行测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AServlet</span> <span class="keyword">implements</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AServlet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AServlet的无参构造方法执行了。。。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig servletConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AServlet的init方法执行了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AServlet的srvice方法执行了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Aervlet的destroy方法执行了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先恢复Tomcat服务器启动不创建对象，然后进行测试。浏览器发送请求的时候，以下的方法执行了：</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_011.png" alt="servlet_011.png (564×185) (gitee.io)"></p>
<p>即：</p>
<ul>
<li><p>用户在第一次发送请求的时候Servlet对象被实例化（AServlet的构造方法被执行了，并且执行的是无参构造方法）</p>
</li>
<li><p><strong>AServlet对象被创建出来之后，Tomcat服务器马上调用了init方法</strong>，也就是init方法在执行的时候，AServlet对象已经存在了。</p>
</li>
<li><p>因为用户发送了请求，所以在init方法执行之后，Tomcat马上调用service方法。</p>
</li>
<li><p><strong>继续在浏览器刷新，即再次发送请求，可以看到Tomcat只执行了service方法，即使用前面创建好的对象</strong>。</p>
<ul>
<li>说明Servlet对象是单实例的，但Servlet对象不符合单实例的，所以是假单例。（即使后续有很多个用户访问，Servlet对象也只有一个。）</li>
<li>所以 无参构造方法、init方法 只被调用一次。</li>
<li>service方法，只要被请求一次，就会被执行一次。</li>
</ul>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_012.png" alt="servlet_012.png (508×289) (gitee.io)"></p>
</li>
<li><p>关闭服务器，Servlet对象的destroy方法被执行，即只有关闭服务器的时候，销毁对象的内存之前，会自动调用destroy方法，只执行一次。</p>
</li>
</ul>
<p>可以看到，Servlet对象的生命周期更像是人的一生。<strong>另外，如果提供有参构造方法的话，必须要手动提供无参构造方法。否则会返回500错误，没有无参构造方法，实例化对象失败。所以一般情况下不建议写构造方法。</strong></p>
<p>实际上Servlet接口提供init方法，就是为了代替有参构造方法，使得程序更加安全，可以在该方法中手动编写要执行的操作。Servlet接口中的方法如下所示：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>void init(ServletConfig servletConfig)</td>
<td>该方法很少用，通常在init方法中做初始化操作，并且这个初始化操作只需要执行一次，例如初始化数据库连接池、初始化线程池等等。</td>
</tr>
<tr>
<td>void service(ServletRequest servletRequest, ServletResponse servletResponse)</td>
<td>该方法用的最多，用来处理用户请求的核心方法。</td>
</tr>
<tr>
<td>void destroy()</td>
<td>该方法很少用，通常进行资源的关闭。</td>
</tr>
<tr>
<td>ServletConfig getServletConfig()</td>
<td>获得ServletConfig对象，包括Servlet对象的初始化和启动参数。</td>
</tr>
<tr>
<td>String getServletInfo()</td>
<td>获得Servlet的相关信息，比如作者、版本和版权。</td>
</tr>
</tbody></table>
<h3 id="3-3-适配器模式修改Servlet"><a href="#3-3-适配器模式修改Servlet" class="headerlink" title="3.3 适配器模式修改Servlet"></a>3.3 适配器模式修改Servlet</h3><p>上面讲到，Servlet中的5个方法，只有service方法是常用的，其余的几个方法基本上不用。那么这样，我们就没必要在每个Servlet实现类中都实现这4个方法，太冗余，代码也不美观。此时可以采用适配器模式，创建抽象类实现Servlet中不常用的方法，将常用的方法保留为抽象方法，等待真正的Servlet实现类继承该抽象类再实现该方法。简单例子如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> adapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAdapter</span> <span class="keyword">implements</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig servletConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保留该方法为抽象方法，用于后续继承类来实现</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> adapter.UserAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CServlet</span> <span class="keyword">extends</span> <span class="title">UserAdapter</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 只需要实现该抽象方法即可。</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;适配器模式下的Servlet实现类&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面只是最基本的适配器，其实可以对适配器进行改造。首先Servlet接口中的<code>ServletConfig getServletConfig()</code>方法是为了获得ServletConfig对象，这个对象是哪个对象呢？可以看到<code>void init(ServletConfig servletConfig)</code>方法在执行的时候，会传入一个ServletConfig对象，那么是谁传入的呢？因为Servlet对象是Tomcat自己创建的，所以这个对象实际上也是Tomcat自己创建好的，然后作为实参传入init方法。也就是上面的<code>ServletConfig getServletConfig()</code>实际上就是要获得这个ServletConfig对象，那么怎么在适配器中操作可以更方便的获得该对象呢？<strong>加入成员变量即可</strong>。但是此时<strong>子类可能会重写该方法，这就使得父类方法中的代码被重写，影响父类的逻辑，而且子类又必须重写，这该怎么办呢？</strong>，解决办法就是父类将init设为final方法，再重载一个无参的init方法，有参init方法调用无参init方法，然后子类重写无参init方法。如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAdapter</span> <span class="keyword">implements</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ServletConfig servletConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig servletConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="comment">// 成员变量赋值，用于下面的方法返回值</span></span><br><span class="line">        <span class="keyword">this</span>.servletConfig = servletConfig;</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;父类重载的init方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> servletConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保留该方法为抽象方法，用于真正的Servlet实现类来实现该方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CServlet</span> <span class="keyword">extends</span> <span class="title">UserAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;适配器模式下的Servlet实现类&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;子类重写无参init方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意，上述的Adapter抽象类已经实现了，在<code>javax.servlet.GenericServlet</code>类</strong>，该抽象类的大致源码如下所示，即包括了Servlet接口的5个方法、ServletConfig接口的4个方法，1个无参构造方法，1个无参init方法，和2个自定义的log日志方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> javax.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericServlet</span> <span class="keyword">implements</span> <span class="title">Servlet</span>, <span class="title">ServletConfig</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> ServletConfig config;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GenericServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInitParameter</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getServletConfig().getInitParameter(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Enumeration&lt;String&gt; <span class="title">getInitParameterNames</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getServletConfig().getInitParameterNames();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.config;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletContext <span class="title">getServletContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getServletConfig().getServletContext();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.config = config;</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.getServletContext().log(<span class="keyword">this</span>.getServletName() + <span class="string">&quot;: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String message, Throwable t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.getServletContext().log(<span class="keyword">this</span>.getServletName() + <span class="string">&quot;: &quot;</span> + message, t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest var1, ServletResponse var2)</span> <span class="keyword">throws</span> ServletException, IOException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.config.getServletName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试类如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DServlet</span> <span class="keyword">extends</span> <span class="title">GenericServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;利用javax.servlet.GenericServlet包实现的service方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;这是重写GenericServlet类下的init方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下所示：</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_013.png" alt="servlet_013.png (799×187) (gitee.io)"></p>
<h2 id="4-ServletConfig接口"><a href="#4-ServletConfig接口" class="headerlink" title="4. ServletConfig接口"></a>4. ServletConfig接口</h2><p>Tomcat在创建Servlet实现类对象之后，会先创建ServletConfig接口的实现类对象，然后将其作为实参，传入init方法并调用该方法。接下来看一下ServletConfig接口的相关内容。</p>
<ul>
<li>ServletConfig是Servlet规范中的一员，<code>javax.servlet.ServletConfig</code></li>
</ul>
<p>实际上，创建的ServletConfig实现类是<code>org.apache.catalina.core.StandardWrapperFacade</code>，该类实现了ServletConfig接口，即Tomcat实现了ServletConfig的接口，并创建了该类对象，传入Servlet实现类对象的init方法中。<strong>那么如果有多个Servlet类对象被创建，ServletConfig对象会不会创建多个呢？</strong>答案是肯定的，编写两个Servlet实现类，启动服务器并分别请求，查看其ServletConfig对象地址，二者是不一样的。<strong>也就是说，一个Servlet对象就会关联一个ServletConfig对象。</strong></p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_014.png" alt="servlet_014.png (1190×147) (gitee.io)"></p>
<h3 id="4-1-ServletConfig接口的作用"><a href="#4-1-ServletConfig接口的作用" class="headerlink" title="4.1 ServletConfig接口的作用"></a>4.1 ServletConfig接口的作用</h3><p>实际上，这个对象是关于Servlet对象的配置信息形成的对象，也被称为Servlet对象的配置信息对象。<strong>不同的Servlet对象的配置信息不同，所以需要不同的ServletConfig对象。</strong>那么ServletConfig对象中到底有什么信息呢？<strong>实际上就是web.xml中对应的&lt;servlet&gt;&lt;/servlet&gt;标签中的信息。即根据标签中的信息将请求路径和示例对象关联起来。</strong></p>
<h3 id="4-2-ServletConfig接口的方法"><a href="#4-2-ServletConfig接口的方法" class="headerlink" title="4.2 ServletConfig接口的方法"></a>4.2 ServletConfig接口的方法</h3><p>ServletConfig接口提供了4个方法，另外JavaEE提供了该接口的两个实现类GenericServlet和HttpServlet，这两个类也都实现了这4个方法。4个方法如下所示：</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>String getInitParameter(String name)</td>
<td>获取指定name的初始化配置信息。（<strong>注意，在web.xml中是可以通过&lt;init-para&gt;标签来设置servlet的初始化信息的</strong>）</td>
</tr>
<tr>
<td>Enumeration&lt;String&gt; getInitParameterNames()</td>
<td>获取所有初始化信息的name。</td>
</tr>
<tr>
<td>ServletContext getServletContext()</td>
<td>获得ServletContext对象</td>
</tr>
<tr>
<td>String getServletName()</td>
<td>获得Servlet对象的名字</td>
</tr>
</tbody></table>
<p>设置web.xml中的指定Servlet实现类的初始化参数信息，部分信息如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ServletConfigTest01<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servletConfig.ServletConfigTest01<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 设置该类对象的初始化信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>driver<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>user<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>password<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>url<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>jdbc:mysql://localhost:3306/mysql_test<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在Servlet类对象中利用ServletConfig对象获取该信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletConfigTest01</span> <span class="keyword">extends</span> <span class="title">GenericServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        ServletConfig sc = <span class="keyword">this</span>.getServletConfig();</span><br><span class="line">        System.out.println(<span class="string">&quot;ServletConfigTest01类对象中的ServletConfig对象：&quot;</span> + sc);</span><br><span class="line"></span><br><span class="line">        Enumeration&lt;String&gt; initParameterNames = sc.getInitParameterNames();</span><br><span class="line">        <span class="keyword">while</span>(initParameterNames.hasMoreElements())&#123;</span><br><span class="line">            String name = initParameterNames.nextElement();</span><br><span class="line">            System.out.println( name + <span class="string">&quot;:&quot;</span> + sc.getInitParameter(name));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_015.png" alt="servlet_015.png (1204×274) (gitee.io)"></p>
<p><strong>注意，因为GenericServlet抽象类已经实现了ServletConfig接口，而自己编写的Servlet实现类也继承了GenericServlet抽象类，所以自己的这个实现类就相当于有了上面ServletConfig的4个方法，直接用this来调用即可。</strong></p>
<p><strong>注意，ServletConfig对象是Tomcat实现接口类并创建类对象的，所以它里面的4个方法是Tomcat实现的，而GenericServlet抽象类实现了ServletConfig接口，并且通过init方法使得自身的成员变量ServletConfig类对象有了值，所以采用this来调用，底层也是通过获取成员变量来调用该方法的。</strong></p>
<p>如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletConfigTest01</span> <span class="keyword">extends</span> <span class="title">GenericServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        ServletConfig sc = <span class="keyword">this</span>.getServletConfig();</span><br><span class="line">        System.out.println(<span class="string">&quot;ServletConfigTest01类对象中的ServletConfig对象：&quot;</span> + sc);</span><br><span class="line"></span><br><span class="line">        Enumeration&lt;String&gt; initParameterNames = <span class="keyword">this</span>.getInitParameterNames();</span><br><span class="line">        <span class="keyword">while</span>(initParameterNames.hasMoreElements())&#123;</span><br><span class="line">            String name = initParameterNames.nextElement();</span><br><span class="line">            System.out.println( name + <span class="string">&quot;:&quot;</span> + <span class="keyword">this</span>.getInitParameter(name));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-ServletContext接口"><a href="#5-ServletContext接口" class="headerlink" title="5. ServletContext接口"></a>5. ServletContext接口</h2><p>前面讲解了ServletConfig接口及其几个方法，还有一个方法返回的是ServletContext接口对象，本节讲解一下ServletContext接口的内容。</p>
<h3 id="5-1-ServletContext接口的作用"><a href="#5-1-ServletContext接口的作用" class="headerlink" title="5.1 ServletContext接口的作用"></a>5.1 ServletContext接口的作用</h3><p>Tomcat服务器实现了该接口，类名为<code>org.apache.catalina.core.ApplicationContextFacade</code>。ServletContext接口也是Servlet规范中的一员。</p>
<p>ServletContext对象是WEB服务器启动的时候由WEB服务器创建的（<strong>注意，该对象是WEB服务器启动的时候创建的，而Servlet对象以及ServletConfig对象则是第一次被请求的时候才创建的</strong>），通过编写两个Servlet实现类进行测试，发现ServletContext类对象只有一个。<strong>实际上该对象对应的内容是web.xml文件中的内容，即对于一个webapp来说，ServletContext对象只有一个。</strong>该对象也被称为Servlet对象的环境对象（Servlet对象的上下文对象）。而上面的ServletConfig对象，则是web.xml中某个servlet的配置信息。</p>
<h3 id="5-2-ServletContext接口的方法"><a href="#5-2-ServletContext接口的方法" class="headerlink" title="5.2 ServletContext接口的方法"></a>5.2 ServletContext接口的方法</h3><p>ServletContext接口的常用方法如下表所示：</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>String getInitParameter(String name)</td>
<td>获得指定name的全局配置信息</td>
</tr>
<tr>
<td>Enumeration&lt;String&gt; getInitParameterNames()</td>
<td>获得全局配置信息的所有name</td>
</tr>
<tr>
<td>String getContextPath()</td>
<td>获取所在webapp项目的根路径</td>
</tr>
<tr>
<td>String getRealPath(String path)</td>
<td>获取path的绝对路径，这里的path指的是在webapp中的路径，以web为根路径，如/path.html.</td>
</tr>
<tr>
<td>void log(String msg)</td>
<td>将指定的信息写入日志文件，日志在Tomcat安装目录下的logs目录下</td>
</tr>
<tr>
<td>void log(String message, Throwable throwable)</td>
<td>在上述方法的基础上，也将异常信息写入进去</td>
</tr>
<tr>
<td>void setAttribute(String name, Object object)</td>
<td>向应用域中存数据（应用域的概念可参考5.3节）</td>
</tr>
<tr>
<td>void getAttribute(String name)</td>
<td>向应用域中取数据</td>
</tr>
<tr>
<td>void removeAttribute(String name)</td>
<td>删除应用域中的数据</td>
</tr>
</tbody></table>
<p><strong>注意，除了在&lt;servlet&gt;&lt;/servlet&gt;标签中设置该类对象的初始化信息，也可以在&lt;web&gt;&lt;/web&gt;标签中设置整个webapp的初始化信息，注意是在servlet外面的进行设置，不属于某个servlet的配置，是全局的</strong>，而ServletContext中的那两个方法就是获得的是全局的配置信息。<strong>所以，如果webapp中的所有servlet都共有的配置信息可以配到全局上。</strong>如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--设置整个webapp的初始化信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>pageSize<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>10<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>startIndex<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>0<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ServletConfigTest01<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servletConfig.ServletConfigTest01<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>ServletConfigTest01<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/ServletConfig<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试方法如下所示，和ServletConfig类似：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletContextTest02</span> <span class="keyword">extends</span> <span class="title">GenericServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        ServletContext servletContext = <span class="keyword">this</span>.getServletContext();</span><br><span class="line">        System.out.println(servletContext);</span><br><span class="line"></span><br><span class="line">        System.out.println(servletContext.getInitParameter(<span class="string">&quot;pageSize&quot;</span>));</span><br><span class="line"></span><br><span class="line">        Enumeration&lt;String&gt; initParameterNames = servletContext.getInitParameterNames();</span><br><span class="line">        <span class="keyword">while</span> (initParameterNames.hasMoreElements())&#123;</span><br><span class="line">            System.out.println(initParameterNames.nextElement());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(servletContext.getContextPath());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 不加斜杠也可以</span></span><br><span class="line">        System.out.println(servletContext.getRealPath(<span class="string">&quot;/path.html&quot;</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_016.png" alt="servlet_016.png (916×187) (gitee.io)"></p>
<p><strong>注意，如果采用传统的方法来运行Tomcat服务器的话，日志默认是在Tomcat安装目录的logs下的，但是如果采用IDEA来运行的话，会默认在自己的备份目录下来保存日志的。可以在启动服务器的时候，看到CATALINA_BASE采用的是IDEA中目录的。日志种类及文件名如下所示</strong>：</p>
<ul>
<li>catalina.*.log，服务器端Java程序运行的控制台信息</li>
<li>localhost.*.log，ServletContext对象的log方法记录的日志信息</li>
<li>localhost_access_log.*.log，用户访问日志</li>
</ul>
<h3 id="5-3-应用域"><a href="#5-3-应用域" class="headerlink" title="5.3 应用域"></a>5.3 应用域</h3><p>该接口对象也被称为应用域，这个应用域相当于一种数据结构，可以存储数据，相当于缓存，存取比IO速度快。除了应用域，还有一些其他的域，比如请求域、会话域等等。<strong>如果所有的用户共享一份数据，并且这个数据很少的被修改，并且这个数据量很少，那么可以将这些数据放到ServletContext这个应用域中。</strong></p>
<ul>
<li>因为ServletContext对象只有一个，只有所有Servlet对象共享的数据放进去才有意义；</li>
<li>数据量比较大的话，太占用堆内存，并且这个对象的生命周期比较长，服务器关闭的时候，这个对象才会被销毁。</li>
<li>如果所有用户共享的数据频繁修改，必然会存在线程并发所带来的线程安全问题，所以ServletContext对象中的数据一般都是只读的。</li>
</ul>
<p>在一个Servlet实现类中<code>servletContext.setAttribute(&quot;1&quot;, &quot;zhangSan&quot;);</code>，在另一个Servlet实现类中<code>System.out.println(servletContext.getAttribute(&quot;1&quot;));</code>，可以看到控制台中的确输出了”zhangSan”。</p>
<p>实际上向应用域当中绑定数据，就相当于把这个数据放到了缓存（cache）当中，然后用户访问的时候直接从缓存中取，减少IO的操作（比如提前将数据库的数据查询出来，或者提交将数据库连接对象连接好），大大提升了系统的性能，所以缓存技术是挺高性能的重要手段。</p>
<p>目前为止接触过的缓存机制：</p>
<ul>
<li>堆内存中的字符串常量池<ul>
<li>如一个字符串“abc”，现在字符串常量池中查找，如果有，直接拿来用。如果没有则新建，然后再放入字符串常量池。</li>
</ul>
</li>
<li>堆内存中的整数型常量池<ul>
<li>[-128~127]一共256个Integer类型的引用，放在整数型常量池中，没有超出这个范围的数字，直接从常量池中取。</li>
</ul>
</li>
<li>连接池<ul>
<li>这里所说的连接池是Java连接数据库的连接对象：java.sql.Connection。</li>
<li>JVM是一个进程。MySQL数据库是一个进程，进程和进程之间建立连接，打开通道是很费劲的，是很耗费资源的。可以提前先创建好N个Connection连接对象，将连接对象放到一个集合当中，我们<strong>把这个存放对象的集合称为连接池</strong>。每一次用户连接的时候不需要再新建连接对象，省去了新建的环节，直接从连接池中取连接对象，大大提升了访问效率。另外，连接池中保证了最大连接数，也保证了系统的安全性。</li>
</ul>
</li>
<li>线程池<ul>
<li>Tomca服务器本身就支持多线程的。</li>
<li>Tomcat服务器是在用户发送一次请求，就新建一个Thread线程对象吗？<ul>
<li>当然不是，实际上是在Tomcat服务器启动的时候，会先创建好N多个线程Thread对象，然后将线程对象放到集合当中，称为线程池。用户发送请求过来之后，需要有一个对象的线程来处理这个请求，这个时候就会直接从线程池中来线程对象来处理。</li>
</ul>
</li>
</ul>
</li>
<li>redis<ul>
<li>NoSQL数据库，非关系型数据库，缓存数据库</li>
</ul>
</li>
<li>向ServletContext应用域中存储数据，也等于是将数据存放到缓存cache中。</li>
</ul>
<h2 id="6-中间总结"><a href="#6-中间总结" class="headerlink" title="6. 中间总结"></a>6. 中间总结</h2><p>本质上Tomcat服务器调用我们编写的Servlet实现类来为浏览器提供服务，但是Servlet接口中的方法有很多方法不需要，所以JavaEE利用适配器模式创建了Servlet的一个抽象实现类GenericServlet，但是我们B/S架构的系统是基于HTTP超文本传输协议的，所以，为了更方便的编程，<strong>以后我们在编写Servlet类要继承JavaEE提供的另一个Servlet实现类HttpServlet，它是专门为HTTP协议准备的一个Servlet类。我们编写的类要继承HttpServlet，使用HttpServlet处理HTTP协议更便捷。HttpServlet类也继承了GenericServlet类。</strong>继承关系如下所示：</p>
<ul>
<li>javax.servlet.Servlet（接口）【爷爷】<ul>
<li>javax.servlet.GenericServlet（抽象类）【儿子】<ul>
<li>javax.servlet.http.HttpServlet（抽象类）【孙子】</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="7-HTTP协议"><a href="#7-HTTP协议" class="headerlink" title="7. HTTP协议"></a>7. HTTP协议</h2><p>因为B/S架构是基于HTTP协议传输数据的，所以HttpServlet可以很好的处理HTTP协议数据包。在讲解HttpServlet类之前，先了解一下HTTP协议。</p>
<p>协议就是某种规范，某种规定。比如汉语、英语等等，这些都是制定好的协议，大家按照某种协议来，可以沟通无障碍。那么计算机之间的通信也需要某种协议，HTTP协议是W3C制定的一种超文本传输协议，这种协议游走在B/S之间，是通信协议，即发送消息的模板提前被制定好的。HTTP协议包括请求协议和响应协议：</p>
<ul>
<li>请求协议<ul>
<li>浏览器向WEB服务器发送数据的时候，<strong>这个发送的数据需要遵循一套标准</strong>，这个标准中规定了发送的数据具体格式。</li>
</ul>
</li>
<li>响应协议<ul>
<li>WEB服务器向浏览器发送数据的时候，<strong>这个发送的数据需要遵循一套标准</strong>，这个标准中规定了发送的数据具体格式。</li>
</ul>
</li>
</ul>
<p>为了获得请求协议和响应协议的具体内容，编写form表单和对应的servlet实现类来测试一下。网页源码如下所示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>post and get<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>get请求<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/servlet03/getServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>post请求<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/servlet03/postServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>get和post请求servlet实现类如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetServlet</span> <span class="keyword">extends</span> <span class="title">GenericServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        servletResponse.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        PrintWriter out = servletResponse.getWriter();</span><br><span class="line"></span><br><span class="line">        out.print(<span class="string">&quot;this response if from get&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PostServlet</span> <span class="keyword">extends</span> <span class="title">GenericServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        servletResponse.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        PrintWriter out = servletResponse.getWriter();</span><br><span class="line"></span><br><span class="line">        out.print(<span class="string">&quot;this response if from post&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置文件修改好后，运行网页的时候点击F12，查看网络流。</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_017.png" alt="servlet_017.png (1720×850) (gitee.io)"></p>
<h3 id="7-1-HTTP请求协议"><a href="#7-1-HTTP请求协议" class="headerlink" title="7.1 HTTP请求协议"></a>7.1 HTTP请求协议</h3><p>HTTP请求协议包括四部分：</p>
<ul>
<li><p>请求行</p>
<p>包括三部分</p>
<ul>
<li>请求方式（get(常用)、post(常用)、delete、head、put、options、trace）</li>
<li>URI<ul>
<li>统一资源标识符，代表某个资源的名字，但是通过这个URI是无法定位资源的。</li>
<li>URL是统一资源定位符，可以定位资源，URL是包含URI的。如下所示：<ul>
<li><a target="_blank" rel="noopener" href="http://localhost:8080/servlet03/index.html%EF%BC%8C%E8%BF%99%E6%98%AFURL%E3%80%82">http://localhost:8080/servlet03/index.html，这是URL。</a></li>
<li>/servlet03/index.html，这是URI。</li>
</ul>
</li>
</ul>
</li>
<li>协议版本号（HTTP/1.1）</li>
</ul>
</li>
<li><p>请求头</p>
<ul>
<li>请求主机</li>
<li>主机端口</li>
<li>浏览器信息</li>
<li>cookie</li>
<li>…</li>
</ul>
</li>
<li><p>空白行</p>
<p>用来区分请求头和请求体。</p>
</li>
<li><p>请求体</p>
<p><strong>向服务器发送的具体数据</strong>。</p>
</li>
</ul>
<p>get请求报文如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /servlet03/getServlet?username=fuyun&amp;password=asdf HTTP/1.1						(请求行)</span><br><span class="line">Host: localhost:8080																(请求头)</span><br><span class="line">Connection: keep-alive</span><br><span class="line">sec-ch-ua: &quot; Not;A Brand&quot;;v=&quot;99&quot;, &quot;Google Chrome&quot;;v=&quot;97&quot;, &quot;Chromium&quot;;v=&quot;97&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Referer: http://localhost:8080/servlet03/index.html</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: _xsrf=2|4625403a|23df939a35c378e3490d78b3c8ed5792|1641540047; username-localhost-8888=&quot;2|1:0|10:1641541087|23:username-localhost-8888|44:ZTQ1NDEwMTlkOTU3NDIwNjhmNjc2MDcwYmMzMDFmYTk=|cee758225322d1fb51d837825cb244f7490e0cbee520215a9b15111d87a74fd6&quot;; username-localhost-8889=&quot;2|1:0|10:1641541104|23:username-localhost-8889|44:Mjg1ZGI1NTFiZDc0NGU2MDkyNTE1NTJmYmNjZDUxZjM=|de7019faea91f6ccfc5fc6fb7a8fa25dc8c7b50ac6634fe82e5ed2bd895e0df0&quot;</span><br><span class="line">																					(空白行)</span><br><span class="line">																					(请求体)</span><br></pre></td></tr></table></figure>

<p>post请求报文如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">POST /servlet03/postServlet HTTP/1.1												(请求行)</span><br><span class="line">Host: localhost:8080																(请求头)</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Length: 28</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">sec-ch-ua: &quot; Not;A Brand&quot;;v=&quot;99&quot;, &quot;Google Chrome&quot;;v=&quot;97&quot;, &quot;Chromium&quot;;v=&quot;97&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http://localhost:8080</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Referer: http://localhost:8080/servlet03/index.html</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: _xsrf=2|4625403a|23df939a35c378e3490d78b3c8ed5792|1641540047; username-localhost-8888=&quot;2|1:0|10:1641541087|23:username-localhost-8888|44:ZTQ1NDEwMTlkOTU3NDIwNjhmNjc2MDcwYmMzMDFmYTk=|cee758225322d1fb51d837825cb244f7490e0cbee520215a9b15111d87a74fd6&quot;; username-localhost-8889=&quot;2|1:0|10:1641541104|23:username-localhost-8889|44:Mjg1ZGI1NTFiZDc0NGU2MDkyNTE1NTJmYmNjZDUxZjM=|de7019faea91f6ccfc5fc6fb7a8fa25dc8c7b50ac6634fe82e5ed2bd895e0df0&quot;</span><br><span class="line">																					(空白行)</span><br><span class="line">username=fuyun&amp;password=asdf														(请求体)</span><br></pre></td></tr></table></figure>

<h4 id="7-1-1-GET请求和POST请求的发送"><a href="#7-1-1-GET请求和POST请求的发送" class="headerlink" title="7.1.1 GET请求和POST请求的发送"></a>7.1.1 GET请求和POST请求的发送</h4><p>到目前为止，只有一种情况可以发送POST请求：就是使用form表单，并且form标签中的method属性值为：method=”post”，其他所有情况一律都是GET请求：</p>
<ul>
<li>在浏览器地址栏上直接输入URL，敲回车，属于GET请求；</li>
<li>在浏览器上直接点击超链接，属于GET请求；</li>
<li>使用form表单提交数据时，没有使用method或者method为get，属于GET请求；</li>
</ul>
<h4 id="7-1-2-GET请求和POST请求的区别"><a href="#7-1-2-GET请求和POST请求的区别" class="headerlink" title="7.1.2 GET请求和POST请求的区别"></a>7.1.2 GET请求和POST请求的区别</h4><p>get请求发送数据的时候，数据会挂在URI的后面，以问号连接URI和数据，这样会导致发送的数据回显在浏览器的地址栏上。即get请求在“请求行”上发送数据。<strong>只能发送普通的字符串，有长度限制，不同的浏览器有不同的限制，即不能发送大数据串。get请求比较适合从服务器端获取数据，即发送获取数据请求。get请求是绝对安全的，因为get请求只是为了从服务器上获取数据而发送的请求，不会对服务器造成威胁。这里的安全是相对服务器来说的。</strong></p>
<p>post请求发送数据的时候，数据会挂在请求体中，数据不会回显在浏览器的地址栏上。即post请求在“请求体”上发送数据。<strong>可以发送任何数据类型的数据，如图片、视频等等，理论上没有长度限制。post请求比较适合向服务器端传送数据，即发送传输数据请求。但是post请求是危险的，因为post请求是向服务器提交数据，如果这些数据通过后门的方式进入到服务器当中，服务器是很危险的。</strong></p>
<p><strong>二者的数据格式在传输过程中，都是 name=value&amp;name=value…的形式，这是协议规定好的。name就是标签的属性名name的值，value就是标签的属性名value的值。</strong></p>
<p>另外，get请求是支持缓存的，浏览器可以缓存get请求的数据（<strong>一个get请求路径会对应一个缓存资源，如果想要浏览器直接请求而不检查缓存中的数据，可以每次在请求路径后面加一个系统时间戳</strong>）；而post请求则不支持缓存，获得的响应数据不会被浏览器缓存。</p>
<p>大部分的form表单提交，都是采用的post方式；如果form表单中有敏感信息，也是建议采用post方式；另外，如果是文件上传，也采用post。其他情况可以使用get。</p>
<h3 id="7-2-HTTP响应协议"><a href="#7-2-HTTP响应协议" class="headerlink" title="7.2 HTTP响应协议"></a>7.2 HTTP响应协议</h3><p>HTTP响应协议包括四部分：</p>
<ul>
<li><p>状态行（<strong>重点</strong>）</p>
<p>由三部分组成</p>
<ul>
<li>协议版本号（HTTP/1.1）</li>
<li>状态码（200表示请求响应成功，正常结束；404表示资源不存在；405表示前端发送的请求方式和后端请求的处理方式不一致，如get和post；500表示服务器端的程序出现异常；以4开始的一般是浏览器端的错误，以5开始的一般是服务器端的错误）</li>
<li>状态描述信息（ok表示成功，not found表示找不到）</li>
</ul>
</li>
<li><p>响应头</p>
<ul>
<li>响应的内容类型</li>
<li>响应的内容长度</li>
<li>响应的时间</li>
<li>…</li>
</ul>
</li>
<li><p>空白行</p>
<ul>
<li>用来分割响应头和响应体。</li>
</ul>
</li>
<li><p>响应体</p>
<ul>
<li>服务器响应的具体内容，即实际数据，可能是html源码。</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 ok									（状态行）</span><br><span class="line">Content-Type: text/html;charset=ISO-8859-1		（响应头）</span><br><span class="line">Content-Length: 25</span><br><span class="line">Date: Sun, 09 Jan 2022 07:28:25 GMT</span><br><span class="line">Keep-Alive: timeout=20</span><br><span class="line">Connection: keep-alive</span><br><span class="line">												（空白行）</span><br><span class="line">this response if from get						（响应体）</span><br></pre></td></tr></table></figure>

<h2 id="8-设计模式（概述）"><a href="#8-设计模式（概述）" class="headerlink" title="8. 设计模式（概述）"></a>8. 设计模式（概述）</h2><p>设计模式就是某个问题的固定的解决方案，也就是套路。常见的设计模式有：</p>
<ul>
<li>GoF设计模式<ul>
<li>Gang of Four（4人组）提出的23种设计模式。比如单例模式、适配器模式、模板方法模式等等。</li>
</ul>
</li>
<li>JavaEE设计模式<ul>
<li>DAO、DTO、VO等等。</li>
</ul>
</li>
<li>…</li>
</ul>
<p>模板方法模式概述如下：</p>
<blockquote>
<p>先想象一个场景，学生和教师，两人一天的流程包括：起床、吃早饭、吃午饭、工作（上课/教课）、吃完饭、睡觉。既然两个人的流程一样，只有工作的方法实现不一样，所以可以将二人抽象出一个类，类中的一天流程方法是固定的，一些常用的方法（吃饭、睡觉）也是固定的，只有工作的方法具体实现不一样，可以将其作为抽象方法。</p>
<p><strong>也就是说，上面的抽象类就是模板类，一天的流程（核心算法骨架，可以用final修饰，不被子类改写）是模板方法，具体的工作方法留给子类来具体实现。</strong></p>
<p><strong>也就是说，模板方法设计模式在模板类中定义核心的算法骨架，具体的实现步骤可以延迟到子类当中去实现。模板类通常是一个抽象类，定义的核心方法通常是final的。模板类中的抽象方法就是不确定怎么实现的方法，通常交给子类来做。</strong></p>
<p>其实这种模式可以类似Tomcat服务器创建的Servlet实例，Tomcat固定了模板类，我们只需要实现具体的子类中的具体的service方法即可，整体的步骤：创建对象、init方法初始化、调用服务、destroy这些流程是固定的，具体的调用服务的实现方法则是延迟到子类中具体实现的。</p>
</blockquote>
<h2 id="9-HttpServlet抽象类"><a href="#9-HttpServlet抽象类" class="headerlink" title="9. HttpServlet抽象类"></a>9. HttpServlet抽象类</h2><p>前面提到，我们在实际开发中，通常继承HttpServlet抽象类而不是GenericServlet抽象类，这个抽象类是专门为HTTP协议准备的，比GenericServlet更加适合HTTP协议下的开发。该抽象类在<code>javax.servlet.http</code>包下，该包下有很多的接口和类，主要下面几个类比较重要：</p>
<ul>
<li><p>javax.servlet.http.HttpServlet（HTTP协议专用的Servlet类，抽象类）</p>
</li>
<li><p>javax.servlet.http.HttpServletRequest（HTTP协议专用的请求对象）</p>
<p>该类的实例简称为request对象，封装了HTTP请求协议的全部内容，即Tomcat（WEB服务器）将“请求协议”中的数据全部解析出来，然后将这些数据全部封装到request对象中了。</p>
</li>
<li><p>javax.servlet.http.HttpServletResponse（HTTP协议专用的响应对象）</p>
<p>该类的实例简称为response对象，该对象是专门用来响应HTTP协议到浏览器的，即通过该对象可以将数据封装到响应数据包中返回给浏览器。</p>
</li>
</ul>
<h3 id="9-1-HttpServlet源码简单分析"><a href="#9-1-HttpServlet源码简单分析" class="headerlink" title="9.1 HttpServlet源码简单分析"></a>9.1 HttpServlet源码简单分析</h3><p>实际开发中就是要继承这个类，所以可以参考上面讲的Servlet对象的生命周期来分析。</p>
<ol>
<li><p>创建对象</p>
<p>调用HttpServlet提供的无参构造方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HttpServlet</span><span class="params">()</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>init初始化</p>
<p>调用其父类GenericServlet的init方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.config = config;</span><br><span class="line">    <span class="keyword">this</span>.init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>调用service方法</p>
<p>HttpServlet有两个service方法，一个是重写继承父类，一个是自己扩展的。<strong>那么Tomcat调用的时候，先调用继承父类的方法，因为形参确定了调用的方法，然后重写的方法又调用了自己扩展的方法。</strong></p>
<p>通过下面可以观察到，重写的方法就是为了数据类型转换，去调用自己扩展的方法。扩展service方法中，通过HttpServletRequest对象获取请求协议的方式，如GET、POST等等，然后<strong>针对不同的“请求方式”调用不同的方法进行处理</strong>。那么此时就会有疑问，我们继承的类该重写哪个方法呢？似乎JavaEE都已经实现了，其实不是的，<strong>仔细看源码就会发现，doGet()等方法其实就是简单的405响应，并没有真正的实质性的内容。实际上仍然需要我们重写实现方法，去避免这个错误。</strong></p>
<p><strong>注意，此处就是模板方法设计模式，我们实现的子类只需要实现不同的请求方式对应的处理方法即可，也就是处理方法才是真正的服务。</strong></p>
<p>因为实际情况下，浏览器肯定会发送不同请求方式的请求协议包的，那么实际情况下，我们需要在服务器的电脑上，<strong>监听端口</strong>、<strong>获取请求数据包</strong>、<strong>解析数据包的内容</strong>、<strong>针对内容作出响应</strong>。这几个简单的步骤，前三个都是通用的，所以Tomcat服务器以及JavaEE规范帮助我们实现了，我们只需要针对内容作出响应即可，这个作出响应就是重写doGet()等方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    HttpServletRequest request;</span><br><span class="line">    HttpServletResponse response;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        request = (HttpServletRequest)req;</span><br><span class="line">        response = (HttpServletResponse)res;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassCastException var6) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(lStrings.getString(<span class="string">&quot;http.non_http&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.service(request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    String method = req.getMethod();</span><br><span class="line">    <span class="keyword">long</span> lastModified;</span><br><span class="line">    <span class="keyword">if</span> (method.equals(<span class="string">&quot;GET&quot;</span>)) &#123;</span><br><span class="line">        lastModified = <span class="keyword">this</span>.getLastModified(req);</span><br><span class="line">        <span class="keyword">if</span> (lastModified == -<span class="number">1L</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.doGet(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">long</span> ifModifiedSince;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                ifModifiedSince = req.getDateHeader(<span class="string">&quot;If-Modified-Since&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalArgumentException var9) &#123;</span><br><span class="line">                ifModifiedSince = -<span class="number">1L</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (ifModifiedSince &lt; lastModified / <span class="number">1000L</span> * <span class="number">1000L</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.maybeSetLastModified(resp, lastModified);</span><br><span class="line">                <span class="keyword">this</span>.doGet(req, resp);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                resp.setStatus(<span class="number">304</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">&quot;HEAD&quot;</span>)) &#123;</span><br><span class="line">        lastModified = <span class="keyword">this</span>.getLastModified(req);</span><br><span class="line">        <span class="keyword">this</span>.maybeSetLastModified(resp, lastModified);</span><br><span class="line">        <span class="keyword">this</span>.doHead(req, resp);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">&quot;POST&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.doPost(req, resp);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">&quot;PUT&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.doPut(req, resp);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">&quot;DELETE&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.doDelete(req, resp);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">&quot;OPTIONS&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.doOptions(req, resp);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(<span class="string">&quot;TRACE&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.doTrace(req, resp);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        String errMsg = lStrings.getString(<span class="string">&quot;http.method_not_implemented&quot;</span>);</span><br><span class="line">        Object[] errArgs = <span class="keyword">new</span> Object[]&#123;method&#125;;</span><br><span class="line">        errMsg = MessageFormat.format(errMsg, errArgs);</span><br><span class="line">        resp.sendError(<span class="number">501</span>, errMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    String msg = lStrings.getString(<span class="string">&quot;http.method_get_not_supported&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.sendMethodNotAllowed(req, resp, msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendMethodNotAllowed</span><span class="params">(HttpServletRequest req, HttpServletResponse resp, String msg)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    String protocol = req.getProtocol();</span><br><span class="line">    <span class="keyword">if</span> (protocol.length() != <span class="number">0</span> &amp;&amp; !protocol.endsWith(<span class="string">&quot;0.9&quot;</span>) &amp;&amp; !protocol.endsWith(<span class="string">&quot;1.0&quot;</span>)) &#123;</span><br><span class="line">        resp.sendError(<span class="number">405</span>, msg);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resp.sendError(<span class="number">400</span>, msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>简单测试一下子类重写doGet()和doPost()方法，成功响应。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpServletSelf</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        PrintWriter writer = response.getWriter();</span><br><span class="line">        writer.print(<span class="string">&quot;doPost&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        PrintWriter writer = response.getWriter();</span><br><span class="line">        writer.print(<span class="string">&quot;doGet&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-关于一个web站点的欢迎页面"><a href="#10-关于一个web站点的欢迎页面" class="headerlink" title="10. 关于一个web站点的欢迎页面"></a>10. 关于一个web站点的欢迎页面</h2><p>对于一个webapp来说，我们是可以设置它的欢迎页面的。<strong>设置了欢迎页面之后，当你访问这个webapp的时候，或者访问这个web站点的时候，没有指定任何的“资源路径”，这个时候会默认访问你的欢迎页面</strong>。设置欢迎页面可以通过在web.xml文件中设置&lt;welcome-file-list&gt;&lt;/welcome-file-list&gt;标签来设置，设置该标签的内容为某静态资源的路径即可，该路径不需要加项目名，不需要以斜杠开始，默认从web目录下开始找。</p>
<p>另外，一个webapp是可以设置多个欢迎页面的，即多个&lt;welcome-file&gt;标签即可，优先级自上而下，如果都找不到就会返回404。<strong>注意，欢迎页面也可以不是html文件，可以是servlet实现类，只需要将映射路径填入即可。</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_018.png" alt="servlet_018.png (558×242) (gitee.io)"></p>
<p><strong>注意，上面写的配置是欢迎页面的局部配置，也就是只针对这个webapp项目有效。实际上Tomcat自己设置了一个全局配置，针对所有的webapp都有效，可以自己进行测试一下，就是当某个根目录下的资源文件名是index.html、index.htm以及index.jsp的时候，不需要局部配置，默认打开的就是该页面。但是局部配置的优先级比全局配置有效，</strong>全局配置的文件是在Tomcat的安装目录下的<code>/conf/web.xml</code>文件中，并且除了欢迎页面，还有其他一些全局的配置信息。</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_019.png" alt="servlet_019.png (704×286) (gitee.io)"></p>
<h2 id="11-关于WEB-INF目录"><a href="#11-关于WEB-INF目录" class="headerlink" title="11. 关于WEB-INF目录"></a>11. 关于WEB-INF目录</h2><p>放在WEB-INF目录下的资源是受保护的，在浏览器上不能够通过路径直接访问，所以像HTML、CSS、JS以及image等静态资源一定要放到WEB-INF目录之外。</p>
<h2 id="12-HttpServletRequest接口"><a href="#12-HttpServletRequest接口" class="headerlink" title="12. HttpServletRequest接口"></a>12. HttpServletRequest接口</h2><p>通过上面的讲解，其实已经看到了Servlet接口及其相关的接口以及实现类，有ServletConfig、ServletContext、GenericServlet和HttpServlet，除了这些，还有Servlet中的service方法的两个形参涉及到的ServletRequest和ServletResponse接口没有讲到，这一节以及下一节讲解这两个接口。</p>
<p>HttpServlet继承了Servlet，并且service方法中也是将ServletRequest接口转换为HttpServletRequest接口。实际上HttpServletRequest接口是继承ServletRequest接口的，所以关于ServletRequest和ServletResponse接口的讲解就放到HttpServletRequest接口和HttpServletResponse接口中讲解了。</p>
<p>该接口的实现类是Tomcat服务器实现了：<code>org.apache.catalina.connector.RequestFacade@3ad8abf</code>，该类对象由Tomcat服务器创建，并作为实参传入该对象。<strong>实际上用户发送请求的时候，遵循了HTTP协议，Tomcat服务器将HTTP协议中的信息以及数据全部解析出来，然后将这些信息封装到HttpServletRequest对象中，传到了service()方法中供我们使用。</strong>而用户发送的<strong>请求信息</strong>是至关重要的，因为作为交互的一方，我们肯定是需要知道这些信息的，所以<strong>要想获得这些数据就要通过该对象来获得</strong>。因为每次请求的信息不同，所以这两个对象的生命周期很短，只在一次请求和响应中有效。</p>
<h3 id="12-1-ServletRequest接口中的常用方法"><a href="#12-1-ServletRequest接口中的常用方法" class="headerlink" title="12.1 ServletRequest接口中的常用方法"></a>12.1 ServletRequest接口中的常用方法</h3><p>常用的方法如下所示：</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>String getParameter(String name)</td>
<td>获取指定name的value（适合于只有一个value的key，常用）</td>
</tr>
<tr>
<td>Map&lt;String, String[]&gt; getParameterMap()</td>
<td>获取整个参数Map集合</td>
</tr>
<tr>
<td>Enumeration&lt;String&gt; getParameterNames()</td>
<td>获取参数Map集合的的所有name</td>
</tr>
<tr>
<td>String[] getParameterValues(String name)</td>
<td>获取指定name的所有value，返回的是数组（适合复选框类似的数据，常用）</td>
</tr>
</tbody></table>
<p><em>备注，因为用户传过来是以key=value[&amp;key=value…]的形式传过来的，所以key是可以重复的，那么在服务器端怎么存储这些数据呢？肯定不能是简单的Map集合的，因为该集合key不能重复，所以为了存储重复的key，在value方面采用了数组来存储，即整体是依然是Map，但是value是一个数组，即Map&lt;String, String[]&gt;。</em>简单测试如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpServletRequestTest</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        PrintWriter out = response.getWriter();</span><br><span class="line">        out.print(request);</span><br><span class="line"></span><br><span class="line">        String username = request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        String[] interest = request.getParameterValues(<span class="string">&quot;interest&quot;</span>);</span><br><span class="line"></span><br><span class="line">        out.print(<span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">        out.print(username + <span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">        out.print(password + <span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : interest) &#123;</span><br><span class="line">            out.print(s + <span class="string">&quot;,&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>测试request对象<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>get请求<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/servlet06/request&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    爱好：</span><br><span class="line">        抽烟<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;interest&quot;</span> <span class="attr">value</span>=<span class="string">&quot;c&quot;</span>&gt;</span></span><br><span class="line">        喝酒<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;interest&quot;</span> <span class="attr">value</span>=<span class="string">&quot;h&quot;</span>&gt;</span></span><br><span class="line">        烫头<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;interest&quot;</span> <span class="attr">value</span>=<span class="string">&quot;t&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_020.png" alt="servlet_020.png (803×239) (gitee.io)"></p>
<p><strong>注意，前端表单提交数据的时候，都是以字符串形式在后端获得的。</strong>除了上面四个获取请求对象的数据参数之外，还有下面的三个方法比较常用。</p>
<h3 id="12-2-请求域"><a href="#12-2-请求域" class="headerlink" title="12.2 请求域"></a>12.2 请求域</h3><p>request对象实际上又被称为“请求域”对象，和应用域对象类似，可以作为缓存存储一些数据。<strong>注意，请求域对象要比应用域对象范围小很多，生命周期短很多。请求域只在一次请求内有效，一个request对象对应一个请求域对象，一次请求结束之后，这个request对象就销毁了，请求域对象也就销毁了。</strong></p>
<p>请求域和应用域的选用原则？</p>
<blockquote>
<ul>
<li>尽量使用小的域对象，因为小的域对象占用的资源较少。</li>
</ul>
</blockquote>
<p>请求域对象的三个方法如下所示：</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>void setAttribute(String name, Object object)</td>
<td>向域中存数据</td>
</tr>
<tr>
<td>void getAttribute(String name)</td>
<td>向域中取数据</td>
</tr>
<tr>
<td>void removeAttribute(String name)</td>
<td>删除域中的数据</td>
</tr>
</tbody></table>
<p>简单测试案例如下所示，在01Servlet中存入并读取数据，请求之后生效；在02Servlet中读取不到，请求之后生效。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestServletTest01</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        request.setAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhangSan&quot;</span>);</span><br><span class="line">        String name = (String) request.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        PrintWriter out = response.getWriter();</span><br><span class="line">        out.write(name);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestServletTest02</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        Object name = request.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        PrintWriter out = response.getWriter();</span><br><span class="line">        out.write(String.valueOf(name));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>既然一个请求域对象对应一次请求（目前来看，一次请求对应一个Servlet），那么这个请求域对象的存在还有什么意义呢？其实是可以将两个Servlet放到一次请求中的（即一次请求对应多个Servlet），这样，就可以在一次请求中实现不同的Servlet实现类对象共享数据。而应用域则是所有的Servlet实现类对象以及所有的对其请求都共享，这样实际会造成一定的资源浪费。</strong></p>
<p><strong>注意，虽然可以在01Servlet类中自己创建02Servlet对象，并将请求域对象传入，但是这样自己new的对象并不受Tomcat管理。本质上来说，我们不能自己创建Servlet对象，只能由Tomcat自己创建和管理以及销毁对象。</strong></p>
<h3 id="12-3-请求转发机制"><a href="#12-3-请求转发机制" class="headerlink" title="12.3 请求转发机制"></a>12.3 请求转发机制</h3><p>上面提到了可以在一个Servlet类中将请求对象转发到另一个Servlet中，这种机制称为<strong>请求转发机制</strong>。主要用到ServletRequest接口中的<code>getRequestDispatcher(String path)</code>方法，获得请求转发器对象，参数path指的是另一个Servlet在web.xml中的配置地址，返回的是请求转发器对象。然后再调用转发器对象中的forward方法，将本Servlet类当前的request和response对象传入到对应的Servlet类中。<strong>本质上就是为了保证两个Servlet中的request和response对象是一样的。</strong></p>
<p>测试代码如下所示，在上面的基础上，将01中的输出删掉，增加请求转发代码，02保持不变，这样请求01会产生输出，实际这个输出是02产生的（<strong>注意，两个Servlet都返回内容，似乎后返回的会覆盖前面返回的内容，所以这里将01不返回内容</strong>）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestServletTest01</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        request.setAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhangSan&quot;</span>);</span><br><span class="line"><span class="comment">//        String name = (String) request.getAttribute(&quot;name&quot;);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        response.setContentType(&quot;text/html&quot;);</span></span><br><span class="line"><span class="comment">//        PrintWriter out = response.getWriter();</span></span><br><span class="line"><span class="comment">//        out.write(name);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取请求转发器对象</span></span><br><span class="line">        RequestDispatcher requestDispatcher = request.getRequestDispatcher(<span class="string">&quot;/2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用转发器的forward方法完后完成转发</span></span><br><span class="line">        requestDispatcher.forward(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以两个Servlet共享资源的方式如下：</p>
<ul>
<li>将数据放到ServletContext应用域当中。但是应用域范围太大，占用资源太多，不建议使用。</li>
<li>将数据放到request请求域中，然后采用请求转发机制，将数据转发到另一个Servlet中，这样两个或多个Servlet共享一份数据。</li>
</ul>
<p><strong>注意，转发的下一个地址不一定是Servlet，也可以是其他WEB容器中的合法资源，如html等等（只不过这个页面会作为资源返回到浏览器当中）。</strong></p>
<h3 id="12-4-ServletRequest接口的其他方法"><a href="#12-4-ServletRequest接口的其他方法" class="headerlink" title="12.4 ServletRequest接口的其他方法"></a>12.4 ServletRequest接口的其他方法</h3><p>ServletRequest接口中的其他方法：</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>String getRemoteAddr()</td>
<td>获取访问客户端的IP地址</td>
</tr>
<tr>
<td>String getRemoteHost()</td>
<td>同上</td>
</tr>
<tr>
<td>String getRemotePost()</td>
<td>端口号</td>
</tr>
<tr>
<td>void setCharacterEncoding(String env)</td>
<td>设置request对象<strong>请求体</strong>的字符编码集。主要是为了解决post请求乱码，因为post方式是在请求体中存放数据。<strong>注意，这仅仅是服务器端获取到的数据解决了乱码，服务器端数据返回到浏览器还需要解决，即response.setContentType(“text/html;charset=UTF-8”)。</strong></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><strong>注意，那么针对get请求的乱码怎么解决呢？会不会发生乱码呢？</strong></p>
<blockquote>
<p>Tomcat9及以后，不会发生乱码，在Tomcat安装目录的<code>conf/server.xml</code>配置文件的<code>&lt;connector&gt;</code>标签中可以设置<code>URIEncoding</code>属性编码为<code>UTF-8</code>，默认不写就是UTF-8。这个URI指的就是get的请求路径后面的数据。<strong>这个说明信息在安装目录的<code>webapps/docs/config/http.html</code>中有说明。</strong></p>
</blockquote>
<h3 id="12-5-HttpServletRequest接口中的常用方法"><a href="#12-5-HttpServletRequest接口中的常用方法" class="headerlink" title="12.5 HttpServletRequest接口中的常用方法"></a>12.5 HttpServletRequest接口中的常用方法</h3><p>该类相当于扩展了ServletRequest接口，常用方法如下所示：</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>String getContextPath()</td>
<td>返回请求对象请求资源的所在项目的根路径。</td>
</tr>
<tr>
<td>String getMethod()</td>
<td>返回请求的方式（get、post…）</td>
</tr>
<tr>
<td>String getRequestURI()</td>
<td>返回请求的URI（带项目名）</td>
</tr>
<tr>
<td>StringBuffer getRequestURL()</td>
<td>返回请求的URL</td>
</tr>
<tr>
<td>String getServletPath()</td>
<td>返回请求的servlet的路径（不带项目名）</td>
</tr>
</tbody></table>
<h2 id="13-案例：用Servlet进行数据库表的CRUD操作"><a href="#13-案例：用Servlet进行数据库表的CRUD操作" class="headerlink" title="13. 案例：用Servlet进行数据库表的CRUD操作"></a>13. 案例：用Servlet进行数据库表的CRUD操作</h2><p>CRUD操作即增（Create）查（Retrive）改（Update）删（Delete）。案例的实现采用：前端提交请求，后端Servlet进行处理。功能如下：</p>
<ul>
<li>显示信息</li>
<li>新增数据</li>
<li>删除数据</li>
<li>修改数据</li>
</ul>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_021.png" alt="servlet_021.png (1055×457) (gitee.io)"></p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_022.png" alt="servlet_022.png (1034×216) (gitee.io)"></p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_023.png" alt="servlet_023.png (574×172) (gitee.io)"></p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_024.png" alt="servlet_024.png (989×182) (gitee.io)"></p>
<ol>
<li>注意，因为CRUD操作频繁涉及到数据库操作，所以<strong>可以提供一个数据库的工具类，包含数据库连接以及释放资源</strong>。</li>
<li>另外，在前端显示数据库的内容，而数据库中的数据是变化的，所以前端也就得是动态的。目前的技术做不到动态变化。所以采用后端Servlet向前端发送网页，即Servlet输出前端代码，交给浏览器去编译。</li>
<li>注意，表单的提交是post，而一些页面跳转则是get，注意Servlet的方法实现。</li>
<li>对于新增，在展示信息页面，点击新增链接（get请求）进入到新增页面，在新增页面输入信息之后，点击新增（<strong>这里相当于提交信息，到某个Servlet执行数据库操作，post请求，然后再跳转到展示信息页面，这里跳转采用的转发，注意，转发的是当前Servlet接收到的post请求，所以在展示信息页面需要实现post方法，理论上用跳转比较合适，因为二者不需要共享请求域。</strong>）进入到展示信息页面。</li>
<li>具体的代码这里不再展示，源码在servlet08这个module中。</li>
</ol>
<h2 id="14-转发和重定向"><a href="#14-转发和重定向" class="headerlink" title="14. 转发和重定向"></a>14. 转发和重定向</h2><p>在一个web应用中，资源的跳转有两种方式（这里的跳转指的是在后端Servlet中实现的跳转，因为浏览器或者前端只能是URL）：</p>
<ul>
<li><p>转发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取请求转发器对象</span></span><br><span class="line">RequestDispatcher requestDispatcher = request.getRequestDispatcher(<span class="string">&quot;/show&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求转发，转发就是将获得请求转发到另一个Servlet对象中，即多个Servlet对象共享请求域。</span></span><br><span class="line">requestDispatcher.forward(request, response);</span><br></pre></td></tr></table></figure></li>
<li><p>重定向</p>
<p>重定向顾名思义，就是重新定方向，即重新修改整个URL。而且重定向不是request对象中的方法，而是response对象中的方法。因为是修改整个URL，所以重定向的参数是：<strong>项目名+资源名</strong>（而转发则只需要资源名即可）。本质上是通过response对象返回给浏览器一个URL，浏览器收到后再次发起这个URL请求（因为是重新请求，所以也就必须带上项目名了）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.sendRedirect(request.getContextPath()+ <span class="string">&quot;/b&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<p>二者的区别是什么？</p>
<ul>
<li>可以测试，<strong>转发</strong>只是将请求转到另一个资源，从浏览器端是察觉不到的，即<strong>浏览器的地址栏仍然是最开始的那个资源</strong>，转发相当于最开始的资源调用了另一个资源，相当于递归服务器帮助用户向其他服务器请求查询，而用户只是觉得结果是递归服务器给它的。而<strong>重定向则是命令浏览器再次请求一个新的URL，所以浏览器的地址栏是重定向后的URL</strong>。重定向相当于各级域名服务器返回给递归服务器各级权威域名服务器的IP。（在上面的案例中，可以看到，关于转发的Servlet，确实在浏览器中URL没有改变）</li>
<li><strong>转发是服务器内部的一个资源调用，浏览器端只发送了一次请求；而重定向则是服务器返回给浏览器一个结果，使得浏览器重新请求另一个资源，浏览器端发送了多次请求。</strong></li>
</ul>
<p>转发的流程图如下所示：</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_025.png" alt="servlet_025.png (1215×627) (gitee.io)"></p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_026.png" alt="cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_026.png"></p>
<p><strong>转发和重定向应该如何选择？什么时候使用转发，什么时候选择重定向？</strong></p>
<ul>
<li>如果在上一个Servlet当中向request域当中绑定了数据，希望从下一个Servlet当中把request域里面的数据取出来，使用转发机制。</li>
<li>剩下所有的请求均使用重定向（<strong>重定向使用较多</strong>）。注意，因为是URL，所以只能是get请求。</li>
</ul>
<p>注意：</p>
<ul>
<li>转发会存在浏览器的刷新问题，因为转发不会修改浏览器的URL，这时候操作完之后，如果在浏览器端刷新，那么就相当于再次发送了请求（发送的请求是重定向之前的请求）。此时如果该请求涉及到数据库操作，比如新增一条记录，那么这时候，每刷新一次就会新增一次记录，<strong>比如上述的新增操作，在新增成功后，再次刷新，服务器端就会返回主键重复异常</strong>。而重定向则不会，因为重定向已经将浏览器的URL修改为操作之后的URL了，即使再刷新，请求的仍然是重定向之后的URL，不涉及到数据库操作。</li>
</ul>
<h2 id="15-Servlet线程安全问题"><a href="#15-Servlet线程安全问题" class="headerlink" title="15. Servlet线程安全问题"></a>15. Servlet线程安全问题</h2><p><strong>Servlet是单实例多线程环境下运行的</strong>，什么时候存在线程安全问题呢？</p>
<ul>
<li>多线程并发</li>
<li>有共享的数据</li>
<li>共享数据有修改操作</li>
</ul>
<p>在JVM中，哪些数据可能会存在线程安全问题？</p>
<blockquote>
<p>所有线程共享一个堆内存，共享一个方法区内存。所以这两个内存区中的数据会发生线程安全问题（<strong>但是常量不涉及到修改，所以不会存在线程安全问题</strong>）。如</p>
<ul>
<li>堆内存中的Java对象，对象内部的实例变量</li>
<li>方法区中的静态变量，如果涉及到修改操作，也会存在线程安全问题。</li>
</ul>
</blockquote>
<p><strong>线程安全不只是体现在JVM中，还有可能发生在数据库中，例如多个线程共享同一张表，并且同时去修改表中的一些记录，这些记录就存在线程安全问题，解决方法有多种，（1）在Java程序使用Synchronized关键字，线程排队执行；（2）采用数据库中的行级锁（悲观锁）；（3）事务机制（程序线程串行化）；（4）乐观锁。</strong></p>
<p>Servlet因为是单实例多线程的，所以Servlet对象中的成员变量只有一份，那么多个用户访问的时候，比如注册信息，（<strong>如果采用成员变量保存数据</strong>）</p>
<ul>
<li>A用户注册的信息保存在Servlet的实例变量中，但是还没有存入数据库，</li>
<li>此时B也注册信息，填入了信息，还没有存入数据库。</li>
<li>此时B填的信息就会覆盖A填的信息（多线程共享一个Servlet实例对象），那么本质上就是A注册了B注册的信息，B注册时因为信息已经存在，注册失败。</li>
</ul>
<p>此时的问题该怎么解决呢？</p>
<ul>
<li>采用局部变量保存数据（多个用户请求，相当于多次调用service方法，而方法中的变量属于局部变量，每次调用都会创建不同的变量，所以数据不会覆盖。）</li>
<li>采用Synchronized关键字，将多线程串行化（不优先考虑这个方法）</li>
</ul>
<h2 id="16-Cookie"><a href="#16-Cookie" class="headerlink" title="16. Cookie"></a>16. Cookie</h2><p>Cookie可以保存会话状态，只要Cookie清除，或者Cookie失效，这个会话状态就没有了。Cookie是保存在浏览器客户端上的：</p>
<ul>
<li>可以是浏览器缓存中，浏览器关闭Cookie消失；</li>
<li>也可以保存在浏览器所在客户端的硬盘中，浏览器关闭Cookie还在，除非Cookie失效。</li>
</ul>
<p>Cookie这种机制是HTTP协议规定的，和get、post请求类似，属于协议规定的。不止是在Javaweb中存在，只要是web开发，只要是B/S架构的系统，只要是基于HTTP协议，就有Cookie存在。Cookie实现的功能，有如下几种：</p>
<ul>
<li>保留购物车商品的状态在客户端上。（适用于前期免登陆加购物车的网站）</li>
<li>十天内免登陆</li>
</ul>
<p><strong>在Java中Cookie被当做类来处理，使用new运算符可以创建Cookie对象，即Servlet中可以由自己来创建Cookie对象。Cookie由两部分组成：name和value，都是String类型。</strong>该类的全称是<code>javax.servlet.http.Cookie</code>。构造方法和常用方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造方法</span></span><br><span class="line">Cookie(String name, String value)	</span><br><span class="line"><span class="comment">// Returns an array containing all of the Cookie objects the client sent with this request.</span></span><br></pre></td></tr></table></figure>

<p>之后，由response对象用<code>response.addCookie(Cookie对象)</code>将Cookie发送给浏览器客户端。另外，JavaScript也可以创建Cookie，<strong>前面提到过，Cookie属于HTTP协议规定的，在Servlet中创建属于采用Java提供的工具类来创建；在前端中采用JS创建则是采用JS提供的工具类来创建。</strong></p>
<p>注意，服务器可以一次向浏览器发送多个Cookie，<strong>默认情况下，服务器发送Cookie给浏览器之后，浏览器将Cookie保存在缓存当中</strong>，只要不关闭浏览器，Cookie永远存在，并且有效；当浏览器关闭之后，缓存中的Cookie被清除。<strong>在浏览器客户端，无论是硬盘文件还是缓存中保存的Cookie，什么时候会再次发送给服务器呢？浏览器会不会提交发送这些Cookie给服务器？浏览器在发送请求的时候，会先检查一遍是否有绑定的Cookie，如有，则附加cookie发送。其实Cookie和请求路径是紧密关联的，不同的请求路径会发送提交不同的Cookie，默认情况下Cookie是和创建该cookie的servlet路径相关联。</strong></p>
<p><strong>另外，绑定的路径是可以指定的，可以通过程序<code>cookie.setPath(String uri)</code>来设置，保证Cookie和某个特定的路径绑定在一起。</strong>这样，只要请求该绑定路径下的各个资源，浏览器都会自动发送存储的与该路径绑定下的cookie。</p>
<h3 id="16-1-Cookie保存在硬盘"><a href="#16-1-Cookie保存在硬盘" class="headerlink" title="16.1 Cookie保存在硬盘"></a>16.1 Cookie保存在硬盘</h3><p>注意，默认情况下，Cookie是没有设置有效时长的，该Cookie被默认保存在浏览器的缓存当中，只要浏览器不关闭，Cookie就一直有效，而关闭浏览器则消失。我们可以设置Cookie的有效时长，以保证Cookie保存在硬盘文件当中。但是这个有效时长必须是&gt;0的。换句话说，只要设置Cookie的有效时长大于0，该cookie就会保存在硬盘中，有效时长过去之后，则硬盘文件中的Cookie失效。调用Cookie的方法<code>void setMaxAge(int expiry)</code>来设置cookie的有效时长，单位为秒。</p>
<ul>
<li>cookie有效时长=0 直接被删除</li>
<li>cookie有效时长&lt;0 不会被存储</li>
<li>cookie有效时长&gt;0 存储在硬盘文件</li>
<li>没有有效时长 存储在浏览器缓存中</li>
</ul>
<p>Servlet代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CookieTest</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建cookie对象</span></span><br><span class="line">        Cookie cookie_name = <span class="keyword">new</span> Cookie(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhangSan&quot;</span>);</span><br><span class="line">        Cookie cookie_password = <span class="keyword">new</span> Cookie(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;zhangSan123&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置cookie关联的路径，默认创建该Cookie的路径（即所在servlet）关联在一起。</span></span><br><span class="line">        cookie_name.setPath(request.getContextPath() + <span class="string">&quot;/qwer&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将Cookie对象发送到浏览器客户端</span></span><br><span class="line">        response.addCookie(cookie_name);</span><br><span class="line">        response.addCookie(cookie_password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>cookie如下所示：</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_027.png" alt="servlet_027.png (868×768) (gitee.io)"></p>
<p>设定Cookie的有效时长后如下所示，注意，下面的创建时间并不是真正的本次请求创建的时间，忘记清除cookie：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CookieTest</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建cookie对象</span></span><br><span class="line">        Cookie cookie_name = <span class="keyword">new</span> Cookie(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhangSan&quot;</span>);</span><br><span class="line">        Cookie cookie_password = <span class="keyword">new</span> Cookie(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;zhangSan123&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置cookie关联的路径，默认创建该Cookie的路径（即所在servlet）关联在一起。</span></span><br><span class="line">        cookie_name.setPath(request.getContextPath() + <span class="string">&quot;/qwer&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置cookie时长</span></span><br><span class="line">        cookie_name.setMaxAge(<span class="number">60</span> * <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将Cookie对象发送到浏览器客户端</span></span><br><span class="line">        response.addCookie(cookie_name);</span><br><span class="line">        response.addCookie(cookie_password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_028.png" alt="servlet_028.png (870×776) (gitee.io)"></p>
<h3 id="16-2-Servlet读取Cookie"><a href="#16-2-Servlet读取Cookie" class="headerlink" title="16.2 Servlet读取Cookie"></a>16.2 Servlet读取Cookie</h3><p>上面讲述了由Servlet创建Cookie对象并返回给浏览器端，而浏览器端也会将根据请求路径将所绑定的Cookie跟随请求将其发送到服务器端，那么服务器端怎么读取Cookie呢？<strong>HttpServletRequest对象request中有一个<code>Cookie getCookies()</code>方法，返回请求对象中包含的Cookie，类型为数组，可能为null。</strong></p>
<p>如果有Cookie对象的话，可以通过Cookie类的相关方法<code>String getName()</code>和<code>Strigng getValue()</code>来获得name和value。案例如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CookieTest</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建cookie对象</span></span><br><span class="line">        Cookie cookie_name = <span class="keyword">new</span> Cookie(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhangSan&quot;</span>);</span><br><span class="line">        Cookie cookie_password = <span class="keyword">new</span> Cookie(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;zhangSan123&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置cookie关联的路径，默认创建该Cookie的路径（即所在servlet）关联在一起。</span></span><br><span class="line">        cookie_name.setPath(request.getContextPath() + <span class="string">&quot;/qwer&quot;</span>);</span><br><span class="line">        cookie_name.setMaxAge(<span class="number">60</span> * <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将Cookie对象发送到浏览器客户端</span></span><br><span class="line">        response.addCookie(cookie_name);</span><br><span class="line">        response.addCookie(cookie_password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="16-3-案例：10天内免登陆"><a href="#16-3-案例：10天内免登陆" class="headerlink" title="16.3 案例：10天内免登陆"></a>16.3 案例：10天内免登陆</h3><p>十天内免登陆，本质上是根据服务器端利用首次成功登陆信息创建Cookie对象（和用户名密码有关，并且和登陆页面路径绑定）返回给浏览器端，然后浏览器端将Cookie信息保存，下次再次访问该登陆页面时，自动将Cookie信息发送到服务器端，完成免登陆。</p>
<ul>
<li>这个功能首先是在登录的基础上完成的，所以要先完成<strong>登录功能</strong>。然后附加一个复选框，用于选择10天免登陆功能。之后账号密码验证成功后，服务器端再判断该功能是否选择，选择后就根据登录信息创建Cookie对象返回给浏览器端。 </li>
<li>之后，<strong>浏览器再次访问该路径时</strong>，只需要判断cookie的内容是否匹配即可，匹配成功即直接跳转到欢迎页面，匹配失败则需要在该页面正常输入账户密码。</li>
<li><strong>注意，一般情况下，浏览器会直接访问网站主页，所以上面的Cookie应该绑定网站主页，那么浏览器访问的时候，服务器首先判断是否包含Cookie，如果包含则继续验证账号密码是否匹配，匹配成功则跳转到登录成功页面（或者主页），匹配失败则跳转到登录页面。所以网站的主页应该设置一个servlet，用于判断是否免登陆。</strong></li>
</ul>
<h2 id="17-路径的编写方式"><a href="#17-路径的编写方式" class="headerlink" title="17. 路径的编写方式"></a>17. 路径的编写方式</h2><h3 id="17-1-常见的路径编写"><a href="#17-1-常见的路径编写" class="headerlink" title="17.1 常见的路径编写"></a>17.1 常见的路径编写</h3><p>目前为止，需要编写路径的地方有：超链接、form表单、重定向、转发、web配置文件（欢迎页面、Servlet路径映射）等等。</p>
<ul>
<li><p>&lt;a href=”/项目名/资源路径”&gt;&lt;/a&gt;</p>
</li>
<li><p>&lt;form action=”/项目名/资源路径”&gt;&lt;/form&gt;</p>
</li>
<li><p>重定向：response.sendRedirect(“/项目名/资源路径”);</p>
</li>
<li><p>转发：request.getRequestDispatcher(“/资源路径”).forward(request, response);</p>
</li>
<li><p>欢迎页面：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>资源路径<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Servlet路径</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/资源路径<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Cookie：cookie.setPath(“项目名/资源路径”);</p>
</li>
<li><p>ServletContext</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ServletContext application = config.getServletContext();</span><br><span class="line">application.getRealPath(<span class="string">&quot;/WEB-INF/classesdb.properties&quot;</span>);</span><br><span class="line">application.getRealPath(<span class="string">&quot;/资源路径&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="17-2-url-pattern的编写方式"><a href="#17-2-url-pattern的编写方式" class="headerlink" title="17.2 url-pattern的编写方式"></a>17.2 url-pattern的编写方式</h3><h4 id="17-2-1-精确匹配"><a href="#17-2-1-精确匹配" class="headerlink" title="17.2.1 精确匹配"></a>17.2.1 精确匹配</h4><p>精确匹配即路径是指定的一条路径，上面写的都是精确匹配。另外和欢迎页面类似，&lt;servlet-mapping&gt;中的&lt;url-pattern&gt;也可以编写多个，即多条路径都对应一个servlet。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/Hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/system/Hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>即外部链接的路径可以是<code>/Hello</code>，也可以是<code>system/Hello</code>，两条路径均能找到HelloServlet实现类。</p>
<h4 id="17-2-1-扩展匹配"><a href="#17-2-1-扩展匹配" class="headerlink" title="17.2.1 扩展匹配"></a>17.2.1 扩展匹配</h4><p>扩展匹配类似正则表达式，星号代表任意路径。即system下的任意子路径均能映射到该Servlet实现类（前缀匹配）。除了前缀匹配，还有后缀匹配，即父路径任意。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 前缀匹配 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/system/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 后缀匹配 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.action<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.qwerasdfzxvc<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="18-Session"><a href="#18-Session" class="headerlink" title="18. Session"></a>18. Session</h2><p>前面的Cookie是将“连接信息”保存到浏览器端，那么可不可以将“连接信息”保存到服务器端呢？可以用Session做到。<strong>同样，Session机制不仅仅是Java中有的，是HTTP协议规定的，在任何B/S架构中均存在。</strong>Session表示会话，在Java中的完整类名是：<code>javax.servlet.http.HttpSession</code>，简称session。上面的“连接信息”表示会话状态，即Cookie可以将会话状态保存在客户端，HttpSession可以将会话状态保存在服务器端。</p>
<p>HttpSession对象是一个会话级别的对象，一次会话对应一个HttpSession对象。什么是会话呢？简单地说，用户打开浏览器，在浏览器上发送多次请求，直到最终关闭浏览器，表示一次完整的会话（准确地说，一次会话就是一次连接，服务器为该连接创建的一个对象，只要连接不断开，该Session对象就一直存在）。<strong>可以自己测试一下，用request对象的getSession方法获得该连接的session对象，连接不断开，session对象就一直是那个；关闭浏览器断开连接，再次请求，会发现session发生改变。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpSessionTest01</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        HttpSession session = request.getSession();</span><br><span class="line">        String ip = request.getRemoteAddr();</span><br><span class="line"></span><br><span class="line">        System.out.println(ip + <span class="string">&quot;&#x27;s session = &quot;</span> + session);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_030.png" alt="servlet_030.png (1000×366) (gitee.io)"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HttpSession <span class="title">getSession</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// Returns the current session associated with this request, or if the request does not have a session, creates one.</span></span><br><span class="line"><span class="comment">// 注意，该方法是如果在服务端，没有该请求对应的session对象，就会创建一个，返回该创建的对象，同时创建对应的cookie，将cookie对象发送到客户端；如果有，就从该请求中获取该cookie，然后获取对应的session。</span></span><br><span class="line"></span><br><span class="line"><span class="function">HttpSession <span class="title">getSession</span><span class="params">(<span class="keyword">boolean</span> create)</span></span>;</span><br><span class="line"><span class="comment">// Returns the current HttpSession associated with this request or, if there is no current session and create is true, returns a new session.</span></span><br><span class="line"><span class="comment">// 和上面的方法类似，只不过如果是false，则不会创建session对象，返回null。</span></span><br></pre></td></tr></table></figure>

<p><strong>在WEB容器中，WEB容器维护了大量的HttpSession对象，换句话说，在WEB容器中应该有一个session列表。</strong>那么是如何做到在会话连接不断开的情况下，获取到的session对象不变呢？是怎么映射的呢？</p>
<blockquote>
<ol>
<li>打开浏览器，在浏览器上发送首次请求；</li>
<li>（如果调用了getSession方法）服务器会创建一个HttpSession对象，该对象代表一次会话；</li>
<li>同时生成HttpSession对象对应的Cookie对象，并且Cookie对象的name是<code>JSESSIONID</code>，value是32位长度的字符串；</li>
<li>即服务器将Cookie的value和HttpSession对象绑定到session列表中；</li>
<li>服务器将Cookie完整发送给浏览器客户端；</li>
<li>浏览器客户端将Cookie保存到缓存中；</li>
<li>只要浏览器不关闭，Cookie不会消失；</li>
<li>当再次发送请求的时候，会自动提交缓存中的Cookie；</li>
<li>服务器接收到Cookie，验证该Cookie的name确实是：<code>JSESSIONID</code>，知道该Cookie保存的信息是session相关的信息，然后获取该Cookie的value；</li>
<li>通过Cookie的value去session列表中检索对应的HttpSession对象。</li>
</ol>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_031.png" alt="cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_031.png"></p>
<p><strong>所以，session机制是依据cookie机制来实现的。上述就是将一次的会话和客户端请求对应起来，那么这样服务端就会知道这是哪个会话，接下来就是利用session对象保存的相关信息提供一些服务。</strong></p>
</blockquote>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_029.png" alt="servlet_029.png (879×312) (gitee.io)"></p>
<p>**注意，和HttpSession对象关联的这个Cookie的name是比较特殊的，在Java中就叫做：<code>JSESSIONID</code>**；</p>
<p>浏览器禁用Cookie会出现什么问题？怎么解决？</p>
<blockquote>
<p>浏览器禁用Cookie，则浏览器缓存中不再保存Cookie；导致在同一个会话中，无法获取到对应的会话对象，那么服务器就会生成多个session对象，即每次获取的会话对象都是新的。</p>
<p><strong>了解一下，如果在禁用cookie之后，仍然想要拿到对应的cookie对象，必须使用URL重写机制，即在URL后加分号，加<code>jsessionid=id值</code>，以get的方式将sessionid提交到服务器。重写URL会给编程带来复杂度，所以一般的web站点是不建议禁用Cookie的。</strong></p>
</blockquote>
<p>浏览器关闭之后，服务器端对应的session对象会被销毁吗？为什么？</p>
<blockquote>
<p>浏览器关闭之后，服务器不会销毁session对象。因为B/S架构的系统基于HTTP协议，而HTTP协议是一种无状态/无连接的协议。（无连接指的是，二者之间的通道是在请求的时候建立的，通信结束之后通道关闭，这样做的目的是降低服务器的压力。）</p>
<p>可以用上面的URL重写机制，在其他的浏览器上进行测试，服务端后台输出的session对象是同一个。</p>
</blockquote>
<p>session对象在什么时候被销毁？</p>
<blockquote>
<p>web系统引入了<strong>session超时</strong>的概念。当很长一段时间（这个时间可以配置）没有用户再访问该session对象，此session对象超时，web服务器自动回收session对象。<strong>可以在<code>web.xml</code>文件中用&lt;session-config&gt;标签来设置，默认为30分钟。</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>120<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 单位是分钟 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>什么是一次会话呢？</p>
<blockquote>
<p>一般情况下是这样描述的：用户打开浏览器，在浏览器上进行一些操作，然后将浏览器关闭，表示一次会话结束。（实际上因为关闭了浏览器，cookie对象不再存在，那么session对象将不会被访问到，一段时间过后自动被销毁）。</p>
<p>本质上的描述：从session对象的创建，到最终session对象超时之后被销毁，这个才是真正意义上的一次完整会话。</p>
</blockquote>
<h3 id="18-1-HttpSession中的常用方法"><a href="#18-1-HttpSession中的常用方法" class="headerlink" title="18.1 HttpSession中的常用方法"></a>18.1 HttpSession中的常用方法</h3><p>HttpSession接口中常用的方法有如下几种：</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Object getAttribute(String name)</td>
<td>获取会话域中指定name的值</td>
</tr>
<tr>
<td>void setAttribute(String name, Object value)</td>
<td>向会话域中存取数据</td>
</tr>
<tr>
<td>void removeAttribute(String name)</td>
<td>向会话域中删除指定name的数据</td>
</tr>
<tr>
<td>void invalidate()</td>
<td>Invalidates this session then unbinds any objects bound to it.即销毁session对象。</td>
</tr>
</tbody></table>
<p>前三个方法在应用域和请求域中见过，用于数据共享。那么这里的这三个方法就意味着session对象也被称为会话域，一次会话可以对应多次请求，即多次请求之间进行数据共享。</p>
<p>测试案例如下所示：</p>
<p>主页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Session测试<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/servlet12/firstSession&quot;</span>&gt;</span>测试session<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/servlet12/accessSession&quot;</span>&gt;</span>获取session<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/servlet12/logoutSession&quot;</span>&gt;</span>销毁session<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试session对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpSessionTest01</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        HttpSession session = request.getSession();</span><br><span class="line">        String ip = request.getRemoteAddr();</span><br><span class="line"></span><br><span class="line">        System.out.println(ip + <span class="string">&quot;&#x27;s session = &quot;</span> + session);</span><br><span class="line"></span><br><span class="line">        session.setAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取session数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccessSessionServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        HttpSession session = request.getSession();</span><br><span class="line">        Object name = session.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(session + <span class="string">&quot;:&quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>销毁session对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogoutServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取session对象，如果没有session对象，则返回null。有的话，则销毁它。</span></span><br><span class="line">        HttpSession session = request.getSession(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">if</span>(session != <span class="keyword">null</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;销毁对象：&quot;</span> + session);</span><br><span class="line">            session.invalidate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，一次会话只有一个session，这在getSession()方法中可以看出来，有的话，就获取该对象，没有的话，就创建一个session对象。所以下面第4行，获取对象没有取到，所以就创建了一个，在第5行销毁的时候，销毁的是第4行新创建的那个。</p>
<p><img src="http://cybersecurity.gitee.io/blog-image-bed/JavaWeb/servlet/servlet_032.png" alt="servlet_032.png (1023×184) (gitee.io)"></p>
<h3 id="18-2-ServletContext、HttpSession、HttpServletRequest接口的对比"><a href="#18-2-ServletContext、HttpSession、HttpServletRequest接口的对比" class="headerlink" title="18.2 ServletContext、HttpSession、HttpServletRequest接口的对比"></a>18.2 ServletContext、HttpSession、HttpServletRequest接口的对比</h3><p>以上三者都是范围对象，分别对应：应用范围、会话范围和请求范围。三个范围的排序：应用范围&gt;会话范围&gt;请求范围。</p>
<ul>
<li>应用范围完成跨会话共享数据。</li>
<li>会话范围完成跨请求共享数据。（这些请求必须在同一个会话中）</li>
<li>请求范围完成跨Servlet共享数据。（这些Servlet必须在同一个请求当中，如转发）</li>
</ul>
<p>使用原则：由小到大尝试，优先使用小范围。因为数据共享必然存在访问和修改以及资源耗费情况，那么就会存在线程安全。</p>
<h3 id="18-3-案例：会话对象保存登录状态"><a href="#18-3-案例：会话对象保存登录状态" class="headerlink" title="18.3 案例：会话对象保存登录状态"></a>18.3 案例：会话对象保存登录状态</h3><p>以前面的数据库CRUD操作案例为例，可能会发现，<strong>虽然有了登录功能，但是依然可以通过直接输入特定页面的URL来进行访问，即跳过了登录验证</strong>。那么这该怎么做呢？可以用会话session来保存登录状态，每次进入页面前都要检查一遍登录状态，如果没有登录或者会话失效，则跳转到登录页面。（<strong>即通过会话域来存储会话信息。</strong>）</p>
<p>保存登录状态，简单地说，就是产生了session，并且session会话域中的key是name，value是其对应的名字，即保存了当前登录的用户名。（实际验证的时候，只需要考虑有name字段非空即可。）<strong>后续访问其他页面的时候，需要验证一下是否name字段为空即可，即只要有用户名就行。</strong></p>
<p>账号密码登录成功后创建session对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        String username = request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        String password = request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = DBUtil.getConnection();</span><br><span class="line">            String sql = <span class="string">&quot;select * from t_user where login=? and password=?&quot;</span>;</span><br><span class="line">            ps = conn.prepareStatement(sql);</span><br><span class="line">            ps.setString(<span class="number">1</span>, username);</span><br><span class="line">            ps.setString(<span class="number">2</span>, password);</span><br><span class="line"></span><br><span class="line">            rs = ps.executeQuery();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">                result = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            DBUtil.close(conn, ps, rs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(result)&#123;</span><br><span class="line">            <span class="comment">// 查询成功，即账号密码匹配，创建session保存会话状态。</span></span><br><span class="line">            HttpSession session = request.getSession();</span><br><span class="line">            session.setAttribute(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line"></span><br><span class="line">            response.sendRedirect(request.getContextPath() + <span class="string">&quot;/index.html&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            response.sendRedirect(request.getContextPath() + <span class="string">&quot;/error.html&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在另一个Servlet中（有请求路径），首先查看是否有session，有则查看会话域中是否有相关信息（username），匹配则跳转到指定页面；没有或者不匹配则跳转到登录页面，该servlet页面没有权限访问。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        HttpSession session = request.getSession(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (session != <span class="keyword">null</span> &amp;&amp; session.getAttribute(<span class="string">&quot;username&quot;</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            response.sendRedirect(request.getContextPath() + <span class="string">&quot;/index.html&quot;</span>);</span><br><span class="line">            <span class="comment">// System.out.println(session.getAttribute(&quot;username&quot;));</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            response.sendRedirect(request.getContextPath());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试的时候，首先请求该Servlet路径，可以看到因为没有session对象，直接跳转到登录页面；之后再次请求该路径，因为session对象已经创建，并且在会话域中保存了会话信息，所以可以直接跳转到欢迎页面。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>login.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>login<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.LoginServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>login<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/login<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>indexValidation<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.IndexServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>indexValidation<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/indexValidation<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="19-总结"><a href="#19-总结" class="headerlink" title="19. 总结"></a>19. 总结</h2><p>可以看到，</p>
<ul>
<li>Servlet是最顶层的接口，Tomcat通过创建该接口的实现类对象为浏览器提供服务。</li>
<li>在创建Servlet实现类对象的时候，调用init方法需要初始化ServletConfig接口的实现类对象。</li>
<li>ServletConfig接口中有4个方法，3个方法返回的是该Servlet实现类的web.xml的初始化配置信息，1个返回的是ServletContext接口的实现类对象。</li>
<li>ServletContext接口是负责一个webapp的web.xml文件对象，可以获取所有的配置信息等等。也被称为应用域，可以在该应用域中存储一些共享信息（所有Servlet共享）</li>
<li>Servlet的核心方法是Service()方法，里面有两个参数ServletRequest和ServletResponse两个接口的实现类对象。</li>
<li>为了方便HTTP协议的数据获取，JavaEE提供了HttpServlet这个类，该类实现了Servlet接口。以及ServletRequest和ServletResponse的实现类HttpServletRequest和HttpServletResponse。</li>
<li>另外，JavaEE提供了HTTP协议中的Cookie和Session两个客户端和浏览器端的会话类，方便业务的实现。</li>
</ul>
<h2 id="20-备注"><a href="#20-备注" class="headerlink" title="20. 备注"></a>20. 备注</h2><p><em>参考B站《动力节点》。</em></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">浮云</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://ihianian.github.io/2022/01/01/JavaWeb-07-Servlet/">https://ihianian.github.io/2022/01/01/JavaWeb-07-Servlet/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">浮云</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/JavaWeb/">
                                    <span class="chip bg-color">JavaWeb</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/null" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/null" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/01/01/JavaWeb-08-JSP/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/19.jpg" class="responsive-img" alt="JavaWeb_08_JSP">
                        
                        <span class="card-title">JavaWeb_08_JSP</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-01-01
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            hianian
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/01/01/JavaWeb-06-HTTP%E5%8D%8F%E8%AE%AE%E4%B8%8ETomcat%E6%9C%8D%E5%8A%A1%E5%99%A8/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/21.jpg" class="responsive-img" alt="JavaWeb_06_HTTP协议与Tomcat服务器">
                        
                        <span class="card-title">JavaWeb_06_HTTP协议与Tomcat服务器</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-01-01
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            浮云
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/JavaWeb/">
                        <span class="chip bg-color">JavaWeb</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2022</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">hianian</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">156.6k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">














    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
