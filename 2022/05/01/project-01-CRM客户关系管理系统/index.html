<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="project_01_CRM客户关系管理系统, ihianian">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>project_01_CRM客户关系管理系统 | ihianian</title>
    <link rel="icon" type="image/png" href="/header.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/header.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">ihianian</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/404" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/404" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/header.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">ihianian</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/404" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/404" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/20.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">project_01_CRM客户关系管理系统</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/project/">
                                <span class="chip bg-color">project</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-05-01
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-07-14
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    13.6k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    54 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>本文介绍SSM整合项目：CRM客户关系管理系统。</p>
<h2 id="1-项目介绍"><a href="#1-项目介绍" class="headerlink" title="1. 项目介绍"></a>1. 项目介绍</h2><p>客户关系管理系统正是为企业建立一个客户信息收集、管理、分析和利用的信息系统。<strong>以客户数据的管理为核心，记录企业在市场营销和销售过程中和客户发生的各种交互行为以及各类有关的活动状态，提供各类的数据模型，为后期的分析和决策提供了大力的支持。</strong></p>
<p>本项目需要掌握以下技能点：</p>
<ol>
<li>JavaSE：<ol>
<li>Java基本语法</li>
<li>集合</li>
<li>IO流</li>
<li>多线程等等</li>
</ol>
</li>
<li>JavaWeb：<ol>
<li>HTML</li>
<li>CSS</li>
<li>JavaScript</li>
<li>JQuery</li>
<li>AJAX</li>
<li>Servlet</li>
<li>JSP</li>
</ol>
</li>
<li>数据库：<ol>
<li>MySQL</li>
</ol>
</li>
<li>框架：<ol>
<li>Spring</li>
<li>SpringMVC</li>
<li>MyBatis</li>
</ol>
</li>
<li>工具：<ol>
<li>Maven</li>
<li>Git</li>
<li>JDK动态代理</li>
</ol>
</li>
</ol>
<p><strong>总的来说，项目是一套完整的功能。除了需要掌握上面的技能之外，还需要有一个全局的意识，这是非技术层面的，而是项目逻辑层面的。需要合理地分配代码逻辑，以便后期维护。</strong></p>
<p>其实上面的代码技能是最基本的，而项目软件则是充满灵魂的代码，所以说，这部分项目是为了给代码注入灵魂，<strong>学习项目开发过程中的思想</strong>。</p>
<h3 id="1-1-技术架构"><a href="#1-1-技术架构" class="headerlink" title="1.1 技术架构"></a>1.1 技术架构</h3><p>首先具体介绍一下，本项目需要用到的技术。<strong>在描述技术架构的时候，应该按照项目开发过程中的逻辑来陈述。即将技术以实际需求的形式来展示。</strong></p>
<p>和三层架构类似，一般情况下，项目开发分为四层：视图层（View）、控制层（Controller）、业务层（Service）和持久层（Dao/Mapper）。各层的技术分别如下所示：</p>
<ol>
<li><p>视图层：<strong>目的是展示数据，和用户交互</strong></p>
<p>HTML、CSS、JavaScript、Jquery（封装了js）、BootStrap（封装了html、css、js，类似的还有ext、vue、easyUI等等）</p>
</li>
<li><p>控制层：<strong>目的是接收请求，并根据用户请求来选择不同的业务代码来处理具体请求，并将处理结果返回给视图层。即控制业务处理流程。</strong></p>
<p>Servlet、JSP、SpringMVC（封装了Servlet，类似的还有webwork、struts1、struts2等等）</p>
</li>
<li><p>业务层：<strong>目的是处理业务逻辑，为用户提供服务。</strong></p>
<p>JavaSE</p>
</li>
<li><p>持久层：<strong>目的是操作数据库，处理数据</strong></p>
<p>MySQL、JDBC、MyBatis（类似的还有Hibernate）</p>
</li>
</ol>
<p>其中，为管理整体的逻辑，需要将上述四层整合起来（也可被称为整合层），需要用到Spring框架技术（类似的还有ejb、corba等等）。</p>
<h3 id="1-2-软件开发生命周期"><a href="#1-2-软件开发生命周期" class="headerlink" title="1.2 软件开发生命周期"></a>1.2 软件开发生命周期</h3><p>本小节回顾一下软件开发的生命周期（可以参考一下本科阶段的《软件工程》这门课程），主要介绍软件开发的几个阶段。</p>
<p>一般情况下，软件公司中和软件开发相关的有如下几个组织：</p>
<ol>
<li>市场部：负责拉项目</li>
<li>产品部：负责设计项目功能</li>
<li>研发部（美工、程序员、DBA）：负责开发项目</li>
<li>测试部：负责测试</li>
<li>实施部：负责部署</li>
<li>运维部：负责后期运行维护</li>
</ol>
<p>软件开发的生命周期有如下几个阶段：</p>
<ol>
<li>招标（甲方写标书，乙方投标竞争拿到项目）</li>
<li>可行性分析（是否能做、是否有效益等等）</li>
<li>需求分析（产品经理分析并设计大概的需求）</li>
<li>分析与设计（宏观分析如何功能实现；代码分层、功能类、数据表等设计；选择什么软硬件服务器等等；架构师、技术总监、项目经理负责）</li>
<li>搭建开发环境（添加所需要的jar包、配置文件、静态页面、公共工具类等等；项目经理负责）</li>
<li>编码实现（编码实现功能；程序员负责）</li>
<li>测试（黑盒测试、白盒测试等等；测试人员负责）</li>
<li>试运行（试运行；实施部门人员负责）</li>
<li>上线正式运行（正式上线交付；实施部门人员负责）</li>
<li>运维（后期运行维护；运维人员负责）</li>
<li><strong>文档编写（贯穿上述各个阶段）</strong></li>
</ol>
<h2 id="2-核心业务介绍（需求分析）"><a href="#2-核心业务介绍（需求分析）" class="headerlink" title="2. 核心业务介绍（需求分析）"></a>2. 核心业务介绍（需求分析）</h2><h3 id="2-1-项目简介"><a href="#2-1-项目简介" class="headerlink" title="2.1 项目简介"></a>2.1 项目简介</h3><p>本项目是客户关系管理系统（Customer Relationship Management），是一个企业级应用，为企业内部使用，要求不是很高，可以采用SSM框架实现。<strong>主要管理客户关系相关的资源。如贸易公司、保险公司等。在市场、销售、服务等各个环节中维护客户关系。CRM项目的宗旨：增加新客户、留住老客户，把已有客户转化为忠诚客户。</strong></p>
<p>本CRM项目是给进出口贸易公司来使用的。</p>
<h3 id="2-2-核心业务"><a href="#2-2-核心业务" class="headerlink" title="2.2 核心业务"></a>2.2 核心业务</h3><p>主要有以下几类功能：</p>
<ol>
<li><p>系统管理功能（保证业务管理功能正常、安全地运行）</p>
<p>比如用户登录、权限验证、退出等等；另外还有系统设置等等。</p>
</li>
<li><p>业务管理功能（处理业务数据）</p>
<p>比如添加用户、添加贸易信息等等。主要有以下几个功能：</p>
<ol>
<li>市场活动（添加、删除活动等等，为了拉客户）</li>
<li>线索（根据举办的市场活动，筛选出来潜在客户）</li>
<li>客户和联系人（存储上面的潜在客户）</li>
<li>交易（发展潜在客户，使其成为真正客户）</li>
<li>售后回访（为客户提供售后服务，客服与其维持联系；系统应该主动提醒客服，不要忘记联系重要客户）</li>
<li>统计图表（统计各个阶段的数据情况）</li>
</ol>
</li>
</ol>
<h2 id="3-物理模型设计"><a href="#3-物理模型设计" class="headerlink" title="3. 物理模型设计"></a>3. 物理模型设计</h2><h3 id="3-1-数据表"><a href="#3-1-数据表" class="headerlink" title="3.1 数据表"></a>3.1 数据表</h3><p>CRM项目用到的数据表：</p>
<ol>
<li><p>用户表：tbl_user</p>
<p>主要用于系统功能，主要用于登录。</p>
</li>
<li><p>数据字典值：tbl_dic_val</p>
<p>主要用于系统功能，主要用于下拉列表的选项值。</p>
</li>
<li><p>数据字典类型表：tbl_dic_type</p>
<p>主要用于系统功能，因为有多个下拉列表，每个下拉列表的选项值不同。为了区分，为每个下拉列表设置一个类型。本张表就是为了存储下拉类型。这样，选取了特定的下拉类型，就能从<code>tbl_dic_type</code>中选择出特定类型的值来显示。</p>
</li>
<li><p>市场活动表：tbl_activity</p>
<p>主要用于业务功能，存储开展的市场活动。</p>
</li>
<li><p>市场活动备注表：tbl_activity_remark</p>
<p>主要用于业务功能，对市场活动进行备注评价意见等等。</p>
</li>
<li><p>线索表：tbl_clue</p>
<p>主要用于业务功能，开展的市场活动主要是为了拉取客户，因此本张表主要是存储潜在客户的相关信息。</p>
</li>
<li><p>线索备注表：tbl_clue_remark</p>
<p>主要用于业务功能，对线索进行备注评价意见等等。</p>
</li>
<li><p>线索和市场活动关联关系表：tbl_clue_activity_relation</p>
<p>主要用于业务功能，二者属于多对多的关系，一场活动可和产生多个线索，一个线索可由多个活动产生（一个人参加了多场活动，且都留下了联系方式）</p>
</li>
<li><p>客户表：tbl_customer</p>
<p>主要用于业务功能，线索表示潜在的客户，可发展为真正的客户。</p>
</li>
<li><p>客户备注表：tbl_customer_remark</p>
<p>主要用于业务功能，对客户进行备注评价意见等等。</p>
</li>
<li><p>联系人：tbl_contacts</p>
<p>主要用于业务功能，联系人由潜在的客户发展而来。</p>
</li>
<li><p>联系人备注表：tbl_contacts_remark</p>
<p>主要用于业务功能，对联系人进行备注评价意见等等。</p>
</li>
<li><p>联系人和市场活动关联关系表：tbl_contacts_activity_relation</p>
<p>主要用于业务功能，二者属于多对多的关系，联系人和线索类似，都由活动产生。</p>
</li>
<li><p>交易表：tbl_tran</p>
<p>主要用于业务功能，客户有了交易意愿，进行交易</p>
</li>
<li><p>交易备注表：tbl_tran_remark</p>
<p>主要用于业务功能，对业务进行备注评价意见等等。</p>
</li>
<li><p>交易历史表：tbl_tran_history</p>
<p>主要用于业务功能，对交易的谈判历程等进行记录。</p>
</li>
<li><p>任务表：tbl_task（暂时不做这个功能）</p>
<p>主要用于业务功能，给客户使用，客服依据此表，进行回访。</p>
</li>
</ol>
<p>数据表中的主键：推荐使用和业务无关的字段做主键，因为业务数据可能会变，主键也就跟着变，这是不合理的，所以尽量将其不作为主键。</p>
<p><strong>主键字段的类型和长度由主键值的生成方式来决定，而主键值的生成方式主要有：</strong></p>
<ol>
<li><strong>自增（借助数据库自增主键生成机制）</strong>，即数值型，长度由数据量决定。（<strong>效率较低，在实际开发中使用较少</strong>）</li>
<li><strong>assign，程序员手动生成主键值，写程序生成唯一的值</strong>。常见的算法有：hi/low（数值型，长度由数据量决定，使用较少），UUID（字符串型，长度为32位，使用较多），雪花算法等等。</li>
<li><strong>共享主键</strong>：两张表的数据有关联，且一一对应，因此两张表共享同一个主键。（使用较少）</li>
<li><strong>联合主键</strong>：由多个字段的类型和长度决定。（使用较少）</li>
</ol>
<p>数据表中的外键：外键是用来确定表和表之间的关系。表和表之间的关系：</p>
<ol>
<li><p>一对多</p>
<p>一张表A中的一条记录对应另一张表B中的多条记录。另一张表B中的一条记录只能对应一张表A中的一条记录。表A就是父表，表B就是子表。比如一个班级，有多个学生，但是一个学生只属于一个班级。</p>
<p>添加数据时，先添加父表记录，再添加子表记录；删除数据时，先删除子表记录，在删除父表记录；查询数据时，可能会进行关联查询（内连接、外连接、等值连接、全连接）。</p>
</li>
<li><p>一对一</p>
<p>一张表A中的一条记录只能对应另一张表B中的一条记录。另一张表B中的一条记录页只能对应一张表A中的一条记录。比如一个公民对应一个驾照。两表采用<strong>共享主键</strong>或者<strong>唯一外键</strong>。</p>
</li>
<li><p>多对多</p>
<p>一张表A中的一条记录对应另一张表B中的多条记录。另一张表B中的一条记录页也能对应一张表A中的多条记录。比如学生表、课程表，即一个学生可选择多门课程，一门课程也被多门学生选择。<strong>选课表采用学生表和课程表的两个主键作为联合主键。</strong></p>
</li>
</ol>
<p>数据表的日期和时间字段：日期和时间是比较特殊的数据类型，都有特定的格式，数据库中的类型为：</p>
<ol>
<li>date：只有日期（年月日）</li>
<li>time：只有时间（时分秒）</li>
<li>datatime：日期加时间</li>
</ol>
<p>Java程序和SQL中的日期时间格式是不通的，所以需要工具类转换，一般情况下都可定义为定长字符串，此时就无需再进行转换了，因为Java和SQL中的字符串是想通的。等到操作时间的时候再格式化。</p>
<p><strong>具体的数据表可到网盘中下载。</strong></p>
<p><img src="D:%5Cothers%5Cstudy_source%5CGithubBlog%5CBlogImageBed%5Cblog-image-bed%5CJavaWeb%5Cproject%5Ccrm_project%5Ccrm_005.png" alt="image-20220613231816571"></p>
<h2 id="4-搭建开发环境"><a href="#4-搭建开发环境" class="headerlink" title="4. 搭建开发环境"></a>4. 搭建开发环境</h2><h3 id="4-1-IDEA创建项目工程"><a href="#4-1-IDEA创建项目工程" class="headerlink" title="4.1 IDEA创建项目工程"></a>4.1 IDEA创建项目工程</h3><p>一般情况下，创建一个新的空Project，用于管理各个模块Module。模块Module是用于具体的功能代码，同类的业务实现放在同一个Module中。这样一个完整的项目（Project）由各个子业务（Module）共同组成。<strong>本项目比较简单，只有一个模块。</strong></p>
<p>SSM项目，在创建Module的时候，直接选择Maven中的webapp即可，自动导入Jar包，比较方便。</p>
<p><img src="D:%5Cothers%5Cstudy_source%5CGithubBlog%5CBlogImageBed%5Cblog-image-bed%5CJavaWeb%5Cproject%5Ccrm_project%5Ccrm_001.png" alt="image-20220613225550175"></p>
<p>其中，GroupId可以认为是项目名（Project），ArtifactId可以认为是模块名（Module）</p>
<p><img src="D:%5Cothers%5Cstudy_source%5CGithubBlog%5CBlogImageBed%5Cblog-image-bed%5CJavaWeb%5Cproject%5Ccrm_project%5Ccrm_002.png" alt="image-20220613225821295"></p>
<p>IDEA创建的Maven中的webapp项目，自带的目录结构不全，需要手动补全，如<code>src/main/java</code>、<code>src/main/resources</code>、<code>src/test/java</code>、<code>src/test/resources</code>。</p>
<p><img src="D:%5Cothers%5Cstudy_source%5CGithubBlog%5CBlogImageBed%5Cblog-image-bed%5CJavaWeb%5Cproject%5Ccrm_project%5Ccrm_003.png" alt="image-20220613230508225"></p>
<p>并修改目录属性。</p>
<p><img src="D:%5Cothers%5Cstudy_source%5CGithubBlog%5CBlogImageBed%5Cblog-image-bed%5CJavaWeb%5Cproject%5Ccrm_project%5Ccrm_004.png" alt="image-20220613231550237"></p>
<p>也要注意，设置项目的编码方式。</p>
<p><img src="D:%5Cothers%5Cstudy_source%5CGithubBlog%5CBlogImageBed%5Cblog-image-bed%5CJavaWeb%5Cproject%5Ccrm_project%5Ccrm_006.png" alt="image-20220614103945743"></p>
<h3 id="4-2-添加jar包依赖"><a href="#4-2-添加jar包依赖" class="headerlink" title="4.2 添加jar包依赖"></a>4.2 添加jar包依赖</h3><ol>
<li><p>MySQL驱动</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Druid连接池</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>MyBatis框架</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Spring依赖</p>
<p>（核心依赖已由SpringMVC间接导入）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Spring事务依赖 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-tx --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Spring事务依赖（JDBC数据库） --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-jdbc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>SpringMVC依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- SpringMVC依赖（已经包括了Spring核心依赖） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Spring AOP依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-aspects --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Spring与MyBatis整合依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis-spring --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>添加项目对JSP、Servlet、JSTL等的支持</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- servlet依赖 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- jsp依赖 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp/jsp-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- JSTL --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/jstl --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Jackson插件依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-annotations --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>poi依赖（用于导出excel等办公文件）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.poi/poi --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>fileupload依赖（用于文件上传）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Log4j依赖（日志）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.17.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.17.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-jcl --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-jcl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.17.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="4-3-添加配置文件"><a href="#4-3-添加配置文件" class="headerlink" title="4.3 添加配置文件"></a>4.3 添加配置文件</h3><p>创建配置文件，用于后续的各项配置。</p>
<ol>
<li><p>mybatis（<code>mybatis-config.xml</code>）</p>
<p>因为采用了数据库连接池，所以本配置文件就是为了集成所有的SQL映射文件，以及MyBatis的基本配置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- MyBatis主配置文件，因为采用了数据库连接池，所以数据库连接信息在datasource中 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 本文件的作用就是提供一些基础配置，以及对SQL映射文件进行统一管理 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 指定properties文件的位置，从类路径根下开始找 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 控制MyBatis的全局行为 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 在主配置文件的configuration标签内，加入如下标签 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 控制输出日志，输出为标准控制台输出 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">setting</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 映射文件 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;mappers&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;mapper resource=&quot;org/hianian/dao/UserDao.xml&quot;/&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;/mappers&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>spring（<code>applicationContext-datasource.xml</code>、<code>applicationContext.xml</code>）</p>
<p><code>applicationContext-datasource.xml</code>文件主要关于数据库，即整合Mybatis（<strong>负责扫描mapper</strong>）：</p>
<ol>
<li>配置数据源</li>
<li>配置SqlSessionFactory</li>
<li>mapper注解扫描器配置</li>
<li>配置事务管理器</li>
<li>配置事务</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 将数据库的配置信息写在一个独立的配置文件中，将该配置文件引入到本配置文件中用于数据域对象读取 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 声明数据源DataSource对象以及连接对象Connection，作用是连接数据库，代替MyBatis主配置文件中的数据库连接 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myDataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.maxActive&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 声明MyBatis所提供的SqlSessionFactoryBean类，这个类内部会创建SqlSessionFactory对象。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 通过之前的MyBatis主配置文件知道，创建SqlSessionFactory对象需要数据库连接信息以及主配置文件 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 连接数据库就是上面的myDataSource，即下面的属性 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;myDataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 主配置文件就是resources/mybatis-config.xml --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- MyBatis扫描器，创建Dao对象 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 声明Dao对象，使用SqlSession的getMapper(.class)方法来创建对象 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这个声明类对象不需要id（不需要手动调用），MapperScannerConfigurer会在内部调用getMapper()生成每个dao接口的代理对象。 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 因为需要SqlSession对象，以及接口的class名。所以需要将这两个信息赋给属性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定SqlSessionFactory对象的id，会自动通过SqlSessionFactory对象创建SqlSession对象 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 指定代理对象的接口的class (只需要指定dao接口所在包名即可，会自动扫描接口类型)--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- MapperScannerConfigurer会扫描指定包中所有的接口，把每个接口都执行一次getMapper()方法，得到每个接口生成的dao对象 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 创建好的dao对象放入到Spring容器中。对象名称就是Dao接口的首字母小写 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.hianian.dao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>applicationContext.xml</code>是Spring总配置文件，用于导入其他Spring子配置文件、<strong>扫描Service</strong>等等。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 将数据库连接池对象导入本文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;applicationContext-datasource.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 声明service对象，为用户提供服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里为了方便，将Spring配置文件分为上述若干个子文件。</p>
</li>
<li><p>sprinbmvc（<code>applicationContext-mvc.xml</code>）</p>
<p>该文件主要<strong>负责扫描Controller</strong>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">                           https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">                           https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- springmvc的配置文件，用于声明Controller和其他web相关的对象--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 声明组件扫描器，创建Controller对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;org.hianian.controller&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 声明视图解析器，方便资源之间的路径书写 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 声明视图文件的前缀 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 声明视图文件的后缀，即扩展名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 添加注解驱动（方便返回Object等数据类型以及处理静态资源） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意，这里的视图解析器是随便写的，后续可能会返回修改。</strong></p>
</li>
<li><p><code>web.xml</code></p>
<p>该文件是web项目的核心配置，和上述框架没关系。负责web项目启动的时候一些配置、加载框架配置文件（加载applicationContext.xml监听器、SpringMVC核心调度器）、字符过滤器等等。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 配置Spring监听器，在Tomcat启动时，就创建Spring容器 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Spring相关配置 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 注册Spring监听器 ，并指定自定义的配置文件位置(就是说，创建容器的时候，扫描哪个文件，创建里面的对象)--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- SpringMVC相关配置--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 中央调度器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>pom.xml</code></p>
<p>在该文件中设置maven对配置文件的编译选项，即将资源文件编译到指定的类路径目录下面。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 告诉指定的目录 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 拷贝的资源文件类型 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 设置过滤器，这里不用设置了，上面相当于设置了 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 避免上述操作覆盖默认设置，这里将默认设置的目录添加 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 告诉指定的目录 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 拷贝的资源文件类型 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>*.*<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 设置过滤器，这里不用设置了，上面相当于设置了 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="4-4-添加资源文件"><a href="#4-4-添加资源文件" class="headerlink" title="4.4 添加资源文件"></a>4.4 添加资源文件</h3><p>资源文件主要是前端页面以及涉及到的图片、js等等。资源文件可根据不同的功能存放在不同的文件夹下。注意，整个项目分为<strong>系统功能</strong>和<strong>业务功能</strong>两部分。</p>
<p>注意，一般情况下，资源文件和<code>WEB-INF</code>平级，都在webapp目录下，而<code>WEB-INF</code>里面是不可通过URL访问到。（对于一些重要的页面，需要把页面放到<code>WEB-INF</code>下面，通过其他页面处理请求Controller（验证账号密码）来转发到该页面，注意，这里不是重定向，因为重定向是用户重新发起请求，而WEB-INF是安全的，不允许外部访问）。</p>
<ol>
<li>为了更加安全，统一将<strong>需要保护的页面资源文件</strong>放置到<code>WEB-INF</code>里面的某个目录下，如<code>pages</code>。</li>
<li>对于js、css等公开数据，可直接放到<code>webapp</code>下面。因为这些资源都是页面引用的，如果放到<code>WEB-INF</code>下面，就会导致在引用的时候，还需要通过Controller来访问，比较麻烦。</li>
</ol>
<p>目录结构如下所示【为了方便，后续是根据系统功能和业务功能进行建包的】：</p>
<p><img src="D:%5Cothers%5Cstudy_source%5CGithubBlog%5CBlogImageBed%5Cblog-image-bed%5CJavaWeb%5Cproject%5Ccrm_project%5Ccrm_007.png" alt="image-20220629141729233"></p>
<h2 id="5-功能实现"><a href="#5-功能实现" class="headerlink" title="5. 功能实现"></a>5. 功能实现</h2><p>一个项目比较复杂，有很多个功能。但是应该先做哪些呢？<strong>先做没有依赖的功能，也就是独立的功能。</strong>首先是业务功能是依赖于系统功能的。因为业务功能需要账号，因此需要先做系统功能。</p>
<h3 id="5-1-系统功能"><a href="#5-1-系统功能" class="headerlink" title="5.1 系统功能"></a>5.1 系统功能</h3><h4 id="5-1-1-首页功能"><a href="#5-1-1-首页功能" class="headerlink" title="5.1.1 首页功能"></a>5.1.1 首页功能</h4><blockquote>
<p>需求分析：访问项目名：<code>http://127.0.0.1:8080/crm</code>直接跳转到首页<code>index.html</code>。</p>
<p>分析与设计：由客户端发起请求，Controller接收请求后，通过映射，发现是请求首页，所以直接转发到index.jsp，该JSP在Tomcat运行后生成html，返回给客户端。</p>
<p><img src="D:%5Cothers%5Cstudy_source%5CGithubBlog%5CBlogImageBed%5Cblog-image-bed%5CJavaWeb%5Cproject%5Ccrm_project%5Ccrm_008.png" alt="image-20220629143919056"></p>
</blockquote>
<ol>
<li><p>编码实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注意，因为是转发视图，所以返回值类型是String</span></span><br><span class="line">    <span class="comment">// 注意，要修改上面中央调度器url。</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 转发到index.jsp</span></span><br><span class="line">        <span class="comment">// 注意，在springmvc配置文件中设置视图解析器</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将已经设置好的<code>index.html</code>资源修改为<code>index.jsp</code>，其实就是修改一下扩展名即可。<strong>注意，还要修改二者的编码方式，因为IDEA默认的html编码方式ISO8859，而对jsp编码方式为UTF-8。所以在修改扩展名之前，一定要先将html文件编码修改为UTF-8</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">		document.location.href = <span class="string">&quot;settings/qx/user/login.html&quot;</span>;</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>测试：<strong>因为项目原型，index.jsp里面的内容是请求登录页面。而我们将登录页面已经放置到了WEB-INF中，因此此时请求转发到index.jsp中，随即请求登录页面。此时还需要对登录页面请求进行Controller控制。</strong></p>
</li>
</ol>
<blockquote>
<p>注意，什么时候新建Controller，什么时候在Controller中新建方法？</p>
<p>这取决于，如果两个方法访问的资源是否在同一个目录下，如果在同一个目录下，那么就新建方法。如果不在同一个目录下吗，就新建Controller。<strong>即，一个Controller的所有方法，处理后的请求返回的资源均在同一个目录下。</strong></p>
</blockquote>
<p>新建的Controller如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为了方便，这里的URL要和本方法处理后的资源路径保持一致，并添加本方法名。【注意，前端在请求时，也要改成这个路径】</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/settings/qx/user/toLogin.do&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toLogin</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 转发到登录页面</span></span><br><span class="line">        <span class="comment">// 已经有视图解析器了</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;settings/qx/user/login&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前端修改后的页面为：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">		document.location.href = <span class="string">&quot;settings/qx/user/toLogin.do&quot;</span>;</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注意，返回的页面是服务器编译后的内容，而URL路径则是发生的请求，即Controller中返回的地址。所以说，浏览器中的URL其实和视图解析器没有关系，Controller中的RequestMapping也和视图解析器没关系。</strong></p>
<p>还要注意一点的是，因为我们在前面将所有请求都映射到SpringMVC的中央调度器了，但是此时，也就意味着请求图片、js等也是如此【还需要另外的Controller】。显然这样效率较低，也没必要。因此，需要将其余的请求，也就是找不到Controller【显然图片就不需要Controller】的请求进行特殊处理，参考SpringMVC讲义，有两种方式，一种利用所在服务器的默认处理Handler，一种是利用框架自带的Handler【优先选用这种】。<strong>在springmvc配置文件中添加如下配置。</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 第二种方式解决静态资源访问 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这种方法会创建ResourceHttpRequestHandler处理器，这个处理器是Spring框架自己实现的，用于处理静态资源访问 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mapping表示请求的uri，可以用通配符 ** 表示全部。 比如image/**，表示image下的所有静态资源 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- location表示静态资源在项目中的位置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/image/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/image/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/html/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/html/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/js/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/js/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:resources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="5-1-2-登录功能"><a href="#5-1-2-登录功能" class="headerlink" title="5.1.2 登录功能"></a>5.1.2 登录功能</h4><blockquote>
<p>需求分析：用户在登录页面，输入用户名和密码，点击“登录”按钮或者回车，完成用户登录的功能。</p>
<ol>
<li>用户名和密码不能为空。【表单验证】</li>
<li>用户名或者密码错误，用户已过期，用户状态被锁定，ip受限等都不能登录成功。【查询数据库】</li>
<li>登录成功之后，所以业务页面显示当前用户的名称。【将验证时后台查出来的数据放入到作用域中】</li>
<li>实现10天记住密码。【判断是否点击了记住密码，如果有，则将账号密码存储在Cookie中，保存在本机】</li>
<li>登录成功之后，跳转到业务主页面。</li>
<li>登录失败，页面不跳转，提示信息。</li>
</ol>
<p>分析与设计：用户在登录页面输入账号和密码，点击登录或者回车键，发送请求到后台Controller【注意，这里是异步请求，因为如果验证失败，那么就在本页面显示账号或密码不正确（<strong>局部刷新</strong>）；如果验证成功，那么就进入到业务页面（<strong>全局刷新</strong>），因此当既有可能局部刷新也有可能是全局刷新时，只能是异步请求】。那么此时，客户端只能接受到JSON字符串，对于异步刷新是可以的（<strong>验证失败，指明原因</strong>），但是全局刷新该怎么实现呢？（<strong>需要利用异步请求的接收结果来重新发起请求。</strong>）</p>
<p><img src="D:%5Cothers%5Cstudy_source%5CGithubBlog%5CBlogImageBed%5Cblog-image-bed%5CJavaWeb%5Cproject%5Ccrm_project%5Ccrm_009.png" alt="image-20220629202420521"></p>
<p><img src="D:%5Cothers%5Cstudy_source%5CGithubBlog%5CBlogImageBed%5Cblog-image-bed%5CJavaWeb%5Cproject%5Ccrm_project%5Ccrm_010.png" alt="image-20220629202510879"></p>
<p>总体来说，客户端发送请求；后台Controller接收请求，并将参数封装为对象，调用Service层处理业务并传参；Service层根据业务调用Dao来获取数据，并根据参数来比对数据，处理业务，最终将结果返回给Controller（<strong>上面的流程图的11步应该在Service操作</strong>）；Controller根据将业务处理结果返回给客户端；客户端根据结果来渲染页面。</p>
</blockquote>
<p><strong>注意，前面提到过，对于Controller以及方法，如果方法的返回值的视图在一个目录下，那么这些方法就在一个Controller类中。而对于Service、Mapper（Dao）、实体类等，这些则是依据针对处理的数据表，如果处理的数据属于一张表，那么就在一个类中，否则则新建类。</strong></p>
<ol>
<li><p>编码实现：</p>
<p>首先，由于tbl_user表中的字段太多，所以采用MyBatis逆向工程生成实体类、Dao接口以及映射文件最基本的代码。<strong>而上面的queryUserByLoginActAndPwd(map)方法需要自己实现。</strong></p>
</li>
</ol>
<blockquote>
<p>注意，对于一些常用代码，可抽取成工具类；对于一些规定的编码值，比如登录成功为1，登录失败为0，这些值不能写死，因为后续可能会修改这些值，肯定不能一一修改，应该将其定义为常量类中的常量属性，直接调用即可。</p>
</blockquote>
<blockquote>
<p>在需求3中，一共有四个作用域：pageContext、request、session、application，那么该将数据放到哪个作用域中呢？</p>
<ol>
<li>pageContext：用于在同<strong>一个页面</strong>不同标签之间传递数据，即从一个标签传递另一个标签【自定义标签底层处理数据】</li>
<li>request：从发出请求到收到响应之间传递数据，即同<strong>一次请求</strong>中传递数据。</li>
<li>session：在一个浏览器不同次请求之间传递数据。【基于Cookie，当Cookie对象消失后，那么session会话也就消失了】，即同一个用户在一段时间内的数据。</li>
<li>application：服务器层面共享数据，从服务器启动到服务器关闭，即所有用户之间共享的数据。</li>
</ol>
<p>因此，在同一个用户，一段时间内共享数据，需要放置到session会话域中。</p>
</blockquote>
<h4 id="5-1-3-安全退出"><a href="#5-1-3-安全退出" class="headerlink" title="5.1.3 安全退出"></a>5.1.3 安全退出</h4><p>注意，这里的退出是安全退出，简单的关闭浏览器等这种方式在非安全环境下并不是安全的【cookie没有清除，session没断开（对服务器压力较大）】。</p>
<p>因此，应该<strong>安全退出</strong>：<strong>清空cookie，销毁session</strong></p>
<blockquote>
<p>需求分析：用户在任意的业务页面，点击“退出”按钮，弹出确认退出的模态窗口；用户在确认退出的模态窗口，点击“确定”按钮，完成安全退出的功能：</p>
<ol>
<li>安全退出，清空cookie，销毁session</li>
<li>退出完成后，跳转到首页</li>
</ol>
<p><img src="D:%5Cothers%5Cstudy_source%5CGithubBlog%5CBlogImageBed%5Cblog-image-bed%5CJavaWeb%5Cproject%5Ccrm_project%5Ccrm_011.png" alt="image-20220701145138678"></p>
</blockquote>
<p>注意，因为要服务器清空cookie、销毁session，并且跳转到首页【会跳转到登录页面】，所以需要请求Controller。而Controller最终返回的视图是登录页面，所以，和前面的Controller应该是一个，即在里面添加方法即可。</p>
<p>注意，在最终要返回的首页。虽然最终通过请求转发和重定向都能实现，但是请求转发不会改变浏览器中的原始URL，而重定向则会改变。<strong>因此，这里应该是重定向比较合适。</strong></p>
<p>代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/settings/qx/user/toLogout.do&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toLogout</span><span class="params">(HttpServletResponse response, HttpSession session)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清空Cookie，将生存时间设置为0即可</span></span><br><span class="line">    Cookie cookie1 = <span class="keyword">new</span> Cookie(<span class="string">&quot;loginAct&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">    cookie1.setMaxAge(<span class="number">0</span>);</span><br><span class="line">    response.addCookie(cookie1);</span><br><span class="line"></span><br><span class="line">    Cookie cookie2 = <span class="keyword">new</span> Cookie(<span class="string">&quot;loginPwd&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">    cookie2.setMaxAge(<span class="number">0</span>);</span><br><span class="line">    response.addCookie(cookie2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 销毁session对象，并将数据都清除</span></span><br><span class="line">    session.invalidate();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 转发到首页【这里请求转发和重定向都可以，从浏览器的角度来看，请求转发不会改变原始的URL，所以这里应该是重定向】</span></span><br><span class="line">    <span class="comment">// 这里因为使用了redirect关键字，所以视图解析器不起作用。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-1-4-登录验证"><a href="#5-1-4-登录验证" class="headerlink" title="5.1.4 登录验证"></a>5.1.4 登录验证</h4><p>其实前面可以看到，完全可以直接输入controller中的路径来进行访问，而无需登录就可以进入业务页面。<strong>这其实是不安全的，需要验证</strong>。</p>
<blockquote>
<p>需求分析：<strong>登录验证，用户访问任何资源文件，都需要进行登录验证</strong>。</p>
<ol>
<li>只有登录成功的用户才能访问业务资源。</li>
<li>没有登录成功的用户访问业务资源，跳转到登录页面。</li>
</ol>
<p>因为是对所有资源都进行验证，显然需要一个全局的限制，即过滤器【原生态，功能不够强大】，或者是框架提供的拦截器【对过滤器进行封装之后的工具类，SpringMVC中的HandlerInterceptor接口】。</p>
</blockquote>
<p>因为登录成功后，在session中添加了对象数据，因此，只要获取到session对象，判断是否有该数据即可。代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 登录验证</span></span><br><span class="line">    <span class="comment">// 判断在访问资源之前，是否登录成功</span></span><br><span class="line">    <span class="comment">// 因为登录成功之后，我们设置了响应码，并且向Session中添加了数据，因此，可根据session中是否有user即可。</span></span><br><span class="line">    HttpSession session = request.getSession();</span><br><span class="line">    User user = (User) session.getAttribute(Constant.SESSION_USER);</span><br><span class="line">    <span class="keyword">if</span>(user == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 跳转到登录页面，重定向</span></span><br><span class="line">        <span class="comment">// 注意，自己通过response的重定向必须加项目名字，和框架不同</span></span><br><span class="line">        response.sendRedirect(request.getContextPath());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 满足要求，放行</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在配置文件中，声明拦截器：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置拦截器 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 声明拦截器：拦截器可以有0个或多个 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 声明一个登录验证拦截器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 声明拦截的请求uri地址，可以使用通配符，注意要将登录页面以及验证登录用户页面去除掉 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注意，其实本质上说，这里拦截的是Controller路径。而Controller路径是以setting或者workbench开头的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/settings/**&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/workbench/**&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 排除拦截，优先级较高 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;/settings/qx/user/toLogin.do&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;/settings/qx/user/doLogin.do&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 声明拦截器对象 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.hianian.settings.web.interceptor.LoginInterceptor&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-业务功能——市场活动"><a href="#5-2-业务功能——市场活动" class="headerlink" title="5.2 业务功能——市场活动"></a>5.2 业务功能——市场活动</h3><blockquote>
<p>页面切割技术：默认情况下，一个浏览器页面只能显示一个html页面；为了灵活，可以在一个浏览器页面中显示多个html页面，即页面切割技术：</p>
<ol>
<li>&lt;frameset&gt;标签和&lt;frame&gt;标签</li>
<li>&lt;div&gt;标签和&lt;iframe&gt;标签【常用】</li>
</ol>
</blockquote>
<h4 id="5-2-1-创建市场活动"><a href="#5-2-1-创建市场活动" class="headerlink" title="5.2.1 创建市场活动"></a>5.2.1 创建市场活动</h4><blockquote>
<p>需求分析：创建市场活动：用户在市场活动主页面，点击“创建”按钮，弹出创建市场活动的模态窗口；用户在创建市场活动的模态窗口填写表单，点击“保存”按钮，完成市场创建活动的功能。</p>
<ol>
<li>所有者是动态的（下拉列表，即在显示市场活动主页面时，就从数据库中查询出所有用户并且显示在创建的模态窗口中）。</li>
<li>所有者和名称不能为空。</li>
<li>如果开始日期和结束日期都不为空，则结束日期不能比开始日期小。</li>
<li>成本只能为非负整数。</li>
<li>创建成功之后，关闭模态窗口，刷新市场活动列，显示第一页数据，保持每页显示条数不变。</li>
<li>创建失败，提示信息创建失败，模态窗口不关闭，市场活动列表也不刷新。</li>
</ol>
<p>为了方便，前端项目原型使用了模态窗口。</p>
</blockquote>
<p>创建市场活动，首先要显示市场活动以及所有者，即从数据库中遍历所需的数据表，将其显示到前端。</p>
<blockquote>
<p>显示所有者：</p>
<p><img src="D:%5Cothers%5Cstudy_source%5CGithubBlog%5CBlogImageBed%5Cblog-image-bed%5CJavaWeb%5Cproject%5Ccrm_project%5Ccrm_012.png" alt="image-20220701204551381"></p>
<p>新建保存市场活动：因为模态窗口是主页面的一部分，即需要异步请求。另外，因为需要日期，所以为了统一格式，采用前端日历插件（如bootstrap-datetimepicker）。前端插件使用步骤：</p>
<ol>
<li>引入开发包：.js，.css。下载开发包，拷贝到项目的Webapp目录下，将开发包引入到调用者jsp文件中。</li>
<li>创建容器，如input、div等用于显示插件的功能。</li>
<li>当容器加载完成之后，对容器调用工具函数，即使用插件的功能。</li>
</ol>
</blockquote>
<h4 id="5-2-2-查询市场活动"><a href="#5-2-2-查询市场活动" class="headerlink" title="5.2.2 查询市场活动"></a>5.2.2 查询市场活动</h4><p>这里在点击市场活动时，显示出了主页面。但是此时其实需要显示当前已有的市场活动的，<strong>这是就需要检索数据库</strong>。另外，所有市场活动，有时候太多，没必要在一个页面中显示，此时就需要<strong>分页显示</strong>。另外，由于数量太多，此时还需要提供<strong>条件查询功能</strong>。同时，也许要提供用户<strong>自定义显示每页的市场活动条目数</strong>。</p>
<p>总体来说，本功能，首先需要检索数据库，查询出所有的市场活动，交给浏览器。而后，浏览器在前端接收到数据之后，似乎可根据用户请求来分页显示、条件查询以及自定义每页的市场活动条目数。【<strong>这是自己认为的，但是其他人认为，其实每次都查询数据库就行，而且查询的就是指定页数的数据【条件】，而不是全部的数据；这样客户端浏览器压力较小。为什么要分页查询呢，这是因为分页查询的数据量较小，浏览器可以很容易显示，而如果全部查询之后，一方面，如果数据量较大，显然服务器和客户端占用内存都较大。</strong>】</p>
<blockquote>
<p>需求分析：查询市场活动：</p>
<ol>
<li>当市场活动主页面加载完成之后，显示所有数据的第一页。</li>
<li>用户在市场活动主页面填写查询条件，点击“查询”按钮，显示所有符合条件的数据的第一页，并保持每页显示条数不变。</li>
<li>实现翻页功能：<ol>
<li>在市场活动主页面，显示市场活动列表和记录的总条数；</li>
<li>默认每页显示条数：10。</li>
</ol>
<strong>分页可由分页插件【bs_pagination】来实现</strong>。</li>
</ol>
</blockquote>
<h4 id="5-2-3-删除市场活动"><a href="#5-2-3-删除市场活动" class="headerlink" title="5.2.3 删除市场活动"></a>5.2.3 删除市场活动</h4><blockquote>
<p>需求分析：删除市场活动：用户在市场活动主页面，选择要删除的市场活动，点击“删除”按钮，弹出确认窗口；用户点击“确定”按钮，完成删除市场活动的功能。</p>
<ol>
<li>每次至少删除一次市场活动</li>
<li>可以批量删除市场活动</li>
<li>删除成功之后，刷新市场活动列表，显示第一页数据，保持每页显示条数不变</li>
<li>删除失败，提示信息，列表不刷新</li>
</ol>
<p>注意，要有全选按钮。</p>
<p><strong>补充，因为后续还有针对某个市场活动的备注，所以删除市场活动的同时，也要删除备注表中该市场活动的所有备注记录。</strong></p>
</blockquote>
<h4 id="5-2-4-修改市场活动"><a href="#5-2-4-修改市场活动" class="headerlink" title="5.2.4 修改市场活动"></a>5.2.4 修改市场活动</h4><blockquote>
<p>需求分析：修改市场活动：用户在市场活动主页面，选择要修改的市场活动，点击“修改”按钮，弹出修改市场活动的模态窗口。用户在修改市场活动的模态窗口填写表单，点击“更新”按钮，完成修改市场活动的功能。</p>
<ol>
<li>每次能且只能修改一条市场活动</li>
<li>所有者 是动态的</li>
<li>表单验证（同创建市场活动）</li>
<li>修改成功之后，关闭模态窗口，刷新市场活动列表，保持页号和每页显示条数都不变</li>
<li>修改失败，提示信息，模态窗口不关闭，列表也不刷新</li>
</ol>
<p>注意，修改市场活动可以分成两部分：</p>
<ol>
<li>一部分是根据选中的记录查询数据库在模态窗口显示详细信息。</li>
<li>另一部分是针对显示的详细信息，进行修改，更新数据库。</li>
</ol>
</blockquote>
<h4 id="5-2-5-批量导出市场活动"><a href="#5-2-5-批量导出市场活动" class="headerlink" title="5.2.5 批量导出市场活动"></a>5.2.5 批量导出市场活动</h4><blockquote>
<p>需求分析：批量导出市场活动：用户在市场活动主页面，点击“批量导出”按钮，把所有市场活动生成一个Excel文件，弹出文件下载的对话框。用户选择要保存的目录，完成导出市场活动的功能。</p>
<ol>
<li>导出成功之后，页面不刷新。</li>
</ol>
<p>注意，这里是批量导出，即需要导出全部数据。流程如下所示：</p>
<ol>
<li>给“批量导出”按钮添加单击事件，发送导出请求</li>
<li>查询所有的市场活动</li>
<li>创建一个excel文件，并且把市场活动写到excel文件中【无需写入磁盘】</li>
<li>把生成的excel文件输出到浏览器。【文件下载，注意，文件下载请求只能是同步请求，因为响应信息是文件，而AJAX解析不了。<strong>另外，即使是同步请求，而我们将其显示在下载窗口，因此不会覆盖掉原始页面</strong>】</li>
<li>用户选择保存目录即可。</li>
</ol>
<p>文件生成和下载需要插件，如Apache-poi、iText等等，【因为Java的IO只能生成没有格式的文件】</p>
<blockquote>
<p>关于办公文档插件使用的基本思想：插件把办公文档的所有元素（比如行、列、字体等等）封装成普通的Java类，程序员通过操作这些类来达到操作办公文档元素的目的。<strong>因此，只需要把插件提供的类弄明白即可。</strong>这些插件是Jar包，因此可在Maven项目中添加依赖。</p>
<p>poi插件的类：</p>
<ol>
<li>文件——&gt;HSSFWorkbook</li>
<li>页——&gt;HSSFSheet</li>
<li>行——&gt;HSSFRow</li>
<li>列——&gt;HSSFCell</li>
<li>样式——&gt;HSSFCellStyle</li>
</ol>
</blockquote>
<p>服务器本地生成文件后。用户点击下载来请求服务器传输文件。<strong>这里就是Controller返回值类型为文件类型，可不通过框架来传输，可自己传输，即返回值为void，通过response输出流来返回文件。测试代码如下所示：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 不借助框架，自己来返回文件流</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/workbench/activity/fileDownload.do&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fileDownload</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.设置响应内容类型，这些文件类型，可查阅协议规定，contentType</span></span><br><span class="line">    response.setContentType(<span class="string">&quot;application/octet-stream;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.通过输出流写入文件</span></span><br><span class="line">    <span class="comment">// 字符流只能写文本文件，需要字节流</span></span><br><span class="line">    OutputStream writer = response.getOutputStream();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 浏览器接收到响应信息后，默认是在显示窗口打开响应信息。因此需要设置不让他在显示页面打开【即使打不开，也要调用相关软件】。</span></span><br><span class="line">    <span class="comment">// 只有实在打不开的情况，才会激活文件下载程序。</span></span><br><span class="line">    <span class="comment">// 我们需要直接让其激活文件下载程序。</span></span><br><span class="line">    <span class="comment">// 设置响应头信息</span></span><br><span class="line">    response.addHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=myStudent.xlsx&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取要传输的文件，并输出</span></span><br><span class="line">    InputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;D:\\others\\work\\work_2022_0507\\ip.xlsx&quot;</span>);</span><br><span class="line">    <span class="keyword">byte</span>[] buff = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>((len=inputStream.read(buff)) != -<span class="number">1</span>)&#123;</span><br><span class="line">        writer.write(buff, <span class="number">0</span>, len);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭流，对于writer不需要关闭，因为是response创建的，由tomcat自行关闭</span></span><br><span class="line">    inputStream.close();</span><br><span class="line">    writer.flush();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="5-2-6-选择导出市场活动"><a href="#5-2-6-选择导出市场活动" class="headerlink" title="5.2.6 选择导出市场活动"></a>5.2.6 选择导出市场活动</h4><blockquote>
<p>需求分析：选择导出市场活动：用户在市场活动主页面，选择要导出的市场活动，点击“选择导出”按钮，把所有选择的数据生成一个excel文件，弹出文件下载的对话框。用户选择要保存的目录，完成选择导出市场活动的功能。</p>
<ol>
<li>每次至少选择导出一条记录</li>
<li>导出成功之后，页面不刷新</li>
</ol>
<p>其实这里的选择导出和前面的全部导出类似，只不过，这里有了条件，可根据复选框中的id，向后台传参，查询这些id的市场记录，然后再封装成文件即可。</p>
</blockquote>
<h4 id="5-2-7-导入市场活动"><a href="#5-2-7-导入市场活动" class="headerlink" title="5.2.7 导入市场活动"></a>5.2.7 导入市场活动</h4><blockquote>
<p>需求分析：导入市场活动：用户在市场活动主页面，点击“导入”按钮，弹出导入市场活动的模态窗口。用户在导入市场活动的模态窗口选择要上传的文件，点击“导入”按钮，完成导入活动的功能。</p>
<ol>
<li>只支持.xls</li>
<li>文件大小不超过5MB</li>
<li>导入成功之后，提示成功导入记录条数，关闭模态窗口，刷新市场活动列表，显示第一页数据，保持每页显示条数不变</li>
<li>导入失败，提示信息，模态窗口不关闭，列表也不刷新。</li>
</ol>
<p>注意，这里虽然可能是插入多条数据，但是因为是多条数据一起插入，即一条SQL语句，所以也无需使用事务。</p>
<p>导入市场活动也需要文件上传。从文件中解析数据，插入到数据库中。</p>
<p><strong>文件上传的表单必须满足三个条件，缺一不可</strong></p>
<ol>
<li>表单<strong>组件</strong>标签只能用：&lt;input type=”file”&gt;，自动添加单击事件并弹出文件选择框。</li>
<li>请求方式只能用：post【参数放在请求体中（可以提交多种格式数据），而get放在请求头中（而且只能文本数据）】</li>
<li>form表单的编码格式只能用：<code>multipart/form-data</code>。【根据HTTP协议的规定，浏览器每次向后台提交参数的时候，都会对参数进行统一编码；默认编码格式为<code>urlencoded</code>（这种格式只能对文本数据进行编码，即将所有其他类型数据都转换为字符串，然后统一编码）】。enctype=”multipart/form-data”</li>
</ol>
<p>ajax发送文件案例如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给导入按钮添加单击事件</span></span><br><span class="line">        $(<span class="string">&quot;#importActivityBtn&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 收集参数，即表单value，注意是文件，所以需要特定的方式拿到文件</span></span><br><span class="line">            <span class="keyword">var</span> activityFileName = $(<span class="string">&quot;#activityFile&quot;</span>).val();</span><br><span class="line">            <span class="comment">// 利用文件名验证是否符合格式要求</span></span><br><span class="line">            <span class="keyword">var</span> subffix = activityFileName.substr(activityFileName.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>).toLocaleLowerCase();</span><br><span class="line">            <span class="keyword">if</span>(subffix != <span class="string">&quot;xls&quot;</span>) &#123;</span><br><span class="line">                alert(<span class="string">&quot;仅支持xls文件&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 拿到文件</span></span><br><span class="line">            <span class="keyword">var</span> activityFile = $(<span class="string">&quot;#activityFile&quot;</span>)[<span class="number">0</span>].files[<span class="number">0</span>];</span><br><span class="line">            <span class="comment">// 验证文件大小，字节</span></span><br><span class="line">            <span class="keyword">if</span>(activityFile.size &gt; <span class="number">5</span> * <span class="number">1024</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">                alert(<span class="string">&quot;文件不能超过5MB&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 发送异步请求</span></span><br><span class="line">            <span class="comment">// 注意，文件需要用FormData对象来传输数据，模拟键值对向后台提交参数</span></span><br><span class="line">            <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">            formData.append(<span class="string">&quot;activityFile&quot;</span>, activityFile);</span><br><span class="line"></span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                <span class="attr">url</span>: <span class="string">&#x27;workbench/activity/fileUpload.do&#x27;</span>,</span><br><span class="line">                <span class="attr">data</span>: formData,</span><br><span class="line">                <span class="attr">processData</span>: <span class="literal">false</span>, <span class="comment">// 设置提交参数之前，是否统一编码成字符串，为后续URL编码格式做准备</span></span><br><span class="line">                <span class="attr">contentType</span>: <span class="literal">false</span>, <span class="comment">// 设置提交参数之前，是否把所有的参数统一按urlencode编码，</span></span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">                <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line"></span><br><span class="line">                <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span>(data.code == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">                        alert(data.message);</span><br><span class="line">                        <span class="comment">// 关闭窗口</span></span><br><span class="line">                        $(<span class="string">&quot;#importActivityModal&quot;</span>).modal(<span class="string">&quot;hide&quot;</span>);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// 刷新列表</span></span><br><span class="line">                        queryActivityByConditionForPage(<span class="number">1</span>, $(<span class="string">&quot;#demo_page&quot;</span>).bs_pagination(<span class="string">&#x27;getOption&#x27;</span>, <span class="string">&#x27;rowsPerPage&#x27;</span>));</span><br><span class="line"></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        alert(data.message);</span><br><span class="line">                        $(<span class="string">&quot;#importActivityModal&quot;</span>).modal(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>



<p>注意，因为传输的数据是文件，所以后台Controller必须将数据封装成文件。而SpringMVC框架提供了封装后的数据类型MultipartFile，即SpringMVC框架会自动从请求体中将数据封装成该类对象。<strong>但是此行为需要一个文件上传解析器，而又因为此行为发生的次数比较少，因此该解析器对象需要在SpringMVC配置文件中手动配置。</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置文件上传解析器 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- id必须为multipartResolver --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;1024*1024*5&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>服务器获取到文件之后，需要对文件进行解析，获取到每一条数据，然后将其插入到数据库。解析文件依然用到前面的<code>apache-poi</code>插件。</p>
</blockquote>
<h4 id="5-2-8-查询市场活动明细"><a href="#5-2-8-查询市场活动明细" class="headerlink" title="5.2.8 查询市场活动明细"></a>5.2.8 查询市场活动明细</h4><blockquote>
<p>需求分析：用户在市场活动主页面，点击市场活动名称超链接，跳转到明细页面，完成查看市场活动明细的功能。在市场活动明细页面，展示：</p>
<ol>
<li>市场活动的基本信息</li>
<li>该市场活动下所有的备注信息</li>
</ol>
<p><strong>本功能涉及到市场活动表和市场活动备注表两张表。一条市场活动可以有多条备注。但是一条备注只能针对的是一条市场活动。</strong></p>
</blockquote>
<h4 id="5-2-9-添加市场活动备注"><a href="#5-2-9-添加市场活动备注" class="headerlink" title="5.2.9 添加市场活动备注"></a>5.2.9 添加市场活动备注</h4><blockquote>
<p>需求分析：用户在市场活动明细页面，输入备注内容，点击“保存”按钮，完成添加市场备注的功能。</p>
<ol>
<li>备注内容不能为空</li>
<li>添加成功之后，清空输入框，刷新备注列表【前端页面追加一条即可，无需后台查询】</li>
<li>添加失败，提示信息，输入框不清空，列表也不刷新</li>
</ol>
</blockquote>
<h4 id="5-2-10-删除市场活动备注"><a href="#5-2-10-删除市场活动备注" class="headerlink" title="5.2.10 删除市场活动备注"></a>5.2.10 删除市场活动备注</h4><blockquote>
<p>需求分析：用户在市场活动明细页面，点击“删除”市场活动备注的图标，完成删除市场活动备注的功能。</p>
<ol>
<li>删除成功之后，刷新备注列表</li>
<li>删除失败，提示信息，备注列表不刷新</li>
</ol>
</blockquote>
<h4 id="5-2-11-修改市场活动备注"><a href="#5-2-11-修改市场活动备注" class="headerlink" title="5.2.11 修改市场活动备注"></a>5.2.11 修改市场活动备注</h4><blockquote>
<p>需求分析：用户在市场活动明细页面，点击“修改”市场活动备注的图标，弹出修改市场备注的模态窗口；用户在修改市场活动备注的模态窗口，填写表单，点击“更新”按钮，完成修改市场活动备注的功能。</p>
<ol>
<li>备注内容不能为空</li>
<li>修改成功之后，关闭模态窗口，刷新备注列表</li>
<li>修改失败，提示信息，模态窗口不关闭，列表也不刷新</li>
</ol>
</blockquote>
<h3 id="5-3-业务功能——线索"><a href="#5-3-业务功能——线索" class="headerlink" title="5.3 业务功能——线索"></a>5.3 业务功能——线索</h3><h4 id="5-3-1-创建线索"><a href="#5-3-1-创建线索" class="headerlink" title="5.3.1 创建线索"></a>5.3.1 创建线索</h4><blockquote>
<p>需求分析：用户在线索主页面，点击“创建”按钮，弹出创建线索的模态窗口；用户在创建线索的模态窗口，填写表单，点击“保存”按钮，完成创建线索的功能。</p>
<ol>
<li>所有者、称呼、线索状态、线索来源是动态的【下拉列表】</li>
<li>表单验证</li>
<li>创建成功之后，关闭模态窗口，刷新线索列表，显示第一页数据，保持每页显示条数不变</li>
<li>创建失败，提示信息，模态窗口不关闭，列表也不刷新</li>
</ol>
</blockquote>
<h4 id="5-3-2-查询线索（略）"><a href="#5-3-2-查询线索（略）" class="headerlink" title="5.3.2 查询线索（略）"></a>5.3.2 查询线索（略）</h4><h4 id="5-3-3-查看线索明细（略）"><a href="#5-3-3-查看线索明细（略）" class="headerlink" title="5.3.3 查看线索明细（略）"></a>5.3.3 查看线索明细（略）</h4><h4 id="5-3-4-删除线索（略）"><a href="#5-3-4-删除线索（略）" class="headerlink" title="5.3.4 删除线索（略）"></a>5.3.4 删除线索（略）</h4><h4 id="5-3-5-修改线索（略）"><a href="#5-3-5-修改线索（略）" class="headerlink" title="5.3.5 修改线索（略）"></a>5.3.5 修改线索（略）</h4><h4 id="5-3-6-关联市场活动（重点）"><a href="#5-3-6-关联市场活动（重点）" class="headerlink" title="5.3.6 关联市场活动（重点）"></a>5.3.6 关联市场活动（重点）</h4><p>一条线索可由多条市场活动获得，一条市场活动可产生多条线索。</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">浮云</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://ihianian.github.io/2022/05/01/project-01-CRM%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/">https://ihianian.github.io/2022/05/01/project-01-CRM%E5%AE%A2%E6%88%B7%E5%85%B3%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">浮云</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/project/">
                                    <span class="chip bg-color">project</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/null" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/null" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/05/05/LeetCode-51-3sum/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/23.jpg" class="responsive-img" alt="LeetCode_51_3sum">
                        
                        <span class="card-title">LeetCode_51_3sum</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-05-05
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            浮云
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/LeetCode/">
                        <span class="chip bg-color">LeetCode</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/04/14/LeetCode-50-RansomNote/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/10.jpg" class="responsive-img" alt="LeetCode_50_RansomNote">
                        
                        <span class="card-title">LeetCode_50_RansomNote</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-04-14
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            浮云
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/LeetCode/">
                        <span class="chip bg-color">LeetCode</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2023</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">hianian</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">600.8k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">














    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
